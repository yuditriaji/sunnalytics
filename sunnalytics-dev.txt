
=== .\.gitignore ===
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

=== .\all_files_combined.txt ===

=== .\eslint.config.mjs ===
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;

=== .\next-env.d.ts ===
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/pages/building-your-application/configuring/typescript for more information.

=== .\next.config.js ===
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development' // Disable PWA in dev for faster reloads
});

const nextConfig = {
  reactStrictMode: true,
  swcMinify: true, // Enable SWC minification for faster builds
  images: {
    domains: ['localhost'], // Add domains for image optimization if needed
  },
  experimental: {
    optimizePackageImports: ['antd', '@ant-design/icons'], // Optimize Ant Design imports
  },
};

module.exports = withPWA(nextConfig);
=== .\package.json ===
{
  "name": "sunnalytics-dev",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx}\""
  },
  "dependencies": {
    "chart.js": "^4.4.9",
    "chartjs-adapter-date-fns": "^3.0.0",
    "framer-motion": "^12.14.0",
    "localforage": "^1.10.0",
    "next": "^14.2.29",
    "next-pwa": "^5.6.0",
    "react": "^18.3.1",
    "react-chartjs-2": "^5.3.0",
    "react-dom": "^18.3.1",
    "react-icons": "^5.5.0",
    "react-responsive": "^10.0.1",
    "react-window": "^1.8.11",
    "swr": "^2.2.5",
    "tailwindcss": "^3.4.1",
    "zustand": "^5.0.0-rc.2"
  },
  "devDependencies": {
    "@types/lodash.debounce": "^4.0.9",
    "@types/node": "^22.7.7",
    "@types/react": "^18.3.11",
    "@types/react-dom": "^18.3.1",
    "@types/react-window": "^1.8.8",
    "autoprefixer": "^10.4.19",
    "eslint": "^8.57.1",
    "eslint-config-next": "^14.2.29",
    "postcss": "^8.4.38",
    "prettier": "^3.3.3",
    "typescript": "^5.6.3"
  }
}

=== .\postcss.config.js ===
module.exports = {
plugins: {
    tailwindcss: {},
    autoprefixer: {},
},
};
=== .\sunnalytics-dev.txt ===

=== .\.gitignore ===
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

=== .\all_files_combined.txt ===

=== .\eslint.config.mjs ===
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;

=== .\next-env.d.ts ===
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/pages/building-your-application/configuring/typescript for more information.

=== .\next.config.js ===
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development' // Disable PWA in dev for faster reloads
});

const nextConfig = {
  reactStrictMode: true,
  swcMinify: true, // Enable SWC minification for faster builds
  images: {
    domains: ['localhost'], // Add domains for image optimization if needed
  },
  experimental: {
    optimizePackageImports: ['antd', '@ant-design/icons'], // Optimize Ant Design imports
  },
};

module.exports = withPWA(nextConfig);
=== .\package.json ===
{
  "name": "sunnalytics-dev",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx}\""
  },
  "dependencies": {
    "chart.js": "^4.4.9",
    "chartjs-adapter-date-fns": "^3.0.0",
    "framer-motion": "^12.14.0",
    "localforage": "^1.10.0",
    "next": "^14.2.29",
    "next-pwa": "^5.6.0",
    "react": "^18.3.1",
    "react-chartjs-2": "^5.3.0",
    "react-dom": "^18.3.1",
    "react-icons": "^5.5.0",
    "react-responsive": "^10.0.1",
    "react-window": "^1.8.11",
    "swr": "^2.2.5",
    "tailwindcss": "^3.4.1",
    "zustand": "^5.0.0-rc.2"
  },
  "devDependencies": {
    "@types/lodash.debounce": "^4.0.9",
    "@types/node": "^22.7.7",
    "@types/react": "^18.3.11",
    "@types/react-dom": "^18.3.1",
    "@types/react-window": "^1.8.8",
    "autoprefixer": "^10.4.19",
    "eslint": "^8.57.1",
    "eslint-config-next": "^14.2.29",
    "postcss": "^8.4.38",
    "prettier": "^3.3.3",
    "typescript": "^5.6.3"
  }
}

=== .\postcss.config.js ===
module.exports = {
plugins: {
    tailwindcss: {},
    autoprefixer: {},
},
};
=== .\sunnalytics-dev.txt ===

=== .\.gitignore ===
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

=== .\all_files_combined.txt ===

=== .\eslint.config.mjs ===
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;

=== .\next-env.d.ts ===
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/pages/building-your-application/configuring/typescript for more information.

=== .\next.config.js ===
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development' // Disable PWA in dev for faster reloads
});

const nextConfig = {
  reactStrictMode: true,
  swcMinify: true, // Enable SWC minification for faster builds
  images: {
    domains: ['localhost'], // Add domains for image optimization if needed
  },
  experimental: {
    optimizePackageImports: ['antd', '@ant-design/icons'], // Optimize Ant Design imports
  },
};

module.exports = withPWA(nextConfig);
=== .\package.json ===
{
  "name": "sunnalytics-dev",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx}\""
  },
  "dependencies": {
    "chart.js": "^4.4.9",
    "chartjs-adapter-date-fns": "^3.0.0",
    "framer-motion": "^12.14.0",
    "localforage": "^1.10.0",
    "next": "^14.2.29",
    "next-pwa": "^5.6.0",
    "react": "^18.3.1",
    "react-chartjs-2": "^5.3.0",
    "react-dom": "^18.3.1",
    "react-icons": "^5.5.0",
    "react-responsive": "^10.0.1",
    "react-window": "^1.8.11",
    "swr": "^2.2.5",
    "tailwindcss": "^3.4.1",
    "zustand": "^5.0.0-rc.2"
  },
  "devDependencies": {
    "@types/lodash.debounce": "^4.0.9",
    "@types/node": "^22.7.7",
    "@types/react": "^18.3.11",
    "@types/react-dom": "^18.3.1",
    "@types/react-window": "^1.8.8",
    "autoprefixer": "^10.4.19",
    "eslint": "^8.57.1",
    "eslint-config-next": "^14.2.29",
    "postcss": "^8.4.38",
    "prettier": "^3.3.3",
    "typescript": "^5.6.3"
  }
}

=== .\postcss.config.js ===
module.exports = {
plugins: {
    tailwindcss: {},
    autoprefixer: {},
},
};
=== .\sunnalytics-dev.txt ===

=== .\.gitignore ===
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

=== .\all_files_combined.txt ===

=== .\eslint.config.mjs ===
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;

=== .\next-env.d.ts ===
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/pages/building-your-application/configuring/typescript for more information.

=== .\next.config.js ===
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development' // Disable PWA in dev for faster reloads
});

const nextConfig = {
  reactStrictMode: true,
  swcMinify: true, // Enable SWC minification for faster builds
  images: {
    domains: ['localhost'], // Add domains for image optimization if needed
  },
  experimental: {
    optimizePackageImports: ['antd', '@ant-design/icons'], // Optimize Ant Design imports
  },
};

module.exports = withPWA(nextConfig);
=== .\package.json ===
{
  "name": "sunnalytics-dev",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx}\""
  },
  "dependencies": {
    "chart.js": "^4.4.9",
    "chartjs-adapter-date-fns": "^3.0.0",
    "framer-motion": "^12.14.0",
    "localforage": "^1.10.0",
    "next": "^14.2.29",
    "next-pwa": "^5.6.0",
    "react": "^18.3.1",
    "react-chartjs-2": "^5.3.0",
    "react-dom": "^18.3.1",
    "react-icons": "^5.5.0",
    "react-responsive": "^10.0.1",
    "react-window": "^1.8.11",
    "swr": "^2.2.5",
    "tailwindcss": "^3.4.1",
    "zustand": "^5.0.0-rc.2"
  },
  "devDependencies": {
    "@types/lodash.debounce": "^4.0.9",
    "@types/node": "^22.7.7",
    "@types/react": "^18.3.11",
    "@types/react-dom": "^18.3.1",
    "@types/react-window": "^1.8.8",
    "autoprefixer": "^10.4.19",
    "eslint": "^8.57.1",
    "eslint-config-next": "^14.2.29",
    "postcss": "^8.4.38",
    "prettier": "^3.3.3",
    "typescript": "^5.6.3"
  }
}

=== .\postcss.config.js ===
module.exports = {
plugins: {
    tailwindcss: {},
    autoprefixer: {},
},
};
=== .\sunnalytics-dev.txt ===

=== .\.gitignore ===
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

=== .\all_files_combined.txt ===

=== .\eslint.config.mjs ===
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;

=== .\next-env.d.ts ===
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/pages/building-your-application/configuring/typescript for more information.

=== .\next.config.js ===
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development' // Disable PWA in dev for faster reloads
});

const nextConfig = {
  reactStrictMode: true,
  swcMinify: true, // Enable SWC minification for faster builds
  images: {
    domains: ['localhost'], // Add domains for image optimization if needed
  },
  experimental: {
    optimizePackageImports: ['antd', '@ant-design/icons'], // Optimize Ant Design imports
  },
};

module.exports = withPWA(nextConfig);
=== .\package.json ===
{
  "name": "sunnalytics-dev",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx}\""
  },
  "dependencies": {
    "chart.js": "^4.4.9",
    "chartjs-adapter-date-fns": "^3.0.0",
    "framer-motion": "^12.14.0",
    "localforage": "^1.10.0",
    "next": "^14.2.29",
    "next-pwa": "^5.6.0",
    "react": "^18.3.1",
    "react-chartjs-2": "^5.3.0",
    "react-dom": "^18.3.1",
    "react-icons": "^5.5.0",
    "react-responsive": "^10.0.1",
    "react-window": "^1.8.11",
    "swr": "^2.2.5",
    "tailwindcss": "^3.4.1",
    "zustand": "^5.0.0-rc.2"
  },
  "devDependencies": {
    "@types/lodash.debounce": "^4.0.9",
    "@types/node": "^22.7.7",
    "@types/react": "^18.3.11",
    "@types/react-dom": "^18.3.1",
    "@types/react-window": "^1.8.8",
    "autoprefixer": "^10.4.19",
    "eslint": "^8.57.1",
    "eslint-config-next": "^14.2.29",
    "postcss": "^8.4.38",
    "prettier": "^3.3.3",
    "typescript": "^5.6.3"
  }
}

=== .\postcss.config.js ===
module.exports = {
plugins: {
    tailwindcss: {},
    autoprefixer: {},
},
};
=== .\sunnalytics-dev.txt ===

=== .\.gitignore ===
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

=== .\all_files_combined.txt ===

=== .\eslint.config.mjs ===
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;

=== .\next-env.d.ts ===
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/pages/building-your-application/configuring/typescript for more information.

=== .\next.config.js ===
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development' // Disable PWA in dev for faster reloads
});

const nextConfig = {
  reactStrictMode: true,
  swcMinify: true, // Enable SWC minification for faster builds
  images: {
    domains: ['localhost'], // Add domains for image optimization if needed
  },
  experimental: {
    optimizePackageImports: ['antd', '@ant-design/icons'], // Optimize Ant Design imports
  },
};

module.exports = withPWA(nextConfig);
=== .\package.json ===
{
  "name": "sunnalytics-dev",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx}\""
  },
  "dependencies": {
    "chart.js": "^4.4.9",
    "framer-motion": "^12.14.0",
    "localforage": "^1.10.0",
    "next": "^14.2.29",
    "next-pwa": "^5.6.0",
    "react": "^18.3.1",
    "react-chartjs-2": "^5.3.0",
    "react-dom": "^18.3.1",
    "react-icons": "^5.5.0",
    "react-responsive": "^10.0.1",
    "react-window": "^1.8.11",
    "swr": "^2.2.5",
    "tailwindcss": "^3.4.1",
    "zustand": "^5.0.0-rc.2"
  },
  "devDependencies": {
    "@types/lodash.debounce": "^4.0.9",
    "@types/node": "^22.7.7",
    "@types/react": "^18.3.11",
    "@types/react-dom": "^18.3.1",
    "@types/react-window": "^1.8.8",
    "autoprefixer": "^10.4.19",
    "eslint": "^8.57.1",
    "eslint-config-next": "^14.2.29",
    "postcss": "^8.4.38",
    "prettier": "^3.3.3",
    "typescript": "^5.6.3"
  }
}

=== .\postcss.config.js ===
module.exports = {
plugins: {
    tailwindcss: {},
    autoprefixer: {},
},
};
=== .\tailwind.config.js ===
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
=== .\tree.txt ===
Project Tree (excluding node_modules, .next, package-lock.json):

â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ all_files_combined.txt
â”œâ”€â”€ combine_files.py
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”œâ”€â”€ FilterDrawer.tsx
â”‚   â”œâ”€â”€ TokenTable.tsx
â”‚   â””â”€â”€ WelcomeScreen.tsx
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ generate_tree.py
â”œâ”€â”€ hooks
â”‚   â””â”€â”€ useTokenData.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ _app.tsx
â”‚   â”œâ”€â”€ api
â”‚   â”œâ”€â”€ charts.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â”œâ”€â”€ settings.tsx
â”‚   â””â”€â”€ welcome.tsx
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ src
â”œâ”€â”€ stores
â”‚   â””â”€â”€ useTokenStore.ts
â”œâ”€â”€ styles
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tree.txt
â”œâ”€â”€ tsconfig.json
â””â”€â”€ utils
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ fonts.ts
    â””â”€â”€ tokenStats.ts
=== .\tsconfig.json ===
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", "postcss.config.js"],
  "exclude": ["node_modules"]
}

=== .\components\BottomNav.tsx ===
import React from 'react';
import { useRouter } from 'next/router';
import { FaChartLine, FaFilter, FaWallet, FaHome } from 'react-icons/fa';

interface BottomNavProps {
  onFilterClick?: () => void;
}

const BottomNav: React.FC<BottomNavProps> = ({ onFilterClick }) => {
  const router = useRouter();

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-gray-800 h-20 p-2 flex justify-around items-center border-t border-gray-700 shadow-lg pb-safe-area-inset-bottom">
      <button
        onClick={() => router.push('/')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaHome className="text-lg mb-1" />
        <span>Market</span>
      </button>
      <button
        onClick={() => router.push('/portfolio')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/portfolio' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaWallet className="text-lg mb-1" />
        <span>Portfolio</span>
      </button>
      <button
        onClick={onFilterClick}
        className="flex flex-col items-center text-xs text-gray-400 hover:text-yellow-400 transition-all duration-200 hover:scale-110"
      >
        <FaFilter className="text-lg mb-1" />
        <span>Filter</span>
      </button>
      <button
        onClick={() => router.push('/charts')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/charts' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaChartLine className="text-lg mb-1" />
        <span>Charts</span>
      </button>
    </nav>
  );
};

export default BottomNav;
=== .\components\FilterDrawer.tsx ===
import React, { useState, useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';

interface FilterDrawerProps {
  isOpen: boolean;
  onClose: () => void;
}

const FilterDrawer: React.FC<FilterDrawerProps> = ({ isOpen, onClose }) => {
  const { filteredTokens, setFilteredTokens, tokens } = useTokenStore();
  const [filters, setFilters] = useState({
    category: '',
    minPrice: '',
    maxPrice: '',
    minVolumeMarketCapRatio: '',
    maxVolumeMarketCapRatio: '',
    minCirculatingSupplyPercentage: '',
    maxCirculatingSupplyPercentage: '',
    isVolumeHealthy: '',
    isCirculatingSupplyGood: '',
  });

  useEffect(() => {
    const applyFilters = () => {
      let filtered = [...tokens];
      if (filters.category) {
        filtered = filtered.filter(token => token.category === filters.category);
      }
      if (filters.minPrice) {
        const min = parseFloat(filters.minPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price >= min);
      }
      if (filters.maxPrice) {
        const max = parseFloat(filters.maxPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price <= max);
      }
      if (filters.minVolumeMarketCapRatio) {
        const min = parseFloat(filters.minVolumeMarketCapRatio) / 100; // Convert percentage to ratio
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio >= min);
      }
      if (filters.maxVolumeMarketCapRatio) {
        const max = parseFloat(filters.maxVolumeMarketCapRatio) / 100; // Convert percentage to ratio
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio <= max);
      }
      if (filters.minCirculatingSupplyPercentage) {
        const min = parseFloat(filters.minCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage >= min);
      }
      if (filters.maxCirculatingSupplyPercentage) {
        const max = parseFloat(filters.maxCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage <= max);
      }
      if (filters.isVolumeHealthy === 'true') {
        filtered = filtered.filter(token => token.isVolumeHealthy === true);
      } else if (filters.isVolumeHealthy === 'false') {
        filtered = filtered.filter(token => token.isVolumeHealthy === false);
      }
      if (filters.isCirculatingSupplyGood === 'true') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === true);
      } else if (filters.isCirculatingSupplyGood === 'false') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === false);
      }
      setFilteredTokens(filtered);
    };

    applyFilters();
  }, [filters, tokens, setFilteredTokens]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFilters(prev => ({ ...prev, [name]: value }));
  };

  const handleReset = () => {
    setFilters({
      category: '',
      minPrice: '',
      maxPrice: '',
      minVolumeMarketCapRatio: '',
      maxVolumeMarketCapRatio: '',
      minCirculatingSupplyPercentage: '',
      maxCirculatingSupplyPercentage: '',
      isVolumeHealthy: '',
      isCirculatingSupplyGood: '',
    });
    setFilteredTokens(tokens);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
      <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
        <h2 className="text-lg font-bold text-white mb-4">Filter Tokens</h2>
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-300">Category</label>
            <select
              name="category"
              value={filters.category}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="altcoin">Altcoin</option>
              <option value="defi">DeFi</option>
              <option value="memecoin">Memecoin</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Price ($)</label>
            <input
              type="number"
              name="minPrice"
              value={filters.minPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Price ($)</label>
            <input
              type="number"
              name="maxPrice"
              value={filters.maxPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Volume Market Cap Ratio (%)</label>
            <input
              type="number"
              name="minVolumeMarketCapRatio"
              value={filters.minVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Volume Market Cap Ratio (%)</label>
            <input
              type="number"
              name="maxVolumeMarketCapRatio"
              value={filters.maxVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Circulating Supply (%)</label>
            <input
              type="number"
              name="minCirculatingSupplyPercentage"
              value={filters.minCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Circulating Supply (%)</label>
            <input
              type="number"
              name="maxCirculatingSupplyPercentage"
              value={filters.maxCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Volume Healthy</label>
            <select
              name="isVolumeHealthy"
              value={filters.isVolumeHealthy}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Circulating Supply Good</label>
            <select
              name="isCirculatingSupplyGood"
              value={filters.isCirculatingSupplyGood}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>
        <div className="mt-6 flex justify-end space-x-4">
          <button
            onClick={handleReset}
            className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-500 transition-colors"
          >
            Reset
          </button>
          <button
            onClick={onClose}
            className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors"
          >
            Apply
          </button>
        </div>
      </div>
    </div>
  );
};

export default FilterDrawer;
=== .\components\TabbedFilters.tsx ===
// components/TabbedFilters.tsx
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useTokenStore } from '../stores/useTokenStore';

const tabs = [
  { id: 'all', label: 'All' },
  { id: 'highlights', label: 'Highlights', badge: 'ðŸ”¥' },
  { id: 'trending', label: 'Trending', badge: 'ðŸ“ˆ' },
  { id: 'pumpfun', label: 'Pump.fun' },
  { id: 'ecosystems', label: 'Ecosystems' },
];

const TabbedFilters: React.FC = () => {
  const { setFilteredTokens, tokens } = useTokenStore();
  const [activeTab, setActiveTab] = useState('all');

  const handleTabClick = (tabId: string) => {
    setActiveTab(tabId);
    if (tabId === 'all') {
      setFilteredTokens(tokens);
    } else {
      setFilteredTokens(tokens.filter(token => token.category.toLowerCase() === tabId));
    }
  };

  return (
    <div className="mb-4">
      <div
        className="flex space-x-2 overflow-x-auto pb-2"
        role="tablist"
        aria-label="Token Categories"
      >
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => handleTabClick(tab.id)}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              activeTab === tab.id
                ? 'bg-yellow-500 text-black'
                : 'bg-gray-700 text-white hover:bg-gray-600'
            }`}
            role="tab"
            aria-selected={activeTab === tab.id}
            aria-controls={`panel-${tab.id}`}
          >
            {tab.label}
            {tab.badge && <span className="ml-1">{tab.badge}</span>}
          </button>
        ))}
      </div>
      <AnimatePresence>
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -10 }}
          transition={{ duration: 0.3 }}
          id={`panel-${activeTab}`}
          role="tabpanel"
          aria-labelledby={activeTab}
        >
          {/* Content managed by TokenTable */}
        </motion.div>
      </AnimatePresence>
    </div>
  );
};

export default TabbedFilters;
=== .\components\TokenTable.tsx ===
// components/TokenTable.tsx
import React, { useState, useMemo, memo, useCallback } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import FilterDrawer from './FilterDrawer';
import { FaSort } from 'react-icons/fa';
import { FixedSizeList } from 'react-window';
import debounce from 'lodash.debounce';

interface Token {
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
}

interface TokenTableProps {
  isFilterDrawerOpen: boolean;
  onFilterClick: () => void;
  onFilterClose: () => void;
}

const TokenTable: React.FC<TokenTableProps> = memo(({ isFilterDrawerOpen, onFilterClick, onFilterClose }) => {
  const { filteredTokens, setFilteredTokens, tokens } = useTokenStore();
  const [searchQuery, setSearchQuery] = useState('');
  const [visibleColumns, setVisibleColumns] = useState<string[]>([
    'symbol',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ]);
  const [isColumnModalVisible, setIsColumnModalVisible] = useState(false);
  const [isSortModalVisible, setIsSortModalVisible] = useState(false);
  const [sortConfig, setSortConfig] = useState<{ key: string; direction: 'asc' | 'desc' } | null>(null);

  const toggleColumn = (key: string) => {
    setVisibleColumns(prev =>
      prev.includes(key) ? prev.filter(col => col !== key) : [...prev, key]
    );
  };

  const debouncedSearch = useCallback(
    debounce((query: string) => {
      setFilteredTokens(
        tokens.filter(
          token =>
            token.name.toLowerCase().includes(query.toLowerCase()) ||
            token.symbol.toLowerCase().includes(query.toLowerCase())
        )
      );
    }, 300),
    [tokens, setFilteredTokens]
  );

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const query = e.target.value;
    setSearchQuery(query);
    debouncedSearch(query);
  };

  const showColumnModal = () => {
    setIsColumnModalVisible(true);
  };

  const handleColumnClose = () => {
    setIsColumnModalVisible(false);
  };

  const showSortModal = () => {
    setIsSortModalVisible(true);
  };

  const handleSortClose = () => {
    setIsSortModalVisible(false);
  };

  const requestSort = (key: string) => {
    setSortConfig(prev => {
      if (!prev || prev.key !== key) {
        return { key, direction: 'asc' };
      }
      return prev.direction === 'asc' ? { key, direction: 'desc' } : null;
    });
    handleSortClose();
  };

  const sortedTokens = useMemo(() => {
    if (!sortConfig) return filteredTokens;
    return [...filteredTokens].sort((a, b) => {
      const aValue = a[sortConfig.key as keyof Token];
      const bValue = b[sortConfig.key as keyof Token];
      if (aValue === undefined || bValue === undefined) return 0;
      if (sortConfig.direction === 'asc') {
        return aValue > bValue ? 1 : -1;
      }
      return aValue < bValue ? 1 : -1;
    });
  }, [filteredTokens, sortConfig]);

  const columns = [
    'symbol',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ].filter(col => visibleColumns.includes(col));

  const formatNumber = (value: number | undefined, suffix: string = '') => {
    if (value === undefined || value === 0) return '-';
    if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
    if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
    return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
  };

  const formatRatio = (value: number | undefined) => value !== undefined ? `${(value * 100).toFixed(2)}%` : '-';
  const formatBoolean = (value: boolean | undefined) => value !== undefined ? (value ? 'Yes' : 'No') : '-';
  const formatScore = (value: number | undefined) => value !== undefined ? value.toFixed(2) : '-';

  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => {
    const token = sortedTokens[index];
    return (
      <div
        style={style}
        className="bg-gray-800 p-2 flex items-center space-x-4 text-white rounded shadow-sm hover:bg-gray-700 transition-colors"
        role="row"
        aria-label={`Token ${token.symbol}`}
      >
        {columns.map(col => (
          <div key={col} className="flex-1 text-sm truncate" role="cell">
            {col === 'symbol' ? (
              <span>{token.symbol}</span>
            ) : col === 'price' ? (
              <button className="bg-green-500 text-black px-2 py-1 rounded hover:bg-green-400 transition-colors">
                Buy ${formatNumber(token.price)}
              </button>
            ) : col === 'volume24h' ? (
              formatNumber(token.volume24h)
            ) : col === 'marketCap' ? (
              formatNumber(token.marketCap)
            ) : col === 'volumeMarketCapRatio' ? (
              formatRatio(token.volumeMarketCapRatio)
            ) : col === 'isVolumeHealthy' ? (
              formatBoolean(token.isVolumeHealthy)
            ) : col === 'pumpDumpRiskScore' ? (
              formatScore(token.pumpDumpRiskScore)
            ) : col === 'liquidityScore' ? (
              formatScore(token.liquidityScore)
            ) : col === 'walletDistributionScore' ? (
              formatScore(token.walletDistributionScore)
            ) : (
              '-'
            )}
          </div>
        ))}
      </div>
    );
  };

  return (
    <div className="p-4">
      <div className="mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <input
          type="text"
          placeholder="Search tokens..."
          value={searchQuery}
          onChange={handleSearchChange}
          className="w-full sm:max-w-xs p-2 border border-gray-600 rounded bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
          aria-label="Search tokens"
        />
        <div className="mt-2 sm:mt-0 sm:ml-4 flex space-x-2">
          <select
            onChange={e => requestSort(e.target.value)}
            className="p-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            aria-label="Sort tokens by"
          >
            <option value="">Sort By</option>
            <option value="marketCap">Market Cap</option>
            <option value="volume24h">Volume 24h</option>
            <option value="price">Price</option>
            <option value="liquidityScore">Liquidity Score</option>
            <option value="pumpDumpRiskScore">Pump/Dump Risk</option>
            <option value="walletDistributionScore">Wallet Dist Score</option>
          </select>
          <button
            onClick={showColumnModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
            aria-label="Customize table columns"
          >
            Add/Remove Columns
          </button>
          <button
            onClick={onFilterClick}
            className="px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-500"
            aria-label="Open filter drawer"
          >
            Filter
          </button>
          <button
            onClick={showSortModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 transition-colors flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500"
            aria-label="Open sort options"
          >
            <FaSort className="mr-1" /> Sort
          </button>
        </div>
      </div>
      <div className="overflow-x-auto">
        <div className="min-w-full">
          <div
            className="grid grid-cols-[minmax(80px,1fr)_minmax(100px,1fr)_minmax(100px,1fr)_minmax(100px,1fr)_minmax(120px,1fr)_minmax(100px,1fr)_minmax(120px,1fr)_minmax(120px,1fr)_minmax(120px,1fr)] gap-2 sticky top-0 bg-gray-900 z-10 p-2 text-white font-bold"
            role="row"
            aria-label="Table headers"
          >
            {columns.map(col => (
              <div
                key={col}
                className="text-sm truncate"
                role="columnheader"
                aria-sort={sortConfig?.key === col ? (sortConfig.direction === 'asc' ? 'ascending' : 'descending') : 'none'}
              >
                {col === 'symbol' ? 'Symbol' : 
                 col === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap Ratio' : 
                 col === 'isVolumeHealthy' ? 'Health' : 
                 col === 'pumpDumpRiskScore' ? 'Pump/Dump Risk' : 
                 col === 'walletDistributionScore' ? 'Wallet Dist Score' : 
                 col.charAt(0).toUpperCase() + col.slice(1).replace(/([A-Z])/g, ' $1')}
              </div>
            ))}
          </div>
          <div role="grid" aria-label="Token data table">
            <FixedSizeList
              height={400}
              itemCount={sortedTokens.length}
              itemSize={50}
              width="100%"
            >
              {Row}
            </FixedSizeList>
          </div>
        </div>
      </div>
      {isColumnModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
            <h2 className="text-lg font-bold text-white mb-4">Customize Table Columns</h2>
            {[
              'symbol',
              'price',
              'volume24h',
              'marketCap',
              'volumeMarketCapRatio',
              'isVolumeHealthy',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="flex items-center mb-2">
                <input
                  type="checkbox"
                  checked={visibleColumns.includes(key)}
                  onChange={() => toggleColumn(key)}
                  className="mr-2 h-4 w-4 text-green-500 bg-gray-700 border-gray-600 rounded focus:ring-green-500"
                  id={`column-${key}`}
                  aria-label={`Toggle ${key} column`}
                />
                <label htmlFor={`column-${key}`} className="text-white">
                  {key === 'symbol' ? 'Symbol' : 
                   key === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap Ratio' : 
                   key === 'isVolumeHealthy' ? 'Health' : 
                   key === 'pumpDumpRiskScore' ? 'Pump/Dump Risk' : 
                   key === 'walletDistributionScore' ? 'Wallet Dist Score' : 
                   key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}
                </label>
              </div>
            ))}
            <button
              onClick={handleColumnClose}
              className="w-full mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
              aria-label="Close column customization"
            >
              Done
            </button>
          </div>
        </div>
      )}
      {isSortModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
            <h2 className="text-lg font-bold text-white mb-4">Sort By</h2>
            {[
              'price',
              'marketCap',
              'volume24h',
              'volumeMarketCapRatio',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="mb-2">
                <button
                  onClick={() => requestSort(key)}
                  className="w-full text-left p-2 bg-gray-700 rounded hover:bg-gray-600 text-white flex justify-between focus:outline-none focus:ring-2 focus:ring-blue-500"
                  aria-label={`Sort by ${key}`}
                >
                  <span>{key === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap Ratio' : 
                         key === 'isVolumeHealthy' ? 'Health' : 
                         key === 'pumpDumpRiskScore' ? 'Pump/Dump Risk' : 
                         key === 'walletDistributionScore' ? 'Wallet Dist Score' : 
                         key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</span>
                  <span>{sortConfig?.key === key ? (sortConfig.direction === 'asc' ? 'â†‘' : 'â†“') : ''}</span>
                </button>
              </div>
            ))}
            <button
              onClick={handleSortClose}
              className="w-full mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
              aria-label="Close sort options"
            >
              Done
            </button>
          </div>
        </div>
      )}
      <FilterDrawer isOpen={isFilterDrawerOpen} onClose={onFilterClose} />
    </div>
  );
});

export default TokenTable;
=== .\components\WelcomeScreen.tsx ===
import React, { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import localforage from 'localforage';

const WelcomeScreen: React.FC<{ onFinish: () => void }> = ({ onFinish }) => {
  const [show, setShow] = useState(false);

  useEffect(() => {
    const checkLastVisit = async () => {
      const lastVisit = await localforage.getItem<number>('lastVisit');
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

      if (!lastVisit || now - lastVisit > oneDay) {
        setShow(true);
        await localforage.setItem('lastVisit', now);
      } else {
        onFinish();
      }
    };

    checkLastVisit();
  }, [onFinish]);

  if (!show) return null;

  return (
    <motion.div
      initial={{ opacity: 1 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 1 }}
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100vw',
        height: '100vh',
        background: '#001529',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        zIndex: 2000,
      }}
      onAnimationComplete={() => {
        setTimeout(() => {
          setShow(false);
          onFinish();
        }, 2000);
      }}
    >
      <motion.div
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: 'spring', stiffness: 260, damping: 20 }}
      >
        {/* Replace with your logo */}
        <div style={{ fontSize: 48, color: '#fff', fontWeight: 'bold' }}>
          Sunnalytics
        </div>
      </motion.div>
    </motion.div>
  );
};

export default WelcomeScreen;
=== .\hooks\useTokenData.ts ===
import { useEffect } from 'react';
   import useSWR from 'swr';
   import { useTokenStore } from '../stores/useTokenStore';

   interface Token {
     id: string;
     name: string;
     symbol: string;
     category: string;
     price?: number;
     marketCap?: number;
     volume24h?: number;
     transferVolume24h?: number;
     createdAt: string;
     updatedAt: string;
     volatilityScore24h?: number;
     fullyDilutedValuation?: number;
     volumeMarketCapRatio?: number;
     circulatingSupplyPercentage?: number;
     isVolumeHealthy?: boolean;
     isCirculatingSupplyGood?: boolean;
     potentialMultiplier?: number;
   }

   const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';
   const API_KEY = process.env.NEXT_PUBLIC_API_KEY;

   const fetcher = async (url: string) => {
     const headers: HeadersInit = {};
     if (API_KEY) {
       headers['Authorization'] = `Bearer ${API_KEY}`;
     }
     const res = await fetch(url, { headers });
     if (!res.ok) {
       throw new Error(`Failed to fetch: ${res.statusText}`);
     }
     const data = await res.json();
     return Array.isArray(data) ? data : [data];
   };

   export function useTokenData() {
     const { setTokens, setFilteredTokens, setLoading, setError, fetchTokens } = useTokenStore();

     const { data, error, isLoading } = useSWR<Token[]>(`${API_BASE_URL}/tokens`, fetcher, {
       revalidateOnFocus: false,
       revalidateOnReconnect: false,
     });

     useEffect(() => {
       setLoading(isLoading);
       if (error) {
         setError(error.message || 'An unknown error occurred');
       } else if (data) {
         setTokens(data);
         setFilteredTokens(data);
         setError(null);
       }
     }, [data, error, isLoading, setTokens, setFilteredTokens, setLoading, setError]);

     return { fetchTokens };
   }
=== .\pages\charts.tsx ===
import React from 'react';
import BottomNav from '../components/BottomNav';

export default function Charts() {
  return (
    <div className="min-h-screen flex flex-col pb-16 bg-gray-900 text-white">
      <header className="bg-gray-800 p-4">
        <h1 className="text-xl font-bold text-white">Charts</h1>
      </header>
      <main className="flex-1 p-4">
        <div className="text-gray-300">Charts Page - Coming Soon</div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
}
=== .\pages\index.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import TokenTable from '../components/TokenTable';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import TabbedFilters from '../components/TabbedFilters';

export default function Home() {
  const { loading, error } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const [isFilterDrawerOpen, setIsFilterDrawerOpen] = useState(false);

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const handleFilterClick = () => {
    setIsFilterDrawerOpen(true);
  };

  const handleFilterClose = () => {
    setIsFilterDrawerOpen(false);
  };

  return (
    <div className="min-h-screen flex flex-col pb-safe-area-inset-bottom bg-gray-900 text-white">
      <main className="flex-1 p-4">
        <div className="flex justify-between items-center mb-4">
          <h1 className="text-2xl font-bold">Market</h1>
          <div className="text-sm text-gray-400">Portfolio</div>
        </div>
        <TabbedFilters />
        {loading && <p className="text-center text-gray-400">Loading tokens...</p>}
        {error && (
          <p className="text-center text-red-500">
            Error: {error}{' '}
            <button onClick={fetchTokens} className="text-blue-500 underline">
              Retry
            </button>
          </p>
        )}
        {!loading && !error && (
          <TokenTable
            isFilterDrawerOpen={isFilterDrawerOpen}
            onFilterClick={handleFilterClick}
            onFilterClose={handleFilterClose}
          />
        )}
      </main>
      <BottomNav onFilterClick={handleFilterClick} />
    </div>
  );
}
=== .\pages\settings.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import localforage from 'localforage';

export default function Settings() {
  const [isMounted, setIsMounted] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    setIsMounted(true);
    localforage.getItem('darkMode').then(value => {
      const darkMode = value as boolean;
      setIsDarkMode(darkMode || false);
      if (darkMode) {
        document.documentElement.classList.add('dark');
      }
    });
  }, []);

  const toggleDarkMode = () => {
    const newDarkMode = !isDarkMode;
    setIsDarkMode(newDarkMode);
    localforage.setItem('darkMode', newDarkMode);
    if (newDarkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };

  const handleReset = () => {
    localforage.clear();
    setIsDarkMode(false);
    document.documentElement.classList.remove('dark');
  };

  if (!isMounted) return null;

  return (
    <div className="min-h-screen flex flex-col pb-16">
      <main className="flex-1 p-4">
        <h1 className="text-2xl font-bold mb-4">Settings</h1>
        <div className="mb-4 flex items-center justify-between">
          <span className="text-lg">Dark Mode</span>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={isDarkMode}
              onChange={toggleDarkMode}
              className="sr-only"
            />
            <div
              className={`w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 ${
                isDarkMode ? 'bg-blue-600' : ''
              }`}
            >
              <div
                className={`absolute w-5 h-5 bg-white rounded-full transition-transform duration-200 ease-in-out ${
                  isDarkMode ? 'translate-x-5' : 'translate-x-0'
                }`}
              ></div>
            </div>
          </label>
        </div>
        <button
          onClick={handleReset}
          className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
        >
          Reset All Settings
        </button>
      </main>
      <BottomNav />
    </div>
  );
}
=== .\pages\welcome.tsx ===
import { useEffect } from 'react';
import { useRouter } from 'next/router';
import localforage from 'localforage';

export default function Welcome() {
  const router = useRouter();

  useEffect(() => {
    localforage.getItem('welcomeScreenSeen').then(value => {
      if (value) {
        router.push('/');
      }
    });
  }, [router]);

  const handleContinue = () => {
    localforage.setItem('welcomeScreenSeen', true);
    router.push('/');
  };

  return (
    <div className="min-h-screen flex flex-col justify-center items-center bg-gray-100 p-4">
      <h1 className="text-3xl font-bold mb-4">Welcome to Sunnalytics</h1>
      <p className="text-lg text-gray-600 mb-6 text-center">
        Your go-to platform for token analytics and insights.
      </p>
      <button
        onClick={handleContinue}
        className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
      >
        Continue
      </button>
    </div>
  );
}
=== .\pages\_app.tsx ===
import '../styles/globals.css';
import type { AppProps } from 'next/app';
import { inter, robotoMono } from '../utils/fonts';
import Head from 'next/head';
import { useState, useEffect } from 'react';
import WelcomeScreen from '../components/WelcomeScreen';

export default function App({ Component, pageProps }: AppProps) {
  const [showWelcome, setShowWelcome] = useState(true);
  const INACTIVITY_THRESHOLD = 10 * 60 * 1000; // 10 minutes in milliseconds

  useEffect(() => {
    const lastActive = localStorage.getItem('lastActive');
    const now = new Date().getTime();

    if (lastActive) {
      const lastActiveTime = parseInt(lastActive, 10);
      const timeSinceLastActive = now - lastActiveTime;

      // Show welcome screen if inactive for more than INACTIVITY_THRESHOLD
      if (timeSinceLastActive > INACTIVITY_THRESHOLD) {
        setShowWelcome(true);
      } else {
        setShowWelcome(false);
      }
    } else {
      // First visit or no stored timestamp
      localStorage.setItem('lastActive', now.toString());
      setShowWelcome(true);
    }

    // Update last active timestamp when the app is interacted with
    const handleActivity = () => {
      localStorage.setItem('lastActive', now.toString());
    };

    window.addEventListener('mousemove', handleActivity);
    window.addEventListener('keydown', handleActivity);
    window.addEventListener('scroll', handleActivity);

    return () => {
      window.removeEventListener('mousemove', handleActivity);
      window.removeEventListener('keydown', handleActivity);
      window.removeEventListener('scroll', handleActivity);
    };
  }, []);

  const handleWelcomeFinish = () => {
    setShowWelcome(false);
  };

  return (
    <div className={`${inter.variable} ${robotoMono.variable}`}>
      <Head>
        <title>Sunnalytics</title>
        <meta name="description" content="Sunnalytics - Token Analytics Platform" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#111827" />
        <link rel="icon" href="/favicon.ico" sizes="any" />
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
        <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />
        <link rel="manifest" href="/site.webmanifest" />
      </Head>
      {showWelcome && <WelcomeScreen onFinish={handleWelcomeFinish} />}
      <Component {...pageProps} />
    </div>
  );
}
=== .\stores\useTokenStore.ts ===
import { create } from 'zustand';
import localforage from 'localforage';
import { persist, createJSONStorage } from 'zustand/middleware';

interface Token {
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

interface TokenState {
  tokens: Token[];
  filteredTokens: Token[];
  loading: boolean;
  error: string | null;
  setTokens: (tokens: Token[]) => void;
  setFilteredTokens: (tokens: Token[]) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  fetchTokens: () => void; // Kept for manual triggering if needed
}

export const useTokenStore = create<TokenState>()(
  persist(
    (set) => ({
      tokens: [],
      filteredTokens: [],
      loading: false,
      error: null,
      setTokens: (tokens: Token[]) => set({ tokens }),
      setFilteredTokens: (tokens: Token[]) => set({ filteredTokens: tokens }),
      setLoading: (loading: boolean) => set({ loading }),
      setError: (error: string | null) => set({ error }),
      fetchTokens: () => {}, // Placeholder, will be triggered by useTokenData
    }),
    {
      name: 'token-store',
      storage: createJSONStorage(() => localforage),
    }
  )
);
=== .\styles\globals.css ===
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --max-width: 1100px;
  --border-radius: 12px;
  --font-mono: var(--font-roboto-mono), ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono',
    'Roboto Mono', 'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro',
    'Fira Mono', 'Droid Sans Mono', 'Courier New', monospace;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
  font-family: var(--font-inter), system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
    'Helvetica Neue', Arial, sans-serif;
}

a {
  color: inherit;
  text-decoration: none;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}
=== .\utils\api.ts ===
import useSWR from 'swr';

const API_BASE_URL = 'https://sunnalytics-backend.onrender.com';

const fetcher = async (url: string) => {
  const res = await fetch(url);
  if (!res.ok) {
    const error = new Error('An error occurred while fetching the data.');
    throw error;
  }
  return res.json();
};

export function useTokens(category?: string) {
  const url = category
    ? `${API_BASE_URL}/tokens?category=${category}`
    : `${API_BASE_URL}/tokens`;
  const { data, error, isLoading } = useSWR(url, fetcher, {
    refreshInterval: 60000, // Refresh every minute
    revalidateOnFocus: false,
  });
  return { tokens: data, error, isLoading };
}

export async function refreshTokens() {
  const res = await fetch(`${API_BASE_URL}/tokens/refresh`, { method: 'POST' });
  if (!res.ok) {
    throw new Error('Failed to refresh tokens');
  }
  return res.json();
}

=== .\utils\fonts.ts ===
import { Inter, Roboto_Mono } from 'next/font/google';

export const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter',
});

export const robotoMono = Roboto_Mono({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-roboto-mono',
});
=== .\utils\tokenStats.ts ===
export interface TokenStats {
  priceChange24h: number;
  volatilityScore24h: number;
  liquidityScore: number;
  transferVolume24h: number;
}

export function calculateTokenStats(data: {
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  circulatingSupply: number | null;
  totalSupply: number | null;
  priceChange24h?: number | null;
  transferAmount?: number;
}): TokenStats {
  const { price, marketCap, volume24h, circulatingSupply, priceChange24h, transferAmount } = data;

  const change24h = priceChange24h ?? 0;
  const volatility = volume24h && marketCap ? (volume24h / marketCap) : 0;
  const liquidityScore = volume24h && circulatingSupply ? volume24h / circulatingSupply : 0;
  const transferVol24h = transferAmount ?? 0;

  return {
    priceChange24h: Number(change24h.toFixed(2)),
    volatilityScore24h: Number(volatility.toFixed(2)),
    liquidityScore: Number(liquidityScore.toFixed(2)),
    transferVolume24h: Number(transferVol24h.toFixed(2)),
  };
}

=== .\tailwind.config.js ===
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
=== .\tree.txt ===
Project Tree (excluding node_modules, .next, package-lock.json):

â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ all_files_combined.txt
â”œâ”€â”€ combine_files.py
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”œâ”€â”€ FilterDrawer.tsx
â”‚   â”œâ”€â”€ TokenTable.tsx
â”‚   â””â”€â”€ WelcomeScreen.tsx
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ generate_tree.py
â”œâ”€â”€ hooks
â”‚   â””â”€â”€ useTokenData.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ _app.tsx
â”‚   â”œâ”€â”€ api
â”‚   â”œâ”€â”€ charts.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â”œâ”€â”€ settings.tsx
â”‚   â””â”€â”€ welcome.tsx
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ src
â”œâ”€â”€ stores
â”‚   â””â”€â”€ useTokenStore.ts
â”œâ”€â”€ styles
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tree.txt
â”œâ”€â”€ tsconfig.json
â””â”€â”€ utils
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ fonts.ts
    â””â”€â”€ tokenStats.ts
=== .\tsconfig.json ===
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", "postcss.config.js"],
  "exclude": ["node_modules"]
}

=== .\components\BottomNav.tsx ===
import React from 'react';
import { useRouter } from 'next/router';
import { FaChartLine, FaFilter, FaWallet, FaHome } from 'react-icons/fa';

interface BottomNavProps {
  onFilterClick?: () => void;
}

const BottomNav: React.FC<BottomNavProps> = ({ onFilterClick }) => {
  const router = useRouter();

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-gray-800 h-20 p-2 flex justify-around items-center border-t border-gray-700 shadow-lg pb-safe-area-inset-bottom">
      <button
        onClick={() => router.push('/')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaHome className="text-lg mb-1" />
        <span>Market</span>
      </button>
      <button
        onClick={() => router.push('/portfolio')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/portfolio' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaWallet className="text-lg mb-1" />
        <span>Portfolio</span>
      </button>
      <button
        onClick={onFilterClick}
        className="flex flex-col items-center text-xs text-gray-400 hover:text-yellow-400 transition-all duration-200 hover:scale-110"
      >
        <FaFilter className="text-lg mb-1" />
        <span>Filter</span>
      </button>
      <button
        onClick={() => router.push('/charts')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/charts' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaChartLine className="text-lg mb-1" />
        <span>Charts</span>
      </button>
    </nav>
  );
};

export default BottomNav;
=== .\components\FilterDrawer.tsx ===
import React, { useState, useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';

interface FilterDrawerProps {
  isOpen: boolean;
  onClose: () => void;
}

const FilterDrawer: React.FC<FilterDrawerProps> = ({ isOpen, onClose }) => {
  const { filteredTokens, setFilteredTokens, tokens } = useTokenStore();
  const [filters, setFilters] = useState({
    category: '',
    minPrice: '',
    maxPrice: '',
    minVolumeMarketCapRatio: '',
    maxVolumeMarketCapRatio: '',
    minCirculatingSupplyPercentage: '',
    maxCirculatingSupplyPercentage: '',
    isVolumeHealthy: '',
    isCirculatingSupplyGood: '',
  });

  useEffect(() => {
    const applyFilters = () => {
      let filtered = [...tokens];
      if (filters.category) {
        filtered = filtered.filter(token => token.category === filters.category);
      }
      if (filters.minPrice) {
        const min = parseFloat(filters.minPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price >= min);
      }
      if (filters.maxPrice) {
        const max = parseFloat(filters.maxPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price <= max);
      }
      if (filters.minVolumeMarketCapRatio) {
        const min = parseFloat(filters.minVolumeMarketCapRatio) / 100; // Convert percentage to ratio
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio >= min);
      }
      if (filters.maxVolumeMarketCapRatio) {
        const max = parseFloat(filters.maxVolumeMarketCapRatio) / 100; // Convert percentage to ratio
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio <= max);
      }
      if (filters.minCirculatingSupplyPercentage) {
        const min = parseFloat(filters.minCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage >= min);
      }
      if (filters.maxCirculatingSupplyPercentage) {
        const max = parseFloat(filters.maxCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage <= max);
      }
      if (filters.isVolumeHealthy === 'true') {
        filtered = filtered.filter(token => token.isVolumeHealthy === true);
      } else if (filters.isVolumeHealthy === 'false') {
        filtered = filtered.filter(token => token.isVolumeHealthy === false);
      }
      if (filters.isCirculatingSupplyGood === 'true') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === true);
      } else if (filters.isCirculatingSupplyGood === 'false') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === false);
      }
      setFilteredTokens(filtered);
    };

    applyFilters();
  }, [filters, tokens, setFilteredTokens]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFilters(prev => ({ ...prev, [name]: value }));
  };

  const handleReset = () => {
    setFilters({
      category: '',
      minPrice: '',
      maxPrice: '',
      minVolumeMarketCapRatio: '',
      maxVolumeMarketCapRatio: '',
      minCirculatingSupplyPercentage: '',
      maxCirculatingSupplyPercentage: '',
      isVolumeHealthy: '',
      isCirculatingSupplyGood: '',
    });
    setFilteredTokens(tokens);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
      <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
        <h2 className="text-lg font-bold text-white mb-4">Filter Tokens</h2>
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-300">Category</label>
            <select
              name="category"
              value={filters.category}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="altcoin">Altcoin</option>
              <option value="defi">DeFi</option>
              <option value="memecoin">Memecoin</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Price ($)</label>
            <input
              type="number"
              name="minPrice"
              value={filters.minPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Price ($)</label>
            <input
              type="number"
              name="maxPrice"
              value={filters.maxPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Volume Market Cap Ratio (%)</label>
            <input
              type="number"
              name="minVolumeMarketCapRatio"
              value={filters.minVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Volume Market Cap Ratio (%)</label>
            <input
              type="number"
              name="maxVolumeMarketCapRatio"
              value={filters.maxVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Circulating Supply (%)</label>
            <input
              type="number"
              name="minCirculatingSupplyPercentage"
              value={filters.minCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Circulating Supply (%)</label>
            <input
              type="number"
              name="maxCirculatingSupplyPercentage"
              value={filters.maxCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Volume Healthy</label>
            <select
              name="isVolumeHealthy"
              value={filters.isVolumeHealthy}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Circulating Supply Good</label>
            <select
              name="isCirculatingSupplyGood"
              value={filters.isCirculatingSupplyGood}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>
        <div className="mt-6 flex justify-end space-x-4">
          <button
            onClick={handleReset}
            className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-500 transition-colors"
          >
            Reset
          </button>
          <button
            onClick={onClose}
            className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors"
          >
            Apply
          </button>
        </div>
      </div>
    </div>
  );
};

export default FilterDrawer;
=== .\components\TabbedFilters.tsx ===
// components/TabbedFilters.tsx
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useTokenStore } from '../stores/useTokenStore';

const tabs = [
  { id: 'all', label: 'All' },
  { id: 'highlights', label: 'Highlights', badge: 'ðŸ”¥' },
  { id: 'trending', label: 'Trending', badge: 'ðŸ“ˆ' },
  { id: 'pumpfun', label: 'Pump.fun' },
  { id: 'ecosystems', label: 'Ecosystems' },
];

const TabbedFilters: React.FC = () => {
  const { setFilteredTokens, tokens } = useTokenStore();
  const [activeTab, setActiveTab] = useState('all');

  const handleTabClick = (tabId: string) => {
    setActiveTab(tabId);
    if (tabId === 'all') {
      setFilteredTokens(tokens);
    } else {
      setFilteredTokens(tokens.filter(token => token.category.toLowerCase() === tabId));
    }
  };

  return (
    <div className="mb-4">
      <div
        className="flex space-x-2 overflow-x-auto pb-2"
        role="tablist"
        aria-label="Token Categories"
      >
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => handleTabClick(tab.id)}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              activeTab === tab.id
                ? 'bg-yellow-500 text-black'
                : 'bg-gray-700 text-white hover:bg-gray-600'
            }`}
            role="tab"
            aria-selected={activeTab === tab.id}
            aria-controls={`panel-${tab.id}`}
          >
            {tab.label}
            {tab.badge && <span className="ml-1">{tab.badge}</span>}
          </button>
        ))}
      </div>
      <AnimatePresence>
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -10 }}
          transition={{ duration: 0.3 }}
          id={`panel-${activeTab}`}
          role="tabpanel"
          aria-labelledby={activeTab}
        >
          {/* Content managed by TokenTable */}
        </motion.div>
      </AnimatePresence>
    </div>
  );
};

export default TabbedFilters;
=== .\components\TokenDetails.tsx ===
import React, { useState } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../utils/api';
import BottomNav from './BottomNav';
import { formatNumber } from './TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);

  React.useEffect(() => {
    if (id) {
      fetch(`/api/tokens/${id}/history`)
        .then(res => res.json())
        .then(data => setHistory(data))
        .catch(err => console.error('Error fetching history:', err));
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  const chartData = {
    labels: history.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Price (USD)',
        data: history.map(h => h.price || 0),
        borderColor: '#FBBF24',
        backgroundColor: 'rgba(251, 191, 36, 0.2)',
        fill: true,
        tension: 0.4,
      },
    ],
  };

  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        type: 'time' as const,
        time: {
          unit: 'day' as const, // Explicitly set to 'day'
          tooltipFormat: 'MMM d, yyyy HH:mm',
        },
        title: {
          display: true,
          text: 'Date',
          color: '#fff',
        },
      },
      y: {
        title: {
          display: true,
          text: 'Price (USD)',
          color: '#fff',
        },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: {
        labels: {
          color: '#fff',
        },
      },
      tooltip: {
        callbacks: {
          label: (context: any) => `Price: $${context.parsed.y.toFixed(2)}`,
          title: (tooltipItems: any[]) => {
            return new Date(tooltipItems[0].parsed.x).toLocaleString();
          },
        },
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col pb-16 bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button
          onClick={() => router.back()}
          className="mr-4 text-yellow-400 hover:text-yellow-300"
          aria-label="Go back"
        >
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4 space-y-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg shadow">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg shadow h-80">
            <h2 className="text-lg font-semibold mb-2">Price History</h2>
            <div className="h-64">
              <Line data={chartData} options={chartOptions} />
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\components\TokenTable.tsx ===
import React, { useState, useMemo, memo, useCallback } from 'react';
import { useRouter } from 'next/router';
import { useTokenStore } from '../stores/useTokenStore';
import FilterDrawer from './FilterDrawer';
import { FaSort } from 'react-icons/fa';
import { FixedSizeList } from 'react-window';
import debounce from 'lodash.debounce';

// Define Token interface locally to ensure id is included
interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
}

interface TokenTableProps {
  isFilterDrawerOpen: boolean;
  onFilterClick: () => void;
  onFilterClose: () => void;
}

export function formatNumber(value: number | undefined, suffix: string = ''): string {
  if (value === undefined || value === 0) return '-';
  if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
  if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
  return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
}

const TokenTable: React.FC<TokenTableProps> = memo(({ isFilterDrawerOpen, onFilterClick, onFilterClose }) => {
  const router = useRouter();
  const { filteredTokens, setFilteredTokens, tokens } = useTokenStore();
  const [searchQuery, setSearchQuery] = useState('');
  const [visibleColumns, setVisibleColumns] = useState<string[]>([
    'symbol',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ]);
  const [isColumnModalVisible, setIsColumnModalVisible] = useState(false);
  const [isSortModalVisible, setIsSortModalVisible] = useState(false);
  const [sortConfig, setSortConfig] = useState<{ key: keyof Token; direction: 'asc' | 'desc' } | null>(null);

  const toggleColumn = (key: string) => {
    setVisibleColumns(prev =>
      prev.includes(key) ? prev.filter(col => col !== key) : [...prev, key]
    );
  };

  const debouncedSearch = useCallback(
    debounce((query: string) => {
      setFilteredTokens(
        tokens.filter(
          token =>
            token.name.toLowerCase().includes(query.toLowerCase()) ||
            token.symbol.toLowerCase().includes(query.toLowerCase())
        )
      );
    }, 300),
    [tokens, setFilteredTokens]
  );

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const query = e.target.value;
    setSearchQuery(query);
    debouncedSearch(query);
  };

  const showColumnModal = () => {
    setIsColumnModalVisible(true);
  };

  const handleColumnClose = () => {
    setIsColumnModalVisible(false);
  };

  const showSortModal = () => {
    setIsSortModalVisible(true);
  };

  const handleSortClose = () => {
    setIsSortModalVisible(false);
  };

  const requestSort = (key: keyof Token) => {
    setSortConfig(prev => {
      if (!prev || prev.key !== key) {
        return { key, direction: 'asc' as const };
      }
      return prev.direction === 'asc' ? { key, direction: 'desc' as const } : null;
    });
    handleSortClose();
  };

  // Explicitly type sortedTokens as Token[]
  const sortedTokens: Token[] = useMemo(() => {
    if (!sortConfig) return filteredTokens as Token[];
    return [...filteredTokens].sort((a: Token, b: Token) => {
      const aValue = a[sortConfig.key];
      const bValue = b[sortConfig.key];
      if (aValue === undefined || bValue === undefined) return 0;
      if (typeof aValue === 'string' && typeof bValue === 'string') {
        return sortConfig.direction === 'asc'
          ? aValue.localeCompare(bValue)
          : bValue.localeCompare(aValue);
      }
      if (typeof aValue === 'number' && typeof bValue === 'number') {
        return sortConfig.direction === 'asc' ? aValue - bValue : bValue - aValue;
      }
      if (typeof aValue === 'boolean' && typeof bValue === 'boolean') {
        return sortConfig.direction === 'asc'
          ? Number(aValue) - Number(bValue)
          : Number(bValue) - Number(aValue);
      }
      return 0;
    });
  }, [filteredTokens, sortConfig]);

  const columns = [
    'symbol',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ].filter(col => visibleColumns.includes(col));

  const formatRatio = (value: number | undefined) => value !== undefined ? `${(value * 100).toFixed(2)}%` : '-';
  const formatBoolean = (value: boolean | undefined) => value !== undefined ? (value ? 'Yes' : 'No') : '-';
  const formatScore = (value: number | undefined) => value !== undefined ? value.toFixed(2) : '-';

  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => {
    const token: Token = sortedTokens[index];
    return (
      <div
        style={style}
        className="bg-gray-800 p-2 flex items-center space-x-4 text-white rounded shadow-sm hover:bg-gray-700 transition-colors cursor-pointer"
        role="row"
        aria-label={`Token ${token.symbol}`}
        onClick={() => router.push(`/tokens/${token.id}`)}
      >
        {columns.map(col => (
          <div key={col} className="flex-1 text-sm truncate" role="cell">
            {col === 'symbol' ? (
              <span className="font-semibold">{token.symbol}</span>
            ) : col === 'price' ? (
              <button className="bg-green-500 text-black px-2 py-1 rounded hover:bg-green-400 transition-colors">
                Buy ${formatNumber(token.price)}
              </button>
            ) : col === 'volume24h' ? (
              formatNumber(token.volume24h)
            ) : col === 'marketCap' ? (
              formatNumber(token.marketCap)
            ) : col === 'volumeMarketCapRatio' ? (
              formatRatio(token.volumeMarketCapRatio)
            ) : col === 'isVolumeHealthy' ? (
              formatBoolean(token.isVolumeHealthy)
            ) : col === 'pumpDumpRiskScore' ? (
              formatScore(token.pumpDumpRiskScore)
            ) : col === 'liquidityScore' ? (
              formatScore(token.liquidityScore)
            ) : col === 'walletDistributionScore' ? (
              formatScore(token.walletDistributionScore)
            ) : (
              '-'
            )}
          </div>
        ))}
      </div>
    );
  };

  return (
    <div className="p-4 space-y-4">
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <input
          type="text"
          placeholder="Search tokens..."
          value={searchQuery}
          onChange={handleSearchChange}
          className="w-full sm:max-w-xs p-2 border border-gray-600 rounded bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
          aria-label="Search tokens"
        />
        <div className="flex flex-wrap gap-2">
          <select
            onChange={e => requestSort(e.target.value as keyof Token)}
            className="p-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Sort tokens by"
          >
            <option value="">Sort By</option>
            <option value="marketCap">Market Cap</option>
            <option value="volume24h">Volume 24h</option>
            <option value="price">Price</option>
            <option value="liquidityScore">Liquidity Score</option>
            <option value="pumpDumpRiskScore">Pump/Dump Risk</option>
            <option value="walletDistributionScore">Wallet Dist Score</option>
          </select>
          <button
            onClick={showColumnModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Customize table columns"
          >
            Columns
          </button>
          <button
            onClick={onFilterClick}
            className="px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Open filter drawer"
          >
            Filter
          </button>
          <button
            onClick={showSortModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 flex items-center focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Open sort options"
          >
            <FaSort className="mr-1" /> Sort
          </button>
        </div>
      </div>
      <div className="overflow-x-auto rounded-lg shadow-lg">
        <div className="min-w-full">
          <div
            className="grid grid-cols-[minmax(80px,1fr)_minmax(100px,1fr)_minmax(100px,1fr)_minmax(100px,1fr)_minmax(120px,1fr)_minmax(100px,1fr)_minmax(120px,1fr)_minmax(120px,1fr)_minmax(120px,1fr)] gap-2 sticky top-0 bg-gray-800 z-10 p-2 text-white font-bold border-b border-gray-700"
            role="row"
            aria-label="Table headers"
          >
            {columns.map(col => (
              <div
                key={col}
                className="text-sm truncate"
                role="columnheader"
                aria-sort={sortConfig?.key === col ? (sortConfig.direction === 'asc' ? 'ascending' : 'descending') : 'none'}
              >
                {col === 'symbol' ? 'Symbol' : 
                 col === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap' : 
                 col === 'isVolumeHealthy' ? 'Health' : 
                 col === 'pumpDumpRiskScore' ? 'Risk' : 
                 col === 'walletDistributionScore' ? 'Wallet Score' : 
                 col.charAt(0).toUpperCase() + col.slice(1).replace(/([A-Z])/g, ' $1')}
              </div>
            ))}
          </div>
          <div role="grid" aria-label="Token data table" className="bg-gray-900">
            <FixedSizeList
              height={400}
              itemCount={sortedTokens.length}
              itemSize={50}
              width="100%"
            >
              {Row}
            </FixedSizeList>
          </div>
        </div>
      </div>
      {isColumnModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl">
            <h2 className="text-lg font-bold text-white mb-4">Customize Columns</h2>
            {[
              'symbol',
              'price',
              'volume24h',
              'marketCap',
              'volumeMarketCapRatio',
              'isVolumeHealthy',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="flex items-center mb-3">
                <input
                  type="checkbox"
                  checked={visibleColumns.includes(key)}
                  onChange={() => toggleColumn(key)}
                  className="mr-2 h-4 w-4 text-yellow-500 bg-gray-700 border-gray-600 rounded focus:ring-yellow-500"
                  id={`column-${key}`}
                  aria-label={`Toggle ${key} column`}
                />
                <label htmlFor={`column-${key}`} className="text-white text-sm">
                  {key === 'symbol' ? 'Symbol' : 
                   key === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap' : 
                   key === 'isVolumeHealthy' ? 'Health' : 
                   key === 'pumpDumpRiskScore' ? 'Risk' : 
                   key === 'walletDistributionScore' ? 'Wallet Score' : 
                   key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}
                </label>
              </div>
            ))}
            <button
              onClick={handleColumnClose}
              className="w-full mt-4 px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
              aria-label="Close column customization"
            >
              Done
            </button>
          </div>
        </div>
      )}
      {isSortModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl">
            <h2 className="text-lg font-bold text-white mb-4">Sort By</h2>
            {[
              'price',
              'marketCap',
              'volume24h',
              'volumeMarketCapRatio',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="mb-3">
                <button
                  onClick={() => requestSort(key as keyof Token)}
                  className="w-full text-left p-2 bg-gray-700 rounded hover:bg-gray-600 text-white flex justify-between focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
                  aria-label={`Sort by ${key}`}
                >
                  <span>{key === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap' : 
                         key === 'isVolumeHealthy' ? 'Health' : 
                         key === 'pumpDumpRiskScore' ? 'Risk' : 
                         key === 'walletDistributionScore' ? 'Wallet Score' : 
                         key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</span>
                  <span>{sortConfig?.key === key ? (sortConfig.direction === 'asc' ? 'â†‘' : 'â†“') : ''}</span>
                </button>
              </div>
            ))}
            <button
              onClick={handleSortClose}
              className="w-full mt-4 px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
              aria-label="Close sort options"
            >
              Done
            </button>
          </div>
        </div>
      )}
      <FilterDrawer isOpen={isFilterDrawerOpen} onClose={onFilterClose} />
    </div>
  );
});

export default TokenTable;
=== .\components\WelcomeScreen.tsx ===
import React, { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import localforage from 'localforage';

const WelcomeScreen: React.FC<{ onFinish: () => void }> = ({ onFinish }) => {
  const [show, setShow] = useState(false);

  useEffect(() => {
    const checkLastVisit = async () => {
      const lastVisit = await localforage.getItem<number>('lastVisit');
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

      if (!lastVisit || now - lastVisit > oneDay) {
        setShow(true);
        await localforage.setItem('lastVisit', now);
      } else {
        onFinish();
      }
    };

    checkLastVisit();
  }, [onFinish]);

  if (!show) return null;

  return (
    <motion.div
      initial={{ opacity: 1 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 1 }}
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100vw',
        height: '100vh',
        background: '#001529',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        zIndex: 2000,
      }}
      onAnimationComplete={() => {
        setTimeout(() => {
          setShow(false);
          onFinish();
        }, 2000);
      }}
    >
      <motion.div
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: 'spring', stiffness: 260, damping: 20 }}
      >
        {/* Replace with your logo */}
        <div style={{ fontSize: 48, color: '#fff', fontWeight: 'bold' }}>
          Sunnalytics
        </div>
      </motion.div>
    </motion.div>
  );
};

export default WelcomeScreen;
=== .\hooks\useTokenData.ts ===
import { useEffect } from 'react';
import useSWR from 'swr';
import { useTokenStore } from '../stores/useTokenStore';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  createdAt: string;
  updatedAt: string;
  volatilityScore24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
}

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';
const API_KEY = process.env.NEXT_PUBLIC_API_KEY;

const fetcher = async (url: string) => {
  const headers: HeadersInit = {};
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    throw new Error(`Failed to fetch: ${res.statusText}`);
  }
  const data = await res.json();
  return Array.isArray(data) ? data : [data];
};

export function useTokenData() {
  const { setTokens, setFilteredTokens, setLoading, setError, fetchTokens } = useTokenStore();

  const { data, error, isLoading } = useSWR<Token[]>(`${API_BASE_URL}/api/tokens`, fetcher, {
    revalidateOnFocus: false,
    revalidateOnReconnect: false,
  });

  useEffect(() => {
    setLoading(isLoading);
    if (error) {
      setError(error.message || 'An unknown error occurred');
    } else if (data) {
      setTokens(data);
      setFilteredTokens(data);
      setError(null);
    }
  }, [data, error, isLoading, setTokens, setFilteredTokens, setLoading, setError]);

  return { fetchTokens };
}
=== .\pages\charts.tsx ===
import React from 'react';
import BottomNav from '../components/BottomNav';

export default function Charts() {
  return (
    <div className="min-h-screen flex flex-col pb-16 bg-gray-900 text-white">
      <header className="bg-gray-800 p-4">
        <h1 className="text-xl font-bold text-white">Charts</h1>
      </header>
      <main className="flex-1 p-4">
        <div className="text-gray-300">Charts Page - Coming Soon</div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
}
=== .\pages\index.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import TokenTable from '../components/TokenTable';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import TabbedFilters from '../components/TabbedFilters';

export default function Home() {
  const { loading, error } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const [isFilterDrawerOpen, setIsFilterDrawerOpen] = useState(false);

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const handleFilterClick = () => {
    setIsFilterDrawerOpen(true);
  };

  const handleFilterClose = () => {
    setIsFilterDrawerOpen(false);
  };

  return (
    <div className="min-h-screen flex flex-col pb-safe-area-inset-bottom bg-gray-900 text-white">
      <main className="flex-1 p-4">
        <div className="flex justify-between items-center mb-4">
          <h1 className="text-2xl font-bold">Market</h1>
          <div className="text-sm text-gray-400">Portfolio</div>
        </div>
        <TabbedFilters />
        {loading && <p className="text-center text-gray-400">Loading tokens...</p>}
        {error && (
          <p className="text-center text-red-500">
            Error: {error}{' '}
            <button onClick={fetchTokens} className="text-blue-500 underline">
              Retry
            </button>
          </p>
        )}
        {!loading && !error && (
          <TokenTable
            isFilterDrawerOpen={isFilterDrawerOpen}
            onFilterClick={handleFilterClick}
            onFilterClose={handleFilterClose}
          />
        )}
      </main>
      <BottomNav onFilterClick={handleFilterClick} />
    </div>
  );
}
=== .\pages\settings.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import localforage from 'localforage';

export default function Settings() {
  const [isMounted, setIsMounted] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    setIsMounted(true);
    localforage.getItem('darkMode').then(value => {
      const darkMode = value as boolean;
      setIsDarkMode(darkMode || false);
      if (darkMode) {
        document.documentElement.classList.add('dark');
      }
    });
  }, []);

  const toggleDarkMode = () => {
    const newDarkMode = !isDarkMode;
    setIsDarkMode(newDarkMode);
    localforage.setItem('darkMode', newDarkMode);
    if (newDarkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };

  const handleReset = () => {
    localforage.clear();
    setIsDarkMode(false);
    document.documentElement.classList.remove('dark');
  };

  if (!isMounted) return null;

  return (
    <div className="min-h-screen flex flex-col pb-16">
      <main className="flex-1 p-4">
        <h1 className="text-2xl font-bold mb-4">Settings</h1>
        <div className="mb-4 flex items-center justify-between">
          <span className="text-lg">Dark Mode</span>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={isDarkMode}
              onChange={toggleDarkMode}
              className="sr-only"
            />
            <div
              className={`w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 ${
                isDarkMode ? 'bg-blue-600' : ''
              }`}
            >
              <div
                className={`absolute w-5 h-5 bg-white rounded-full transition-transform duration-200 ease-in-out ${
                  isDarkMode ? 'translate-x-5' : 'translate-x-0'
                }`}
              ></div>
            </div>
          </label>
        </div>
        <button
          onClick={handleReset}
          className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
        >
          Reset All Settings
        </button>
      </main>
      <BottomNav />
    </div>
  );
}
=== .\pages\welcome.tsx ===
import { useEffect } from 'react';
import { useRouter } from 'next/router';
import localforage from 'localforage';

export default function Welcome() {
  const router = useRouter();

  useEffect(() => {
    localforage.getItem('welcomeScreenSeen').then(value => {
      if (value) {
        router.push('/');
      }
    });
  }, [router]);

  const handleContinue = () => {
    localforage.setItem('welcomeScreenSeen', true);
    router.push('/');
  };

  return (
    <div className="min-h-screen flex flex-col justify-center items-center bg-gray-100 p-4">
      <h1 className="text-3xl font-bold mb-4">Welcome to Sunnalytics</h1>
      <p className="text-lg text-gray-600 mb-6 text-center">
        Your go-to platform for token analytics and insights.
      </p>
      <button
        onClick={handleContinue}
        className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
      >
        Continue
      </button>
    </div>
  );
}
=== .\pages\_app.tsx ===
import '../styles/globals.css';
import type { AppProps } from 'next/app';
import { inter, robotoMono } from '../utils/fonts';
import Head from 'next/head';
import { useState, useEffect } from 'react';
import WelcomeScreen from '../components/WelcomeScreen';

export default function App({ Component, pageProps }: AppProps) {
  const [showWelcome, setShowWelcome] = useState(true);
  const INACTIVITY_THRESHOLD = 10 * 60 * 1000; // 10 minutes in milliseconds

  useEffect(() => {
    const lastActive = localStorage.getItem('lastActive');
    const now = new Date().getTime();

    if (lastActive) {
      const lastActiveTime = parseInt(lastActive, 10);
      const timeSinceLastActive = now - lastActiveTime;

      // Show welcome screen if inactive for more than INACTIVITY_THRESHOLD
      if (timeSinceLastActive > INACTIVITY_THRESHOLD) {
        setShowWelcome(true);
      } else {
        setShowWelcome(false);
      }
    } else {
      // First visit or no stored timestamp
      localStorage.setItem('lastActive', now.toString());
      setShowWelcome(true);
    }

    // Update last active timestamp when the app is interacted with
    const handleActivity = () => {
      localStorage.setItem('lastActive', now.toString());
    };

    window.addEventListener('mousemove', handleActivity);
    window.addEventListener('keydown', handleActivity);
    window.addEventListener('scroll', handleActivity);

    return () => {
      window.removeEventListener('mousemove', handleActivity);
      window.removeEventListener('keydown', handleActivity);
      window.removeEventListener('scroll', handleActivity);
    };
  }, []);

  const handleWelcomeFinish = () => {
    setShowWelcome(false);
  };

  return (
    <div className={`${inter.variable} ${robotoMono.variable}`}>
      <Head>
        <title>Sunnalytics</title>
        <meta name="description" content="Sunnalytics - Token Analytics Platform" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#111827" />
        <link rel="icon" href="/favicon.ico" sizes="any" />
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
        <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />
        <link rel="manifest" href="/site.webmanifest" />
      </Head>
      {showWelcome && <WelcomeScreen onFinish={handleWelcomeFinish} />}
      <Component {...pageProps} />
    </div>
  );
}
=== .\pages\tokens\[id].tsx ===
import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend, ChartOptions } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../../utils/api';
import BottomNav from '../../components/BottomNav';
import { formatNumber } from '../../components/TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);
  const [apiError, setApiError] = useState<string | null>(null);

  // Replace with your backend URL, e.g., 'https://your-backend.com'
  const BACKEND_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';

  useEffect(() => {
    if (id) {
      const url = `${BACKEND_URL}/api/tokens/${id}/history`;
      console.log(`Fetching history from: ${url}`);
      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          console.log('Token history data:', data);
          setHistory(data);
          setApiError(null);
        })
        .catch(err => {
          console.error('Error fetching history:', err.message);
          setApiError(err.message);
        });
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  // Group by date, minimal filtering
  const validHistory = history
    .filter(h => h.price != null && h.volume24h != null && h.marketCap != null && h.marketCap !== 0)
    .reduce((acc: TokenHistory[], h) => {
      const date = new Date(h.timestamp).toISOString().split('T')[0];
      const existing = acc.find(item => new Date(item.timestamp).toISOString().split('T')[0] === date);
      if (!existing) acc.push(h);
      return acc;
    }, [])
    .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());

  console.log('Valid history:', validHistory);

  const chartData = {
    labels: validHistory.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Volume/Market Cap Ratio (%)',
        data: validHistory.map(h => (h.volume24h! / h.marketCap!) * 100),
        borderColor: '#FBBF24',
        yAxisID: 'y-ratio',
      },
      {
        label: 'Price (USD)',
        data: validHistory.map(h => h.price!),
        borderColor: '#3B82F6',
        yAxisID: 'y-price',
      },
    ],
  };

  const chartOptions: ChartOptions<'line'> = {
    responsive: true,
    scales: {
      x: {
        type: 'time',
        time: { unit: 'day' },
        title: { display: true, text: 'Date' },
      },
      'y-ratio': {
        type: 'linear',
        position: 'left',
        title: { display: true, text: 'Ratio (%)' },
        beginAtZero: true,
      },
      'y-price': {
        type: 'linear',
        position: 'right',
        title: { display: true, text: 'Price ($)' },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: { display: true },
      tooltip: { mode: 'index', intersect: false },
    },
  };

  console.log('Chart data:', chartData);

  return (
    <div className="min-h-screen flex flex-col bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button onClick={() => router.back()} className="mr-4 text-yellow-400">
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg h-80">
            <h2 className="text-lg font-semibold mb-2">Historical Data</h2>
            <div className="h-64">
              {apiError ? (
                <div className="text-center text-red-500 h-full flex items-center justify-center">
                  Error: {apiError}
                </div>
              ) : validHistory.length > 0 ? (
                <Line data={chartData} options={chartOptions} />
              ) : (
                <div className="text-center text-gray-400 h-full flex items-center justify-center">
                  No history data
                </div>
              )}
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\stores\useTokenStore.ts ===
import { create } from 'zustand';
import localforage from 'localforage';
import { persist, createJSONStorage } from 'zustand/middleware';

interface Token {
  id: string; // Added id
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

interface TokenState {
  tokens: Token[];
  filteredTokens: Token[];
  loading: boolean;
  error: string | null;
  setTokens: (tokens: Token[]) => void;
  setFilteredTokens: (tokens: Token[]) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  fetchTokens: () => void;
}

export const useTokenStore = create<TokenState>()(
  persist(
    (set) => ({
      tokens: [],
      filteredTokens: [],
      loading: false,
      error: null,
      setTokens: (tokens: Token[]) => set({ tokens }),
      setFilteredTokens: (tokens: Token[]) => set({ filteredTokens: tokens }),
      setLoading: (loading: boolean) => set({ loading }),
      setError: (error: string | null) => set({ error }),
      fetchTokens: () => {},
    }),
    {
      name: 'token-store',
      storage: createJSONStorage(() => localforage),
    }
  )
);
=== .\styles\globals.css ===
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --max-width: 1100px;
  --border-radius: 12px;
  --font-mono: var(--font-roboto-mono), ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono',
    'Roboto Mono', 'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro',
    'Fira Mono', 'Droid Sans Mono', 'Courier New', monospace;
  --primary-color: #FBBF24;
  --background-dark: #111827;
  --card-bg: #1F2A44;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
  font-family: var(--font-inter), system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
    'Helvetica Neue', Arial, sans-serif;
  background-color: var(--background-dark);
  color: #fff;
}

a {
  color: var(--primary-color);
  text-decoration: none;
}

button, input, select {
  transition: all 0.2s ease-in-out;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}
=== .\utils\api.ts ===
import useSWR from 'swr';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';

const fetcher = async (url: string) => {
  const res = await fetch(url);
  if (!res.ok) {
    const error = new Error('An error occurred while fetching the data.');
    throw error;
  }
  return res.json();
};

export function useTokens(category?: string) {
  const url = category
    ? `${API_BASE_URL}/api/tokens?category=${category}`
    : `${API_BASE_URL}/api/tokens`;
  const { data, error, isLoading } = useSWR(url, fetcher, {
    refreshInterval: 60000,
    revalidateOnFocus: false,
  });
  return { tokens: data, error, isLoading };
}

export async function refreshTokens() {
  const res = await fetch(`${API_BASE_URL}/api/tokens/refresh`, { method: 'POST' });
  if (!res.ok) {
    throw new Error('Failed to refresh tokens');
  }
  return res.json();
}
=== .\utils\fonts.ts ===
import { Inter, Roboto_Mono } from 'next/font/google';

export const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter',
});

export const robotoMono = Roboto_Mono({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-roboto-mono',
});
=== .\utils\tokenStats.ts ===
export interface TokenStats {
  priceChange24h: number;
  volatilityScore24h: number;
  liquidityScore: number;
  transferVolume24h: number;
}

export function calculateTokenStats(data: {
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  circulatingSupply: number | null;
  totalSupply: number | null;
  priceChange24h?: number | null;
  transferAmount?: number;
}): TokenStats {
  const { price, marketCap, volume24h, circulatingSupply, priceChange24h, transferAmount } = data;

  const change24h = priceChange24h ?? 0;
  const volatility = volume24h && marketCap ? (volume24h / marketCap) : 0;
  const liquidityScore = volume24h && circulatingSupply ? volume24h / circulatingSupply : 0;
  const transferVol24h = transferAmount ?? 0;

  return {
    priceChange24h: Number(change24h.toFixed(2)),
    volatilityScore24h: Number(volatility.toFixed(2)),
    liquidityScore: Number(liquidityScore.toFixed(2)),
    transferVolume24h: Number(transferVol24h.toFixed(2)),
  };
}

=== .\tailwind.config.js ===
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
=== .\tree.txt ===
Project Tree (excluding node_modules, .next, package-lock.json):

â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ all_files_combined.txt
â”œâ”€â”€ combine_files.py
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”œâ”€â”€ FilterDrawer.tsx
â”‚   â”œâ”€â”€ TabbedFilters.tsx
â”‚   â”œâ”€â”€ TokenDetails.tsx
â”‚   â”œâ”€â”€ TokenTable.tsx
â”‚   â””â”€â”€ WelcomeScreen.tsx
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ generate_tree.py
â”œâ”€â”€ hooks
â”‚   â””â”€â”€ useTokenData.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ _app.tsx
â”‚   â”œâ”€â”€ ai-picks.tsx
â”‚   â”œâ”€â”€ api
â”‚   â”œâ”€â”€ charts.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â”œâ”€â”€ settings.tsx
â”‚   â”œâ”€â”€ tokens
â”‚   â”‚   â””â”€â”€ [id].tsx
â”‚   â”œâ”€â”€ watchlist.tsx
â”‚   â””â”€â”€ welcome.tsx
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ src
â”œâ”€â”€ stores
â”‚   â””â”€â”€ useTokenStore.ts
â”œâ”€â”€ styles
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ sunnalytics-dev.txt
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tree.txt
â”œâ”€â”€ tsconfig.json
â””â”€â”€ utils
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ fonts.ts
    â””â”€â”€ tokenStats.ts
=== .\tsconfig.json ===
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", "postcss.config.js"],
  "exclude": ["node_modules"]
}

=== .\components\BottomNav.tsx ===
// components/BottomNav.tsx
import React from 'react';
import { useRouter } from 'next/router';
import { FaChartLine, FaFilter, FaSearch, FaHome, FaStar } from 'react-icons/fa';

interface BottomNavProps {
  onFilterClick?: () => void;
  onSearchFocus?: () => void;
}

const BottomNav: React.FC<BottomNavProps> = ({ onFilterClick, onSearchFocus }) => {
  const router = useRouter();

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-gray-800 h-20 p-2 flex justify-around items-center border-t border-gray-700 shadow-lg pb-safe-area-inset-bottom">
      <button
        onClick={() => router.push('/')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaHome className="text-lg mb-1" />
        <span>Market</span>
      </button>
      <button
        onClick={() => router.push('/watchlist')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/watchlist' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaStar className="text-lg mb-1" />
        <span>Watchlist</span>
      </button>
      <button
        onClick={onSearchFocus}
        className="flex flex-col items-center text-xs text-gray-400 hover:text-yellow-400 transition-all duration-200 hover:scale-110"
      >
        <FaSearch className="text-lg mb-1" />
        <span>Search</span>
      </button>
      <button
        onClick={() => router.push('/ai-picks')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/ai-picks' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaChartLine className="text-lg mb-1" />
        <span>AI Picks</span>
      </button>
      <button
        onClick={() => router.push('/charts')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/charts' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaChartLine className="text-lg mb-1" />
        <span>Charts</span>
      </button>
    </nav>
  );
};

export default BottomNav;
=== .\components\FilterDrawer.tsx ===
import React, { useState, useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';

interface FilterDrawerProps {
  isOpen: boolean;
  onClose: () => void;
}

const FilterDrawer: React.FC<FilterDrawerProps> = ({ isOpen, onClose }) => {
  const { filteredTokens, setFilteredTokens, tokens } = useTokenStore();
  const [filters, setFilters] = useState({
    category: '',
    minPrice: '',
    maxPrice: '',
    minVolumeMarketCapRatio: '',
    maxVolumeMarketCapRatio: '',
    minCirculatingSupplyPercentage: '',
    maxCirculatingSupplyPercentage: '',
    isVolumeHealthy: '',
    isCirculatingSupplyGood: '',
  });

  useEffect(() => {
    const applyFilters = () => {
      let filtered = [...tokens];
      if (filters.category) {
        filtered = filtered.filter(token => token.category === filters.category);
      }
      if (filters.minPrice) {
        const min = parseFloat(filters.minPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price >= min);
      }
      if (filters.maxPrice) {
        const max = parseFloat(filters.maxPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price <= max);
      }
      if (filters.minVolumeMarketCapRatio) {
        const min = parseFloat(filters.minVolumeMarketCapRatio) / 100; // Convert percentage to ratio
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio >= min);
      }
      if (filters.maxVolumeMarketCapRatio) {
        const max = parseFloat(filters.maxVolumeMarketCapRatio) / 100; // Convert percentage to ratio
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio <= max);
      }
      if (filters.minCirculatingSupplyPercentage) {
        const min = parseFloat(filters.minCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage >= min);
      }
      if (filters.maxCirculatingSupplyPercentage) {
        const max = parseFloat(filters.maxCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage <= max);
      }
      if (filters.isVolumeHealthy === 'true') {
        filtered = filtered.filter(token => token.isVolumeHealthy === true);
      } else if (filters.isVolumeHealthy === 'false') {
        filtered = filtered.filter(token => token.isVolumeHealthy === false);
      }
      if (filters.isCirculatingSupplyGood === 'true') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === true);
      } else if (filters.isCirculatingSupplyGood === 'false') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === false);
      }
      setFilteredTokens(filtered);
    };

    applyFilters();
  }, [filters, tokens, setFilteredTokens]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFilters(prev => ({ ...prev, [name]: value }));
  };

  const handleReset = () => {
    setFilters({
      category: '',
      minPrice: '',
      maxPrice: '',
      minVolumeMarketCapRatio: '',
      maxVolumeMarketCapRatio: '',
      minCirculatingSupplyPercentage: '',
      maxCirculatingSupplyPercentage: '',
      isVolumeHealthy: '',
      isCirculatingSupplyGood: '',
    });
    setFilteredTokens(tokens);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
      <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
        <h2 className="text-lg font-bold text-white mb-4">Filter Tokens</h2>
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-300">Category</label>
            <select
              name="category"
              value={filters.category}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="altcoin">Altcoin</option>
              <option value="defi">DeFi</option>
              <option value="memecoin">Memecoin</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Price ($)</label>
            <input
              type="number"
              name="minPrice"
              value={filters.minPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Price ($)</label>
            <input
              type="number"
              name="maxPrice"
              value={filters.maxPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Volume Market Cap Ratio (%)</label>
            <input
              type="number"
              name="minVolumeMarketCapRatio"
              value={filters.minVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Volume Market Cap Ratio (%)</label>
            <input
              type="number"
              name="maxVolumeMarketCapRatio"
              value={filters.maxVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Circulating Supply (%)</label>
            <input
              type="number"
              name="minCirculatingSupplyPercentage"
              value={filters.minCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Circulating Supply (%)</label>
            <input
              type="number"
              name="maxCirculatingSupplyPercentage"
              value={filters.maxCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Volume Healthy</label>
            <select
              name="isVolumeHealthy"
              value={filters.isVolumeHealthy}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Circulating Supply Good</label>
            <select
              name="isCirculatingSupplyGood"
              value={filters.isCirculatingSupplyGood}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>
        <div className="mt-6 flex justify-end space-x-4">
          <button
            onClick={handleReset}
            className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-500 transition-colors"
          >
            Reset
          </button>
          <button
            onClick={onClose}
            className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors"
          >
            Apply
          </button>
        </div>
      </div>
    </div>
  );
};

export default FilterDrawer;
=== .\components\TabbedFilters.tsx ===
// components/TabbedFilters.tsx
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useTokenStore } from '../stores/useTokenStore';

const tabs = [
  { id: 'all', label: 'All' },
  { id: 'highlights', label: 'Highlights', badge: 'ðŸ”¥' },
  { id: 'trending', label: 'Trending', badge: 'ðŸ“ˆ' },
  { id: 'pumpfun', label: 'Pump.fun' },
  { id: 'ecosystems', label: 'Ecosystems' },
];

const TabbedFilters: React.FC = () => {
  const { setFilteredTokens, tokens } = useTokenStore();
  const [activeTab, setActiveTab] = useState('all');

  const handleTabClick = (tabId: string) => {
    setActiveTab(tabId);
    if (tabId === 'all') {
      setFilteredTokens(tokens);
    } else {
      setFilteredTokens(tokens.filter(token => token.category.toLowerCase() === tabId));
    }
  };

  return (
    <div className="mb-4">
      <div
        className="flex space-x-2 overflow-x-auto pb-2"
        role="tablist"
        aria-label="Token Categories"
      >
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => handleTabClick(tab.id)}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              activeTab === tab.id
                ? 'bg-yellow-500 text-black'
                : 'bg-gray-700 text-white hover:bg-gray-600'
            }`}
            role="tab"
            aria-selected={activeTab === tab.id}
            aria-controls={`panel-${tab.id}`}
          >
            {tab.label}
            {tab.badge && <span className="ml-1">{tab.badge}</span>}
          </button>
        ))}
      </div>
      <AnimatePresence>
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -10 }}
          transition={{ duration: 0.3 }}
          id={`panel-${activeTab}`}
          role="tabpanel"
          aria-labelledby={activeTab}
        >
          {/* Content managed by TokenTable */}
        </motion.div>
      </AnimatePresence>
    </div>
  );
};

export default TabbedFilters;
=== .\components\TokenDetails.tsx ===
import React, { useState } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../utils/api';
import BottomNav from './BottomNav';
import { formatNumber } from './TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);

  React.useEffect(() => {
    if (id) {
      fetch(`/api/tokens/${id}/history`)
        .then(res => res.json())
        .then(data => setHistory(data))
        .catch(err => console.error('Error fetching history:', err));
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  const chartData = {
    labels: history.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Price (USD)',
        data: history.map(h => h.price || 0),
        borderColor: '#FBBF24',
        backgroundColor: 'rgba(251, 191, 36, 0.2)',
        fill: true,
        tension: 0.4,
      },
    ],
  };

  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        type: 'time' as const,
        time: {
          unit: 'day' as const, // Explicitly set to 'day'
          tooltipFormat: 'MMM d, yyyy HH:mm',
        },
        title: {
          display: true,
          text: 'Date',
          color: '#fff',
        },
      },
      y: {
        title: {
          display: true,
          text: 'Price (USD)',
          color: '#fff',
        },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: {
        labels: {
          color: '#fff',
        },
      },
      tooltip: {
        callbacks: {
          label: (context: any) => `Price: $${context.parsed.y.toFixed(2)}`,
          title: (tooltipItems: any[]) => {
            return new Date(tooltipItems[0].parsed.x).toLocaleString();
          },
        },
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col pb-16 bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button
          onClick={() => router.back()}
          className="mr-4 text-yellow-400 hover:text-yellow-300"
          aria-label="Go back"
        >
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4 space-y-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg shadow">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg shadow h-80">
            <h2 className="text-lg font-semibold mb-2">Price History</h2>
            <div className="h-64">
              <Line data={chartData} options={chartOptions} />
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\components\TokenTable.tsx ===
// components/TokenTable.tsx
import React, { useState, useEffect, useMemo, memo, useCallback } from 'react';
import { useRouter } from 'next/router';
import { useTokenStore } from '../stores/useTokenStore';
import FilterDrawer from './FilterDrawer';
import { FaSort, FaStar } from 'react-icons/fa';
import { FixedSizeList } from 'react-window';
import debounce from 'lodash.debounce';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
}

interface TokenTableProps {
  isFilterDrawerOpen: boolean;
  onFilterClick: () => void;
  onFilterClose: () => void;
  defaultMobileColumns: boolean;
}

export function formatNumber(value: number | undefined, suffix: string = ''): string {
  if (value === undefined || value === 0) return '-';
  if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
  if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
  return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
}

const TokenTable: React.FC<TokenTableProps> = memo(({ isFilterDrawerOpen, onFilterClick, onFilterClose, defaultMobileColumns }) => {
  const router = useRouter();
  const { filteredTokens, setFilteredTokens, tokens, watchlist, addToWatchlist } = useTokenStore();
  const [searchQuery, setSearchQuery] = useState('');
  const [visibleColumns, setVisibleColumns] = useState<string[]>([
    'symbol',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ]);

  const [isColumnModalVisible, setIsColumnModalVisible] = useState(false);
  const [isSortModalVisible, setIsSortModalVisible] = useState(false);
  const [sortConfig, setSortConfig] = useState<{ key: keyof Token; direction: 'asc' | 'desc' } | null>(null);

  useEffect(() => {
    if (defaultMobileColumns) {
      setVisibleColumns(['symbol', 'volumeMarketCapRatio', 'isVolumeHealthy']);
    } else {
      setVisibleColumns([
        'symbol',
        'price',
        'volume24h',
        'marketCap',
        'volumeMarketCapRatio',
        'isVolumeHealthy',
        'pumpDumpRiskScore',
        'liquidityScore',
        'walletDistributionScore',
      ]);
    }
  }, [defaultMobileColumns]);

  const toggleColumn = (key: string) => {
    setVisibleColumns(prev =>
      prev.includes(key) ? prev.filter(col => col !== key) : [...prev, key]
    );
  };

  const debouncedSearch = useCallback(
    debounce((query: string) => {
      setFilteredTokens(
        tokens.filter(
          token =>
            token.name.toLowerCase().includes(query.toLowerCase()) ||
            token.symbol.toLowerCase().includes(query.toLowerCase())
        )
      );
    }, 300),
    [tokens, setFilteredTokens]
  );

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const query = e.target.value;
    setSearchQuery(query);
    debouncedSearch(query);
  };

  const showColumnModal = () => {
    setIsColumnModalVisible(true);
  };

  const handleColumnClose = () => {
    setIsColumnModalVisible(false);
  };

  const showSortModal = () => {
    setIsSortModalVisible(true);
  };

  const handleSortClose = () => {
    setIsSortModalVisible(false);
  };

  const requestSort = (key: keyof Token) => {
    setSortConfig(prev => {
      if (!prev || prev.key !== key) {
        return { key, direction: 'asc' as const };
      }
      return prev.direction === 'asc' ? { key, direction: 'desc' as const } : null;
    });
    handleSortClose();
  };

  const sortedTokens: Token[] = useMemo(() => {
    if (!sortConfig) return filteredTokens as Token[];
    return [...filteredTokens].sort((a: Token, b: Token) => {
      const aValue = a[sortConfig.key];
      const bValue = b[sortConfig.key];
      if (aValue === undefined || bValue === undefined) return 0;
      if (typeof aValue === 'string' && typeof bValue === 'string') {
        return sortConfig.direction === 'asc'
          ? aValue.localeCompare(bValue)
          : bValue.localeCompare(aValue);
      }
      if (typeof aValue === 'number' && typeof bValue === 'number') {
        return sortConfig.direction === 'asc' ? aValue - bValue : bValue - aValue;
      }
      if (typeof aValue === 'boolean' && typeof bValue === 'boolean') {
        return sortConfig.direction === 'asc'
          ? Number(aValue) - Number(bValue)
          : Number(bValue) - Number(aValue);
      }
      return 0;
    });
  }, [filteredTokens, sortConfig]);

  const columns = [
    'symbol',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ].filter(col => visibleColumns.includes(col));

  const formatRatio = (value: number | undefined) => value !== undefined ? `${(value * 100).toFixed(2)}%` : '-';
  const formatBoolean = (value: boolean | undefined) => value !== undefined ? (value ? 'Yes' : 'No') : '-';
  const formatScore = (value: number | undefined) => value !== undefined ? value.toFixed(2) : '-';

  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => {
    const token: Token = sortedTokens[index];
    const isInWatchlist = watchlist.some(w => w.id === token.id);

    const handleAddToWatchlist = () => {
      if (!isInWatchlist) {
        addToWatchlist(token);
      }
    };

    return (
      <div
        style={style}
        className="bg-gray-800 p-2 flex items-center space-x-2 text-white rounded shadow-sm hover:bg-gray-700 transition-colors cursor-pointer"
        role="row"
        aria-label={`Token ${token.symbol}`}
        onClick={() => router.push(`/tokens/${token.id}`)}
      >
        {columns.map(col => (
          <div key={col} className="flex-1 text-sm truncate" role="cell">
            {col === 'symbol' ? (
              <span className="font-semibold">{token.symbol}</span>
            ) : col === 'price' ? (
              <button className="bg-green-500 text-black px-2 py-1 rounded hover:bg-green-400 transition-colors">
                Buy ${formatNumber(token.price)}
              </button>
            ) : col === 'volume24h' ? (
              formatNumber(token.volume24h)
            ) : col === 'marketCap' ? (
              formatNumber(token.marketCap)
            ) : col === 'volumeMarketCapRatio' ? (
              formatRatio(token.volumeMarketCapRatio)
            ) : col === 'isVolumeHealthy' ? (
              formatBoolean(token.isVolumeHealthy)
            ) : col === 'pumpDumpRiskScore' ? (
              formatScore(token.pumpDumpRiskScore)
            ) : col === 'liquidityScore' ? (
              formatScore(token.liquidityScore)
            ) : col === 'walletDistributionScore' ? (
              formatScore(token.walletDistributionScore)
            ) : (
              '-'
            )}
          </div>
        ))}
        <button
          onClick={(e) => { e.stopPropagation(); handleAddToWatchlist(); }}
          className={`p-1 rounded-full ${isInWatchlist ? 'text-yellow-500' : 'text-gray-400 hover:text-yellow-500'} transition-colors`}
          aria-label={isInWatchlist ? 'Remove from watchlist' : 'Add to watchlist'}
        >
          <FaStar />
        </button>
      </div>
    );
  };

  return (
    <div className="p-4 space-y-4">
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <input
          type="text"
          placeholder="Search tokens..."
          value={searchQuery}
          onChange={handleSearchChange}
          className="w-full sm:max-w-xs p-2 border border-gray-600 rounded bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
          aria-label="Search tokens"
        />
        <div className="flex flex-wrap gap-2">
          <select
            onChange={e => requestSort(e.target.value as keyof Token)}
            className="p-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Sort tokens by"
          >
            <option value="">Sort By</option>
            <option value="marketCap">Market Cap</option>
            <option value="volume24h">Volume 24h</option>
            <option value="price">Price</option>
            <option value="liquidityScore">Liquidity Score</option>
            <option value="pumpDumpRiskScore">Pump/Dump Risk</option>
            <option value="walletDistributionScore">Wallet Dist Score</option>
          </select>
          <button
            onClick={showColumnModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Customize table columns"
          >
            Columns
          </button>
          <button
            onClick={onFilterClick}
            className="px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Open filter drawer"
          >
            Filter
          </button>
          <button
            onClick={showSortModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 flex items-center focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Open sort options"
          >
            <FaSort className="mr-1" /> Sort
          </button>
        </div>
      </div>
      <div className="overflow-x-auto rounded-lg shadow-lg">
        <div className="min-w-full">
          <div
            className={`grid gap-2 sticky top-0 bg-gray-800 z-10 p-2 text-white font-bold border-b border-gray-700`}
            style={{
              gridTemplateColumns: columns.map(() => defaultMobileColumns ? '1fr' : 'minmax(80px, 1fr)').join(' '),
            }}
            role="row"
            aria-label="Table headers"
          >
            {columns.map(col => (
              <div
                key={col}
                className="text-sm truncate"
                role="columnheader"
                aria-sort={sortConfig?.key === col ? (sortConfig.direction === 'asc' ? 'ascending' : 'descending') : 'none'}
              >
                {col === 'symbol' ? 'Symbol' : 
                 col === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap' : 
                 col === 'isVolumeHealthy' ? 'Health' : 
                 col === 'pumpDumpRiskScore' ? 'Risk' : 
                 col === 'walletDistributionScore' ? 'Wallet Score' : 
                 col.charAt(0).toUpperCase() + col.slice(1).replace(/([A-Z])/g, ' $1')}
              </div>
            ))}
          </div>
          <div role="grid" aria-label="Token data table" className="bg-gray-900">
            <FixedSizeList
              height={400}
              itemCount={sortedTokens.length}
              itemSize={50}
              width="100%"
            >
              {Row}
            </FixedSizeList>
          </div>
        </div>
      </div>
      {isColumnModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl">
            <h2 className="text-lg font-bold text-white mb-4">Customize Columns</h2>
            {[
              'symbol',
              'price',
              'volume24h',
              'marketCap',
              'volumeMarketCapRatio',
              'isVolumeHealthy',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="flex items-center mb-3">
                <input
                  type="checkbox"
                  checked={visibleColumns.includes(key)}
                  onChange={() => toggleColumn(key)}
                  className="mr-2 h-4 w-4 text-yellow-500 bg-gray-700 border-gray-600 rounded focus:ring-yellow-500"
                  id={`column-${key}`}
                  aria-label={`Toggle ${key} column`}
                />
                <label htmlFor={`column-${key}`} className="text-white text-sm">
                  {key === 'symbol' ? 'Symbol' : 
                   key === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap' : 
                   key === 'isVolumeHealthy' ? 'Health' : 
                   key === 'pumpDumpRiskScore' ? 'Risk' : 
                   key === 'walletDistributionScore' ? 'Wallet Score' : 
                   key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}
                </label>
              </div>
            ))}
            <button
              onClick={handleColumnClose}
              className="w-full mt-4 px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
              aria-label="Close column customization"
            >
              Done
            </button>
          </div>
        </div>
      )}
      {isSortModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl">
            <h2 className="text-lg font-bold text-white mb-4">Sort By</h2>
            {[
              'price',
              'marketCap',
              'volume24h',
              'volumeMarketCapRatio',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="mb-3">
                <button
                  onClick={() => requestSort(key as keyof Token)}
                  className="w-full text-left p-2 bg-gray-700 rounded hover:bg-gray-600 text-white flex justify-between focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
                  aria-label={`Sort by ${key}`}
                >
                  <span>{key === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap' : 
                         key === 'isVolumeHealthy' ? 'Health' : 
                         key === 'pumpDumpRiskScore' ? 'Risk' : 
                         key === 'walletDistributionScore' ? 'Wallet Score' : 
                         key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</span>
                  <span>{sortConfig?.key === key ? (sortConfig.direction === 'asc' ? 'â†‘' : 'â†“') : ''}</span>
                </button>
              </div>
            ))}
            <button
              onClick={handleSortClose}
              className="w-full mt-4 px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
              aria-label="Close sort options"
            >
              Done
            </button>
          </div>
        </div>
      )}
      <FilterDrawer isOpen={isFilterDrawerOpen} onClose={onFilterClose} />
    </div>
  );
});

export default TokenTable;
=== .\components\WelcomeScreen.tsx ===
import React, { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import localforage from 'localforage';

const WelcomeScreen: React.FC<{ onFinish: () => void }> = ({ onFinish }) => {
  const [show, setShow] = useState(false);

  useEffect(() => {
    const checkLastVisit = async () => {
      const lastVisit = await localforage.getItem<number>('lastVisit');
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

      if (!lastVisit || now - lastVisit > oneDay) {
        setShow(true);
        await localforage.setItem('lastVisit', now);
      } else {
        onFinish();
      }
    };

    checkLastVisit();
  }, [onFinish]);

  if (!show) return null;

  return (
    <motion.div
      initial={{ opacity: 1 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 1 }}
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100vw',
        height: '100vh',
        background: '#001529',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        zIndex: 2000,
      }}
      onAnimationComplete={() => {
        setTimeout(() => {
          setShow(false);
          onFinish();
        }, 2000);
      }}
    >
      <motion.div
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: 'spring', stiffness: 260, damping: 20 }}
      >
        {/* Replace with your logo */}
        <div style={{ fontSize: 48, color: '#fff', fontWeight: 'bold' }}>
          Sunnalytics
        </div>
      </motion.div>
    </motion.div>
  );
};

export default WelcomeScreen;
=== .\hooks\useTokenData.ts ===
import { useEffect } from 'react';
import useSWR from 'swr';
import { useTokenStore } from '../stores/useTokenStore';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  createdAt: string;
  updatedAt: string;
  volatilityScore24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
}

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';
const API_KEY = process.env.NEXT_PUBLIC_API_KEY;

const fetcher = async (url: string) => {
  const headers: HeadersInit = {};
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    throw new Error(`Failed to fetch: ${res.statusText}`);
  }
  const data = await res.json();
  return Array.isArray(data) ? data : [data];
};

export function useTokenData() {
  const { setTokens, setFilteredTokens, setLoading, setError, fetchTokens } = useTokenStore();

  const { data, error, isLoading } = useSWR<Token[]>(`${API_BASE_URL}/api/tokens`, fetcher, {
    revalidateOnFocus: false,
    revalidateOnReconnect: false,
  });

  useEffect(() => {
    setLoading(isLoading);
    if (error) {
      setError(error.message || 'An unknown error occurred');
    } else if (data) {
      setTokens(data);
      setFilteredTokens(data);
      setError(null);
    }
  }, [data, error, isLoading, setTokens, setFilteredTokens, setLoading, setError]);

  return { fetchTokens };
}
=== .\pages\ai-picks.tsx ===
// pages/ai-picks.tsx
import React, { useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import { useRouter } from 'next/router';
import BottomNav from '../components/BottomNav';

// Define the Token type if not imported from elsewhere
type Token = {
  id: string;
  symbol: string;
  volumeMarketCapRatio?: number;
  liquidityScore?: number;
  // Add other properties as needed
};

export default function AIPicks() {
  const { tokens, setFilteredTokens } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const router = useRouter();

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const getBoomingTokens = (tokens: Token[]) => {
    return tokens
      .filter(token => token.volumeMarketCapRatio !== undefined && token.liquidityScore !== undefined)
      .sort((a, b) => {
        const aScore = (a.volumeMarketCapRatio || 0) * (a.liquidityScore || 0);
        const bScore = (b.volumeMarketCapRatio || 0) * (b.liquidityScore || 0);
        return bScore - aScore;
      })
      .slice(0, 5);
  };

  const boomingTokens = getBoomingTokens(tokens);

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">AI Picks</h1>
      <p className="mb-4">Top 5 potential booming tokens based on volume/market cap ratio and liquidity score:</p>
      {boomingTokens.length > 0 ? (
        <ul className="space-y-2">
          {boomingTokens.map(token => (
            <li key={token.id} className="bg-gray-800 p-2 rounded shadow-sm hover:bg-gray-700 cursor-pointer" onClick={() => router.push(`/tokens/${token.id}`)}>
              {token.symbol} - Vol/Mkt Cap: {(token.volumeMarketCapRatio || 0 * 100).toFixed(2)}%, Liquidity: {(token.liquidityScore || 0).toFixed(2)}
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-gray-400">No tokens available for analysis.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\charts.tsx ===
// pages/charts.tsx
import React, { useState, useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import { Line } from 'react-chartjs-2';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js';
import BottomNav from '../components/BottomNav';

ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend);

export default function Charts() {
  const { tokens } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const [selectedToken, setSelectedToken] = useState<string | null>(null);
  const [chartData, setChartData] = useState<any>(null);

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  useEffect(() => {
    if (selectedToken && tokens.length > 0) {
      const token = tokens.find(t => t.symbol === selectedToken);
      if (token) {
        // Mock historical data (replace with real API data if available)
        const labels = ['June 10', 'June 12', 'June 14', 'June 16', 'June 18'];
        const priceData = [token.price || 0, (token.price || 0) * 1.1, (token.price || 0) * 1.2, (token.price || 0) * 1.15, (token.price || 0) * 1.3];
        const volumeData = [(token.volume24h || 0), (token.volume24h || 0) * 0.9, (token.volume24h || 0) * 1.1, (token.volume24h || 0) * 1.05, (token.volume24h || 0) * 1.2];
        const marketCapData = [token.marketCap || 0, (token.marketCap || 0) * 1.15, (token.marketCap || 0) * 1.25, (token.marketCap || 0) * 1.2, (token.marketCap || 0) * 1.35];

        setChartData({
          labels,
          datasets: [
            {
              label: 'Price (USD)',
              data: priceData,
              borderColor: 'rgb(75, 192, 192)',
              backgroundColor: 'rgba(75, 192, 192, 0.5)',
              yAxisID: 'y1',
            },
            {
              label: 'Volume (24h)',
              data: volumeData,
              borderColor: 'rgb(255, 99, 132)',
              backgroundColor: 'rgba(255, 99, 132, 0.5)',
              yAxisID: 'y2',
            },
            {
              label: 'Market Cap',
              data: marketCapData,
              borderColor: 'rgb(54, 162, 235)',
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              yAxisID: 'y3',
            },
          ],
        });
      }
    }
  }, [selectedToken, tokens]);

  const options = {
    responsive: true,
    plugins: {
      legend: { position: 'top' as const },
      title: { display: true, text: 'Token Price, Volume, and Market Cap Trends' },
    },
    scales: {
      y1: { 
        type: 'linear' as const, 
        position: 'left' as const, 
        title: { display: true, text: 'Price (USD)' } 
      },
      y2: { 
        type: 'linear' as const, 
        position: 'right' as const, 
        title: { display: true, text: 'Volume (USD)' }, 
        grid: { drawOnChartArea: false } 
      },
      y3: { 
        type: 'linear' as const, 
        position: 'right' as const, 
        title: { display: true, text: 'Market Cap (USD)' }, 
        grid: { drawOnChartArea: false }, 
        min: 0 
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Charts</h1>
      <select
        onChange={e => setSelectedToken(e.target.value)}
        className="p-2 mb-4 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-yellow-500"
        value={selectedToken || ''}
      >
        <option value="">Select a Token</option>
        {tokens.map(token => (
          <option key={token.id} value={token.symbol}>{token.symbol}</option>
        ))}
      </select>
      {chartData && selectedToken ? (
        <div>
          <Line data={chartData} options={options} />
        </div>
      ) : (
        <p className="text-gray-400">Select a token to view charts.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\index.tsx ===
// pages/index.tsx
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import TokenTable from '../components/TokenTable';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import useMediaQuery from 'react-responsive';

export default function Home() {
  const { loading, error } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const [isFilterDrawerOpen, setIsFilterDrawerOpen] = useState(false);
  const isMobileQuery = useMediaQuery({ query: '(max-width: 640px)' }) as boolean | null;
  const isMobile: boolean = isMobileQuery !== null ? isMobileQuery : false;

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const handleFilterClick = () => {
    setIsFilterDrawerOpen(true);
  };

  const handleFilterClose = () => {
    setIsFilterDrawerOpen(false);
  };

  return (
    <div className="min-h-screen flex flex-col pb-safe-area-inset-bottom bg-gray-900 text-white">
      <main className="flex-1 p-4">
        <div className="flex justify-between items-center mb-4">
          <h1 className="text-2xl font-bold">Market</h1>
          <div className="text-sm text-gray-400">Watchlist</div>
        </div>
        {loading && <p className="text-center text-gray-400">Loading tokens...</p>}
        {error && (
          <p className="text-center text-red-500">
            Error: {error}{' '}
            <button onClick={fetchTokens} className="text-blue-500 underline">
              Retry
            </button>
          </p>
        )}
        {!loading && !error && (
          <TokenTable
            isFilterDrawerOpen={isFilterDrawerOpen}
            onFilterClick={handleFilterClick}
            onFilterClose={handleFilterClose}
            defaultMobileColumns={isMobile}
          />
        )}
      </main>
      <BottomNav onFilterClick={handleFilterClick} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\settings.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import localforage from 'localforage';

export default function Settings() {
  const [isMounted, setIsMounted] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    setIsMounted(true);
    localforage.getItem('darkMode').then(value => {
      const darkMode = value as boolean;
      setIsDarkMode(darkMode || false);
      if (darkMode) {
        document.documentElement.classList.add('dark');
      }
    });
  }, []);

  const toggleDarkMode = () => {
    const newDarkMode = !isDarkMode;
    setIsDarkMode(newDarkMode);
    localforage.setItem('darkMode', newDarkMode);
    if (newDarkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };

  const handleReset = () => {
    localforage.clear();
    setIsDarkMode(false);
    document.documentElement.classList.remove('dark');
  };

  if (!isMounted) return null;

  return (
    <div className="min-h-screen flex flex-col pb-16">
      <main className="flex-1 p-4">
        <h1 className="text-2xl font-bold mb-4">Settings</h1>
        <div className="mb-4 flex items-center justify-between">
          <span className="text-lg">Dark Mode</span>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={isDarkMode}
              onChange={toggleDarkMode}
              className="sr-only"
            />
            <div
              className={`w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 ${
                isDarkMode ? 'bg-blue-600' : ''
              }`}
            >
              <div
                className={`absolute w-5 h-5 bg-white rounded-full transition-transform duration-200 ease-in-out ${
                  isDarkMode ? 'translate-x-5' : 'translate-x-0'
                }`}
              ></div>
            </div>
          </label>
        </div>
        <button
          onClick={handleReset}
          className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
        >
          Reset All Settings
        </button>
      </main>
      <BottomNav />
    </div>
  );
}
=== .\pages\watchlist.tsx ===
// pages/watchlist.tsx
import React, { useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useRouter } from 'next/router';
import BottomNav from '../components/BottomNav';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

export default function Watchlist() {
  const { watchlist, fetchTokens } = useTokenStore();
  const router = useRouter();

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const formatNumber = (value: number | undefined, suffix: string = ''): string => {
    if (value === undefined || value === 0) return '-';
    if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
    if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
    return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
  };

  const formatRatio = (value: number | undefined) => value !== undefined ? `${(value * 100).toFixed(2)}%` : '-';
  const formatBoolean = (value: boolean | undefined) => value !== undefined ? (value ? 'Yes' : 'No') : '-';
  const formatScore = (value: number | undefined) => value !== undefined ? value.toFixed(2) : '-';

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Watchlist</h1>
      {watchlist.length > 0 ? (
        <ul className="space-y-4">
          {watchlist.map((token: Token) => (
            <li
              key={token.id}
              className="bg-gray-800 p-4 rounded-lg shadow-sm hover:bg-gray-700 transition-colors cursor-pointer"
              onClick={() => router.push(`/tokens/${token.id}`)}
            >
              <div className="flex flex-col sm:flex-row sm:items-center justify-between">
                <div>
                  <h2 className="text-lg font-semibold">{token.symbol}</h2>
                  <p className="text-sm text-gray-400">{token.name} - {token.category}</p>
                </div>
                <div className="mt-2 sm:mt-0 space-y-1">
                  <p>Price: {formatNumber(token.price)}</p>
                  <p>Market Cap: {formatNumber(token.marketCap)}</p>
                  <p>Volume (24h): {formatNumber(token.volume24h)}</p>
                  <p>Vol/Mkt Cap: {formatRatio(token.volumeMarketCapRatio)}</p>
                  <p>Health: {formatBoolean(token.isVolumeHealthy)}</p>
                  <p>Liquidity Score: {formatScore(token.liquidityScore)}</p>
                </div>
              </div>
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-gray-400">No tokens in watchlist. Add tokens from the Market page.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\welcome.tsx ===
import { useEffect } from 'react';
import { useRouter } from 'next/router';
import localforage from 'localforage';

export default function Welcome() {
  const router = useRouter();

  useEffect(() => {
    localforage.getItem('welcomeScreenSeen').then(value => {
      if (value) {
        router.push('/');
      }
    });
  }, [router]);

  const handleContinue = () => {
    localforage.setItem('welcomeScreenSeen', true);
    router.push('/');
  };

  return (
    <div className="min-h-screen flex flex-col justify-center items-center bg-gray-100 p-4">
      <h1 className="text-3xl font-bold mb-4">Welcome to Sunnalytics</h1>
      <p className="text-lg text-gray-600 mb-6 text-center">
        Your go-to platform for token analytics and insights.
      </p>
      <button
        onClick={handleContinue}
        className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
      >
        Continue
      </button>
    </div>
  );
}
=== .\pages\_app.tsx ===
import '../styles/globals.css';
import type { AppProps } from 'next/app';
import { inter, robotoMono } from '../utils/fonts';
import Head from 'next/head';
import { useState, useEffect } from 'react';
import WelcomeScreen from '../components/WelcomeScreen';

export default function App({ Component, pageProps }: AppProps) {
  const [showWelcome, setShowWelcome] = useState(true);
  const INACTIVITY_THRESHOLD = 10 * 60 * 1000; // 10 minutes in milliseconds

  useEffect(() => {
    const lastActive = localStorage.getItem('lastActive');
    const now = new Date().getTime();

    if (lastActive) {
      const lastActiveTime = parseInt(lastActive, 10);
      const timeSinceLastActive = now - lastActiveTime;

      // Show welcome screen if inactive for more than INACTIVITY_THRESHOLD
      if (timeSinceLastActive > INACTIVITY_THRESHOLD) {
        setShowWelcome(true);
      } else {
        setShowWelcome(false);
      }
    } else {
      // First visit or no stored timestamp
      localStorage.setItem('lastActive', now.toString());
      setShowWelcome(true);
    }

    // Update last active timestamp when the app is interacted with
    const handleActivity = () => {
      localStorage.setItem('lastActive', now.toString());
    };

    window.addEventListener('mousemove', handleActivity);
    window.addEventListener('keydown', handleActivity);
    window.addEventListener('scroll', handleActivity);

    return () => {
      window.removeEventListener('mousemove', handleActivity);
      window.removeEventListener('keydown', handleActivity);
      window.removeEventListener('scroll', handleActivity);
    };
  }, []);

  const handleWelcomeFinish = () => {
    setShowWelcome(false);
  };

  return (
    <div className={`${inter.variable} ${robotoMono.variable}`}>
      <Head>
        <title>Sunnalytics</title>
        <meta name="description" content="Sunnalytics - Token Analytics Platform" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#111827" />
        <link rel="icon" href="/favicon.ico" sizes="any" />
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
        <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />
        <link rel="manifest" href="/site.webmanifest" />
      </Head>
      {showWelcome && <WelcomeScreen onFinish={handleWelcomeFinish} />}
      <Component {...pageProps} />
    </div>
  );
}
=== .\pages\tokens\[id].tsx ===
import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend, ChartOptions } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../../utils/api';
import BottomNav from '../../components/BottomNav';
import { formatNumber } from '../../components/TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);
  const [apiError, setApiError] = useState<string | null>(null);

  // Replace with your backend URL, e.g., 'https://your-backend.com'
  const BACKEND_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';

  useEffect(() => {
    if (id) {
      const url = `${BACKEND_URL}/api/tokens/${id}/history`;
      console.log(`Fetching history from: ${url}`);
      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          console.log('Token history data:', data);
          setHistory(data);
          setApiError(null);
        })
        .catch(err => {
          console.error('Error fetching history:', err.message);
          setApiError(err.message);
        });
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  // Group by date, minimal filtering
  const validHistory = history
    .filter(h => h.price != null && h.volume24h != null && h.marketCap != null && h.marketCap !== 0)
    .reduce((acc: TokenHistory[], h) => {
      const date = new Date(h.timestamp).toISOString().split('T')[0];
      const existing = acc.find(item => new Date(item.timestamp).toISOString().split('T')[0] === date);
      if (!existing) acc.push(h);
      return acc;
    }, [])
    .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());

  console.log('Valid history:', validHistory);

  const chartData = {
    labels: validHistory.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Volume/Market Cap Ratio (%)',
        data: validHistory.map(h => (h.volume24h! / h.marketCap!) * 100),
        borderColor: '#FBBF24',
        yAxisID: 'y-ratio',
      },
      {
        label: 'Price (USD)',
        data: validHistory.map(h => h.price!),
        borderColor: '#3B82F6',
        yAxisID: 'y-price',
      },
    ],
  };

  const chartOptions: ChartOptions<'line'> = {
    responsive: true,
    scales: {
      x: {
        type: 'time',
        time: { unit: 'day' },
        title: { display: true, text: 'Date' },
      },
      'y-ratio': {
        type: 'linear',
        position: 'left',
        title: { display: true, text: 'Ratio (%)' },
        beginAtZero: true,
      },
      'y-price': {
        type: 'linear',
        position: 'right',
        title: { display: true, text: 'Price ($)' },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: { display: true },
      tooltip: { mode: 'index', intersect: false },
    },
  };

  console.log('Chart data:', chartData);

  return (
    <div className="min-h-screen flex flex-col bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button onClick={() => router.back()} className="mr-4 text-yellow-400">
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg h-80">
            <h2 className="text-lg font-semibold mb-2">Historical Data</h2>
            <div className="h-64">
              {apiError ? (
                <div className="text-center text-red-500 h-full flex items-center justify-center">
                  Error: {apiError}
                </div>
              ) : validHistory.length > 0 ? (
                <Line data={chartData} options={chartOptions} />
              ) : (
                <div className="text-center text-gray-400 h-full flex items-center justify-center">
                  No history data
                </div>
              )}
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\stores\useTokenStore.ts ===
// stores/useTokenStore.ts
import { create } from 'zustand';
import localforage from 'localforage';
import { persist, createJSONStorage } from 'zustand/middleware';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

interface TokenState {
  tokens: Token[];
  filteredTokens: Token[];
  watchlist: Token[];
  loading: boolean;
  error: string | null;
  setTokens: (tokens: Token[]) => void;
  setFilteredTokens: (tokens: Token[]) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  fetchTokens: () => void;
  addToWatchlist: (token: Token) => void;
}

export const useTokenStore = create<TokenState>()(
  persist(
    (set, get) => ({
      tokens: [],
      filteredTokens: [],
      watchlist: [],
      loading: false,
      error: null,
      setTokens: (tokens: Token[]) => set({ tokens }),
      setFilteredTokens: (tokens: Token[]) => set({ filteredTokens: tokens }),
      setLoading: (loading: boolean) => set({ loading }),
      setError: (error: string | null) => set({ error }),
      fetchTokens: async () => {
        set({ loading: true, error: null });
        try {
          // Replace with your actual backend API endpoint
          const response = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/tokens`, {
            method: 'GET',
            headers: {
              // Add authentication headers if required (e.g., Authorization: `Bearer ${yourToken}`)
              'Content-Type': 'application/json',
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          // Map the backend response to the Token interface
          const tokens: Token[] = data.map((item: any) => ({
            id: item.id || item._id, // Adjust based on your backend's ID field
            name: item.name,
            symbol: item.symbol,
            category: item.category || 'Unknown',
            price: item.price,
            marketCap: item.marketCap,
            volume24h: item.volume24h,
            volumeMarketCapRatio: item.volumeMarketCapRatio,
            isVolumeHealthy: item.isVolumeHealthy,
            liquidityScore: item.liquidityScore,
            // Add other fields as needed based on your backend response
          }));

          set({ tokens, filteredTokens: tokens, loading: false });
        } catch (err) {
          set({ error: err instanceof Error ? err.message : 'Failed to fetch tokens', loading: false });
        }
      },
      addToWatchlist: (token: Token) => set((state) => ({
        watchlist: state.watchlist.some((w: Token) => w.id === token.id) ? state.watchlist : [...state.watchlist, token],
      })),
    }),
    {
      name: 'token-store',
      storage: createJSONStorage(() => localforage),
    }
  )
);
=== .\styles\globals.css ===
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --max-width: 1100px;
  --border-radius: 12px;
  --font-mono: var(--font-roboto-mono), ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono',
    'Roboto Mono', 'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro',
    'Fira Mono', 'Droid Sans Mono', 'Courier New', monospace;
  --primary-color: #FBBF24;
  --background-dark: #111827;
  --card-bg: #1F2A44;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
  font-family: var(--font-inter), system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
    'Helvetica Neue', Arial, sans-serif;
  background-color: var(--background-dark);
  color: #fff;
}

a {
  color: var(--primary-color);
  text-decoration: none;
}

button, input, select {
  transition: all 0.2s ease-in-out;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}
=== .\utils\api.ts ===
import useSWR from 'swr';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';

const fetcher = async (url: string) => {
  const res = await fetch(url);
  if (!res.ok) {
    const error = new Error('An error occurred while fetching the data.');
    throw error;
  }
  return res.json();
};

export function useTokens(category?: string) {
  const url = category
    ? `${API_BASE_URL}/api/tokens?category=${category}`
    : `${API_BASE_URL}/api/tokens`;
  const { data, error, isLoading } = useSWR(url, fetcher, {
    refreshInterval: 60000,
    revalidateOnFocus: false,
  });
  return { tokens: data, error, isLoading };
}

export async function refreshTokens() {
  const res = await fetch(`${API_BASE_URL}/api/tokens/refresh`, { method: 'POST' });
  if (!res.ok) {
    throw new Error('Failed to refresh tokens');
  }
  return res.json();
}
=== .\utils\fonts.ts ===
import { Inter, Roboto_Mono } from 'next/font/google';

export const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter',
});

export const robotoMono = Roboto_Mono({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-roboto-mono',
});
=== .\utils\tokenStats.ts ===
export interface TokenStats {
  priceChange24h: number;
  volatilityScore24h: number;
  liquidityScore: number;
  transferVolume24h: number;
}

export function calculateTokenStats(data: {
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  circulatingSupply: number | null;
  totalSupply: number | null;
  priceChange24h?: number | null;
  transferAmount?: number;
}): TokenStats {
  const { price, marketCap, volume24h, circulatingSupply, priceChange24h, transferAmount } = data;

  const change24h = priceChange24h ?? 0;
  const volatility = volume24h && marketCap ? (volume24h / marketCap) : 0;
  const liquidityScore = volume24h && circulatingSupply ? volume24h / circulatingSupply : 0;
  const transferVol24h = transferAmount ?? 0;

  return {
    priceChange24h: Number(change24h.toFixed(2)),
    volatilityScore24h: Number(volatility.toFixed(2)),
    liquidityScore: Number(liquidityScore.toFixed(2)),
    transferVolume24h: Number(transferVol24h.toFixed(2)),
  };
}

=== .\tailwind.config.js ===
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
=== .\tree.txt ===
Project Tree (excluding node_modules, .next, package-lock.json):

â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ all_files_combined.txt
â”œâ”€â”€ combine_files.py
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”œâ”€â”€ FilterDrawer.tsx
â”‚   â”œâ”€â”€ TabbedFilters.tsx
â”‚   â”œâ”€â”€ TokenDetails.tsx
â”‚   â”œâ”€â”€ TokenTable.tsx
â”‚   â””â”€â”€ WelcomeScreen.tsx
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ generate_tree.py
â”œâ”€â”€ hooks
â”‚   â””â”€â”€ useTokenData.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ _app.tsx
â”‚   â”œâ”€â”€ ai-picks.tsx
â”‚   â”œâ”€â”€ api
â”‚   â”œâ”€â”€ charts.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â”œâ”€â”€ settings.tsx
â”‚   â”œâ”€â”€ tokens
â”‚   â”‚   â””â”€â”€ [id].tsx
â”‚   â”œâ”€â”€ watchlist.tsx
â”‚   â””â”€â”€ welcome.tsx
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ src
â”œâ”€â”€ stores
â”‚   â””â”€â”€ useTokenStore.ts
â”œâ”€â”€ styles
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ sunnalytics-dev.txt
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tree.txt
â”œâ”€â”€ tsconfig.json
â””â”€â”€ utils
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ fonts.ts
    â””â”€â”€ tokenStats.ts
=== .\tsconfig.json ===
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", "postcss.config.js"],
  "exclude": ["node_modules"]
}

=== .\components\BottomNav.tsx ===
// components/BottomNav.tsx
import React from 'react';
import { useRouter } from 'next/router';
import { FaChartLine, FaFilter, FaSearch, FaHome, FaStar, FaRobot } from 'react-icons/fa';

interface BottomNavProps {
  onFilterClick?: () => void;
  onSearchFocus?: () => void;
}

const BottomNav: React.FC<BottomNavProps> = ({ onFilterClick, onSearchFocus }) => {
  const router = useRouter();

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-gray-800 h-20 p-2 flex justify-around items-center border-t border-gray-700 shadow-lg pb-safe-area-inset-bottom">
      <button
        onClick={() => router.push('/')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaHome className="text-lg mb-1" />
        <span>Market</span>
      </button>
      <button
        onClick={() => router.push('/watchlist')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/watchlist' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaStar className="text-lg mb-1" />
        <span>Watchlist</span>
      </button>
      <button
        onClick={onSearchFocus}
        className="flex flex-col items-center text-xs text-gray-400 hover:text-yellow-400 transition-all duration-200 hover:scale-110"
      >
        <FaSearch className="text-lg mb-1" />
        <span>Search</span>
      </button>
      <button
        onClick={() => router.push('/ai-picks')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/ai-picks' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaRobot className="text-lg mb-1" />
        <span>AI Picks</span>
      </button>
      <button
        onClick={() => router.push('/charts')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/charts' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaChartLine className="text-lg mb-1" />
        <span>Charts</span>
      </button>
    </nav>
  );
};

export default BottomNav;
=== .\components\FilterDrawer.tsx ===
import React, { useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';

interface FilterDrawerProps {
  isOpen: boolean;
  onClose: () => void;
}

const FilterDrawer: React.FC<FilterDrawerProps> = ({ isOpen, onClose }) => {
  const { filteredTokens, setFilteredTokens, tokens, filters, setFilters } = useTokenStore();

  useEffect(() => {
    const applyFilters = () => {
      let filtered = [...tokens];
      if (filters.category) {
        filtered = filtered.filter(token => token.category === filters.category);
      }
      if (filters.minPrice) {
        const min = parseFloat(filters.minPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price >= min);
      }
      if (filters.maxPrice) {
        const max = parseFloat(filters.maxPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price <= max);
      }
      if (filters.minVolumeMarketCapRatio) {
        const min = parseFloat(filters.minVolumeMarketCapRatio) / 100;
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio >= min);
      }
      if (filters.maxVolumeMarketCapRatio) {
        const max = parseFloat(filters.maxVolumeMarketCapRatio) / 100;
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio <= max);
      }
      if (filters.minCirculatingSupplyPercentage) {
        const min = parseFloat(filters.minCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage >= min);
      }
      if (filters.maxCirculatingSupplyPercentage) {
        const max = parseFloat(filters.maxCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage <= max);
      }
      if (filters.isVolumeHealthy === 'true') {
        filtered = filtered.filter(token => token.isVolumeHealthy === true);
      } else if (filters.isVolumeHealthy === 'false') {
        filtered = filtered.filter(token => token.isVolumeHealthy === false);
      }
      if (filters.isCirculatingSupplyGood === 'true') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === true);
      } else if (filters.isCirculatingSupplyGood === 'false') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === false);
      }
      setFilteredTokens(filtered);
    };

    applyFilters();
  }, [filters, tokens, setFilteredTokens]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFilters({ [name]: value });
  };

  const handleReset = () => {
    setFilters({
      category: '',
      minPrice: '',
      maxPrice: '',
      minVolumeMarketCapRatio: '',
      maxVolumeMarketCapRatio: '',
      minCirculatingSupplyPercentage: '',
      maxCirculatingSupplyPercentage: '',
      isVolumeHealthy: '',
      isCirculatingSupplyGood: '',
    });
    setFilteredTokens(tokens);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
      <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
        <h2 className="text-lg font-bold text-white mb-4">Filter Tokens</h2>
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-300">Category</label>
            <select
              name="category"
              value={filters.category}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="altcoin">Altcoin</option>
              <option value="defi">DeFi</option>
              <option value="memecoin">Memecoin</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Price ($)</label>
            <input
              type="number"
              name="minPrice"
              value={filters.minPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Price ($)</label>
            <input
              type="number"
              name="maxPrice"
              value={filters.maxPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Volume Market Cap Ratio (%)</label>
            <input
              type="number"
              name="minVolumeMarketCapRatio"
              value={filters.minVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Volume Market Cap Ratio (%)</label>
            <input
              type="number"
              name="maxVolumeMarketCapRatio"
              value={filters.maxVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Circulating Supply (%)</label>
            <input
              type="number"
              name="minCirculatingSupplyPercentage"
              value={filters.minCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Circulating Supply (%)</label>
            <input
              type="number"
              name="maxCirculatingSupplyPercentage"
              value={filters.maxCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Volume Healthy</label>
            <select
              name="isVolumeHealthy"
              value={filters.isVolumeHealthy}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Circulating Supply Good</label>
            <select
              name="isCirculatingSupplyGood"
              value={filters.isCirculatingSupplyGood}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>
        <div className="mt-6 flex justify-end space-x-4">
          <button
            onClick={handleReset}
            className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-500 transition-colors"
          >
            Reset
          </button>
          <button
            onClick={onClose}
            className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors"
          >
            Apply
          </button>
        </div>
      </div>
    </div>
  );
};

export default FilterDrawer;
=== .\components\TabbedFilters.tsx ===
// components/TabbedFilters.tsx
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useTokenStore } from '../stores/useTokenStore';

const tabs = [
  { id: 'all', label: 'All' },
  { id: 'highlights', label: 'Highlights', badge: 'ðŸ”¥' },
  { id: 'trending', label: 'Trending', badge: 'ðŸ“ˆ' },
  { id: 'pumpfun', label: 'Pump.fun' },
  { id: 'ecosystems', label: 'Ecosystems' },
];

const TabbedFilters: React.FC = () => {
  const { setFilteredTokens, tokens } = useTokenStore();
  const [activeTab, setActiveTab] = useState('all');

  const handleTabClick = (tabId: string) => {
    setActiveTab(tabId);
    if (tabId === 'all') {
      setFilteredTokens(tokens);
    } else {
      setFilteredTokens(tokens.filter(token => token.category.toLowerCase() === tabId));
    }
  };

  return (
    <div className="mb-4">
      <div
        className="flex space-x-2 overflow-x-auto pb-2"
        role="tablist"
        aria-label="Token Categories"
      >
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => handleTabClick(tab.id)}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              activeTab === tab.id
                ? 'bg-yellow-500 text-black'
                : 'bg-gray-700 text-white hover:bg-gray-600'
            }`}
            role="tab"
            aria-selected={activeTab === tab.id}
            aria-controls={`panel-${tab.id}`}
          >
            {tab.label}
            {tab.badge && <span className="ml-1">{tab.badge}</span>}
          </button>
        ))}
      </div>
      <AnimatePresence>
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -10 }}
          transition={{ duration: 0.3 }}
          id={`panel-${activeTab}`}
          role="tabpanel"
          aria-labelledby={activeTab}
        >
          {/* Content managed by TokenTable */}
        </motion.div>
      </AnimatePresence>
    </div>
  );
};

export default TabbedFilters;
=== .\components\TokenDetails.tsx ===
import React, { useState } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../utils/api';
import BottomNav from './BottomNav';
import { formatNumber } from './TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);

  React.useEffect(() => {
    if (id) {
      fetch(`/api/tokens/${id}/history`)
        .then(res => res.json())
        .then(data => setHistory(data))
        .catch(err => console.error('Error fetching history:', err));
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  const chartData = {
    labels: history.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Price (USD)',
        data: history.map(h => h.price || 0),
        borderColor: '#FBBF24',
        backgroundColor: 'rgba(251, 191, 36, 0.2)',
        fill: true,
        tension: 0.4,
      },
    ],
  };

  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        type: 'time' as const,
        time: {
          unit: 'day' as const, // Explicitly set to 'day'
          tooltipFormat: 'MMM d, yyyy HH:mm',
        },
        title: {
          display: true,
          text: 'Date',
          color: '#fff',
        },
      },
      y: {
        title: {
          display: true,
          text: 'Price (USD)',
          color: '#fff',
        },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: {
        labels: {
          color: '#fff',
        },
      },
      tooltip: {
        callbacks: {
          label: (context: any) => `Price: $${context.parsed.y.toFixed(2)}`,
          title: (tooltipItems: any[]) => {
            return new Date(tooltipItems[0].parsed.x).toLocaleString();
          },
        },
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col pb-16 bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button
          onClick={() => router.back()}
          className="mr-4 text-yellow-400 hover:text-yellow-300"
          aria-label="Go back"
        >
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4 space-y-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg shadow">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg shadow h-80">
            <h2 className="text-lg font-semibold mb-2">Price History</h2>
            <div className="h-64">
              <Line data={chartData} options={chartOptions} />
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\components\TokenTable.tsx ===
import React, { useState, useMemo, useCallback, useEffect } from 'react';
import { useRouter } from 'next/router';
import { useTokenStore } from '../stores/useTokenStore';
import FilterDrawer from './FilterDrawer';
import { FaSort, FaStar } from 'react-icons/fa';
import { FixedSizeList } from 'react-window';
import debounce from 'lodash.debounce';
import { useMediaQuery } from 'react-responsive';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
}

interface TokenTableProps {
  isFilterDrawerOpen: boolean;
  onFilterClick: () => void;
  onFilterClose: () => void;
}

export const formatNumber = (value: number | undefined, suffix: string = ''): string => {
  if (value === undefined || value === 0) return '-';
  if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
  if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
  return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
};

const TokenTable: React.FC<TokenTableProps> = React.memo(({ isFilterDrawerOpen, onFilterClick, onFilterClose }) => {
  const router = useRouter();
  const { filteredTokens, setFilteredTokens, tokens, watchlist, addToWatchlist } = useTokenStore();
  const [searchQuery, setSearchQuery] = useState('');
  const [sortConfig, setSortConfig] = useState<{ key: keyof Token; direction: 'asc' | 'desc' } | null>(null);
  const [visibleColumns, setVisibleColumns] = useState<string[]>([]);
  const [isColumnModalVisible, setIsColumnModalVisible] = useState(false);
  const [isSortModalVisible, setIsSortModalVisible] = useState(false);
  const isMobile = useMediaQuery({ query: '(max-width: 640px)' });

  useEffect(() => {
    if (isMobile) {
      setVisibleColumns(['symbol', 'volumeMarketCapRatio', 'isVolumeHealthy']);
    } else {
      setVisibleColumns([
        'symbol',
        'price',
        'volume24h',
        'marketCap',
        'volumeMarketCapRatio',
        'isVolumeHealthy',
        'pumpDumpRiskScore',
        'liquidityScore',
        'walletDistributionScore',
      ]);
    }
  }, [isMobile]);

  const toggleColumn = (key: string) => {
    setVisibleColumns((prev) =>
      prev.includes(key) ? prev.filter((col) => col !== key) : [...prev, key]
    );
  };

  const debouncedSearch = useCallback(
    debounce((query: string) => {
      setFilteredTokens(
        tokens.filter(
          (token) =>
            token.name.toLowerCase().includes(query.toLowerCase()) ||
            token.symbol.toLowerCase().includes(query.toLowerCase())
        )
      );
    }, 300),
    [tokens, setFilteredTokens]
  );

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const query = e.target.value;
    setSearchQuery(query);
    debouncedSearch(query);
  };

  const showColumnModal = () => {
    setIsColumnModalVisible(true);
  };

  const handleColumnClose = () => {
    setIsColumnModalVisible(false);
  };

  const showSortModal = () => {
    setIsSortModalVisible(true);
  };

  const handleSortClose = () => {
    setIsSortModalVisible(false);
  };

  const requestSort = (key: keyof Token) => {
    setSortConfig((prev) => {
      if (!prev || prev.key !== key) {
        return { key, direction: 'asc' };
      }
      return prev.direction === 'asc' ? { key, direction: 'desc' } : null;
    });
    handleSortClose();
  };

  const handleTokenClick = (tokenId: string) => {
    if (tokenId) {
      router.push(`/tokens/${tokenId}`);
    }
  };

  const sortedTokens = useMemo(() => {
    if (!sortConfig) return filteredTokens;
    return [...filteredTokens].sort((a, b) => {
      const aValue = a[sortConfig.key];
      const bValue = b[sortConfig.key];
      if (aValue === undefined || bValue === undefined) return 0;
      if (typeof aValue === 'string' && typeof bValue === 'string') {
        return sortConfig.direction === 'asc'
          ? aValue.localeCompare(bValue)
          : bValue.localeCompare(aValue);
      }
      if (typeof aValue === 'number' && typeof bValue === 'number') {
        return sortConfig.direction === 'asc' ? aValue - bValue : bValue - aValue;
      }
      if (typeof aValue === 'boolean' && typeof bValue === 'boolean') {
        return sortConfig.direction === 'asc'
          ? Number(aValue) - Number(bValue)
          : Number(bValue) - Number(aValue);
      }
      return 0;
    });
  }, [filteredTokens, sortConfig]);

  const columns = [
    'symbol',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ].filter((col) => visibleColumns.includes(col));

  const formatRatio = (value: number | undefined) => (value !== undefined ? `${(value * 100).toFixed(2)}%` : '-');
  const formatBoolean = (value: boolean | undefined) => (value !== undefined ? (value ? 'Yes' : 'No') : '-');
  const formatScore = (value: number | undefined) => (value !== undefined ? value.toFixed(2) : '-');

  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => {
    const token = sortedTokens[index];
    const isInWatchlist = watchlist.some((w) => w.id === token.id);

    const handleAddToWatchlist = (e: React.MouseEvent) => {
      e.stopPropagation();
      if (!isInWatchlist) {
        addToWatchlist(token);
      }
    };

    return (
      <div
        style={style}
        className="bg-gray-800 p-2 flex items-center space-x-2 text-white rounded shadow-sm hover:bg-gray-700 transition-colors cursor-pointer"
        role="row"
        aria-label={`Token ${token.symbol}`}
        onClick={() => handleTokenClick(token.id)}
      >
        {columns.map((col) => (
          <div key={col} className="flex-1 text-sm truncate" role="cell">
            {col === 'symbol' ? (
              <span className="font-semibold">{token.symbol}</span>
            ) : col === 'price' ? (
              <button className="bg-green-500 text-black px-2 py-1 rounded hover:bg-green-400 transition-colors">
                Buy {formatNumber(token.price)}
              </button>
            ) : col === 'volume24h' ? (
              formatNumber(token.volume24h)
            ) : col === 'marketCap' ? (
              formatNumber(token.marketCap)
            ) : col === 'volumeMarketCapRatio' ? (
              formatRatio(token.volumeMarketCapRatio)
            ) : col === 'isVolumeHealthy' ? (
              formatBoolean(token.isVolumeHealthy)
            ) : col === 'pumpDumpRiskScore' ? (
              formatScore(token.pumpDumpRiskScore)
            ) : col === 'liquidityScore' ? (
              formatScore(token.liquidityScore)
            ) : col === 'walletDistributionScore' ? (
              formatScore(token.walletDistributionScore)
            ) : (
              '-'
            )}
          </div>
        ))}
        <button
          onClick={handleAddToWatchlist}
          className={`p-1 rounded-full ${
            isInWatchlist ? 'text-yellow-500' : 'text-gray-400 hover:text-yellow-500'
          } transition-colors`}
          aria-label={isInWatchlist ? 'Remove from watchlist' : 'Add to watchlist'}
        >
          <FaStar />
        </button>
      </div>
    );
  };

  return (
    <div className="p-4 space-y-4">
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <input
          type="text"
          placeholder="Search tokens..."
          value={searchQuery}
          onChange={handleSearchChange}
          className="w-full sm:max-w-xs p-2 border border-gray-600 rounded bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
          aria-label="Search tokens"
        />
        <div className="flex flex-wrap gap-2">
          <select
            onChange={(e) => requestSort(e.target.value as keyof Token)}
            className="p-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            value={sortConfig?.key || ''}
            aria-label="Sort tokens by"
          >
            <option value="">Sort By</option>
            <option value="marketCap">Market Cap</option>
            <option value="volume24h">Volume 24h</option>
            <option value="price">Price</option>
            <option value="liquidityScore">Liquidity Score</option>
            <option value="pumpDumpRiskScore">Pump/Dump Risk</option>
            <option value="walletDistributionScore">Wallet Dist Score</option>
          </select>
          <button
            onClick={showColumnModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Customize table columns"
          >
            Columns
          </button>
          <button
            onClick={onFilterClick}
            className="px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Open filter drawer"
          >
            Filter
          </button>
          <button
            onClick={showSortModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 flex items-center focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Open sort options"
          >
            <FaSort className="mr-1" /> Sort
          </button>
        </div>
      </div>
      <div className="overflow-x-auto rounded-lg shadow-lg">
        <div className="min-w-full">
          <div
            className={`grid gap-2 sticky top-0 bg-gray-800 z-10 p-2 text-white font-bold border-b border-gray-700`}
            style={{
              gridTemplateColumns: columns.map(() => isMobile ? '1fr' : 'minmax(80px, 1fr)').join(' '),
            }}
            role="row"
            aria-label="Table headers"
          >
            {columns.map((col) => (
              <div
                key={col}
                className="text-sm truncate"
                role="columnheader"
                aria-sort={
                  sortConfig?.key === col
                    ? sortConfig.direction === 'asc'
                      ? 'ascending'
                      : 'descending'
                    : 'none'
                }
              >
                {col === 'symbol'
                  ? 'Symbol'
                  : col === 'volumeMarketCapRatio'
                  ? 'Vol/Mkt Cap'
                  : col === 'isVolumeHealthy'
                  ? 'Health'
                  : col === 'pumpDumpRiskScore'
                  ? 'Risk'
                  : col === 'walletDistributionScore'
                  ? 'Wallet Score'
                  : col.charAt(0).toUpperCase() + col.slice(1).replace(/([A-Z])/g, ' $1')}
              </div>
            ))}
          </div>
          <div role="grid" aria-label="Token data table" className="bg-gray-900">
            <FixedSizeList
              height={400}
              itemCount={sortedTokens.length}
              itemSize={50}
              width="100%"
            >
              {Row}
            </FixedSizeList>
          </div>
        </div>
      </div>
      {isColumnModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl">
            <h2 className="text-lg font-bold text-white mb-4">Customize Columns</h2>
            {[
              'symbol',
              'price',
              'volume24h',
              'marketCap',
              'volumeMarketCapRatio',
              'isVolumeHealthy',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map((key) => (
              <div key={key} className="flex items-center mb-3">
                <input
                  type="checkbox"
                  checked={visibleColumns.includes(key)}
                  onChange={() => toggleColumn(key)}
                  className="mr-2 h-4 w-4 text-yellow-500 bg-gray-700 border-gray-600 rounded focus:ring-yellow-500"
                  id={`column-${key}`}
                  aria-label={`Toggle ${key} column`}
                />
                <label htmlFor={`column-${key}`} className="text-white text-sm">
                  {key === 'symbol'
                    ? 'Symbol'
                    : key === 'volumeMarketCapRatio'
                    ? 'Vol/Mkt Cap'
                    : key === 'isVolumeHealthy'
                    ? 'Health'
                    : key === 'pumpDumpRiskScore'
                    ? 'Risk'
                    : key === 'walletDistributionScore'
                    ? 'Wallet Score'
                    : key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}
                </label>
              </div>
            ))}
            <button
              onClick={handleColumnClose}
              className="w-full mt-4 px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
              aria-label="Close column customization"
            >
              Done
            </button>
          </div>
        </div>
      )}
      {isSortModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl">
            <h2 className="text-lg font-bold text-white mb-4">Sort By</h2>
            {[
              'price',
              'marketCap',
              'volume24h',
              'volumeMarketCapRatio',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map((key) => (
              <div key={key} className="mb-3">
                <button
                  onClick={() => requestSort(key as keyof Token)}
                  className="w-full text-left p-2 bg-gray-700 rounded hover:bg-gray-600 text-white flex justify-between focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
                  aria-label={`Sort by ${key}`}
                >
                  <span>
                    {key === 'volumeMarketCapRatio'
                      ? 'Vol/Mkt Cap'
                      : key === 'isVolumeHealthy'
                      ? 'Health'
                      : key === 'pumpDumpRiskScore'
                      ? 'Risk'
                      : key === 'walletDistributionScore'
                      ? 'Wallet Score'
                      : key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}
                  </span>
                  <span>{sortConfig?.key === key ? (sortConfig.direction === 'asc' ? 'â†‘' : 'â†“') : ''}</span>
                </button>
              </div>
            ))}
            <button
              onClick={handleSortClose}
              className="w-full mt-4 px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
              aria-label="Close sort options"
            >
              Done
            </button>
          </div>
        </div>
      )}
      <FilterDrawer isOpen={isFilterDrawerOpen} onClose={onFilterClose} />
    </div>
  );
});

export default TokenTable;
=== .\components\WelcomeScreen.tsx ===
import React, { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import localforage from 'localforage';

const WelcomeScreen: React.FC<{ onFinish: () => void }> = ({ onFinish }) => {
  const [show, setShow] = useState(false);

  useEffect(() => {
    const checkLastVisit = async () => {
      const lastVisit = await localforage.getItem<number>('lastVisit');
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

      if (!lastVisit || now - lastVisit > oneDay) {
        setShow(true);
        await localforage.setItem('lastVisit', now);
      } else {
        onFinish();
      }
    };

    checkLastVisit();
  }, [onFinish]);

  if (!show) return null;

  return (
    <motion.div
      initial={{ opacity: 1 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 1 }}
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100vw',
        height: '100vh',
        background: '#001529',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        zIndex: 2000,
      }}
      onAnimationComplete={() => {
        setTimeout(() => {
          setShow(false);
          onFinish();
        }, 2000);
      }}
    >
      <motion.div
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: 'spring', stiffness: 260, damping: 20 }}
      >
        {/* Replace with your logo */}
        <div style={{ fontSize: 48, color: '#fff', fontWeight: 'bold' }}>
          Sunnalytics
        </div>
      </motion.div>
    </motion.div>
  );
};

export default WelcomeScreen;
=== .\hooks\useTokenData.ts ===
import { useEffect } from 'react';
import useSWR from 'swr';
import { useTokenStore } from '../stores/useTokenStore';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  createdAt: string;
  updatedAt: string;
  volatilityScore24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
}

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';
const API_KEY = process.env.NEXT_PUBLIC_API_KEY;

const fetcher = async (url: string) => {
  const headers: HeadersInit = {};
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    throw new Error(`Failed to fetch: ${res.statusText}`);
  }
  const data = await res.json();
  return Array.isArray(data) ? data : [data];
};

export function useTokenData() {
  const { setTokens, setFilteredTokens, setLoading, setError, fetchTokens } = useTokenStore();

  const { data, error, isLoading } = useSWR<Token[]>(`${API_BASE_URL}/api/tokens`, fetcher, {
    revalidateOnFocus: false,
    revalidateOnReconnect: false,
  });

  useEffect(() => {
    setLoading(isLoading);
    if (error) {
      setError(error.message || 'An unknown error occurred');
    } else if (data) {
      setTokens(data);
      setFilteredTokens(data);
      setError(null);
    }
  }, [data, error, isLoading, setTokens, setFilteredTokens, setLoading, setError]);

  return { fetchTokens };
}
=== .\pages\ai-picks.tsx ===
// pages/ai-picks.tsx
import React, { useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import { useRouter } from 'next/router';
import BottomNav from '../components/BottomNav';

// Define the Token type if not imported from elsewhere
type Token = {
  id: string;
  symbol: string;
  updatedAt?: string; // Added updatedAt
  volumeMarketCapRatio?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  isVolumeHealthy?: boolean;
  stats?: {
    priceChange24h?: number;
    liquidityScore?: number;
  };
  // Add other properties as needed
};

function formatDate(dateString?: string) {
  if (!dateString) return 'N/A';
  const date = new Date(dateString);
  return date.toLocaleString('en-GB', {
    day: '2-digit',
    month: 'long',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    hour12: true
  }).replace(',', '');
}

export default function AIPicks() {
  const { tokens, setFilteredTokens } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const router = useRouter();

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const getBoomingTokens = (tokens: Token[]) => {
    return tokens
      .filter(token =>           
          token.volumeMarketCapRatio !== undefined &&
          token.liquidityScore !== undefined &&
          token.pumpDumpRiskScore !== undefined &&
          token.walletDistributionScore !== undefined &&
          token.liquidityScore > 50 &&
          token.pumpDumpRiskScore < 30 &&
          token.walletDistributionScore > 70 &&
          token.isVolumeHealthy)
      .sort((a, b) => {
        const aScore = (a.volumeMarketCapRatio || 0) * (a.liquidityScore || 0);
        const bScore = (b.volumeMarketCapRatio || 0) * (b.liquidityScore || 0);
        return bScore - aScore;
      })
      .slice(0, 5);
  };

  const boomingTokens = getBoomingTokens(tokens);

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">AI Picks</h1>
      <p className="mb-4">Top 5 potential booming tokens based on volume/market cap ratio and liquidity score:</p>
      {boomingTokens.length > 0 ? (
        <ul className="space-y-2">
          {boomingTokens.map(token => (
            <li key={token.id} className="bg-gray-800 p-2 rounded shadow-sm hover:bg-gray-700 cursor-pointer" onClick={() => router.push(`/tokens/${token.id}`)}>
              {token.symbol} - Vol/Mkt Cap: {(token.volumeMarketCapRatio || 0 * 100).toFixed(2)}%, Liquidity: {(token.liquidityScore || 0).toFixed(2)}, Pump/Dump Risk: {token.pumpDumpRiskScore}, Wallet Distribution: {token.walletDistributionScore}
              <div className="text-xs text-gray-400 mt-1">Updated: {formatDate(token.updatedAt)}</div>
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-gray-400">No tokens available for analysis.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\charts.tsx ===
// pages/charts.tsx
import React, { useState, useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import { Line } from 'react-chartjs-2';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js';
import BottomNav from '../components/BottomNav';

ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend);

export default function Charts() {
  const { tokens } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const [selectedToken, setSelectedToken] = useState<string | null>(null);
  const [chartData, setChartData] = useState<any>(null);

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  useEffect(() => {
    if (selectedToken && tokens.length > 0) {
      const token = tokens.find(t => t.symbol === selectedToken);
      if (token) {
        // Mock historical data (replace with real API data if available)
        const labels = ['June 10', 'June 12', 'June 14', 'June 16', 'June 18'];
        const priceData = [token.price || 0, (token.price || 0) * 1.1, (token.price || 0) * 1.2, (token.price || 0) * 1.15, (token.price || 0) * 1.3];
        const volumeData = [(token.volume24h || 0), (token.volume24h || 0) * 0.9, (token.volume24h || 0) * 1.1, (token.volume24h || 0) * 1.05, (token.volume24h || 0) * 1.2];
        const marketCapData = [token.marketCap || 0, (token.marketCap || 0) * 1.15, (token.marketCap || 0) * 1.25, (token.marketCap || 0) * 1.2, (token.marketCap || 0) * 1.35];

        setChartData({
          labels,
          datasets: [
            {
              label: 'Price (USD)',
              data: priceData,
              borderColor: 'rgb(75, 192, 192)',
              backgroundColor: 'rgba(75, 192, 192, 0.5)',
              yAxisID: 'y1',
            },
            {
              label: 'Volume (24h)',
              data: volumeData,
              borderColor: 'rgb(255, 99, 132)',
              backgroundColor: 'rgba(255, 99, 132, 0.5)',
              yAxisID: 'y2',
            },
            {
              label: 'Market Cap',
              data: marketCapData,
              borderColor: 'rgb(54, 162, 235)',
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              yAxisID: 'y3',
            },
          ],
        });
      }
    }
  }, [selectedToken, tokens]);

  const options = {
    responsive: true,
    plugins: {
      legend: { position: 'top' as const },
      title: { display: true, text: 'Token Price, Volume, and Market Cap Trends' },
    },
    scales: {
      y1: { 
        type: 'linear' as const, 
        position: 'left' as const, 
        title: { display: true, text: 'Price (USD)' } 
      },
      y2: { 
        type: 'linear' as const, 
        position: 'right' as const, 
        title: { display: true, text: 'Volume (USD)' }, 
        grid: { drawOnChartArea: false } 
      },
      y3: { 
        type: 'linear' as const, 
        position: 'right' as const, 
        title: { display: true, text: 'Market Cap (USD)' }, 
        grid: { drawOnChartArea: false }, 
        min: 0 
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Charts</h1>
      <select
        onChange={e => setSelectedToken(e.target.value)}
        className="p-2 mb-4 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-yellow-500"
        value={selectedToken || ''}
      >
        <option value="">Select a Token</option>
        {tokens.map(token => (
          <option key={token.id} value={token.symbol}>{token.symbol}</option>
        ))}
      </select>
      {chartData && selectedToken ? (
        <div>
          <Line data={chartData} options={options} />
        </div>
      ) : (
        <p className="text-gray-400">Select a token to view charts.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\index.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import TokenTable from '../components/TokenTable';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import TabbedFilters from '../components/TabbedFilters';

export default function Home() {
  const { loading, error, fetchTokens, searchQuery, sortConfig, filters, activeTab, setFilteredTokens, tokens } =
    useTokenStore();
  const { fetchTokens: fetchData } = useTokenData();
  const [isFilterDrawerOpen, setIsFilterDrawerOpen] = useState(false);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  useEffect(() => {
    let filtered = [...tokens];

    // Apply search
    if (searchQuery) {
      filtered = filtered.filter(
        token =>
          token.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          token.symbol.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }

    // Apply tab filter
    if (activeTab !== 'all') {
      filtered = filtered.filter(token => token.category.toLowerCase() === activeTab);
    }

    // Apply filters
    if (filters.category) {
      filtered = filtered.filter(token => token.category === filters.category);
    }
    if (filters.minPrice) {
      const min = parseFloat(filters.minPrice);
      filtered = filtered.filter(token => token.price !== undefined && token.price >= min);
    }
    if (filters.maxPrice) {
      const max = parseFloat(filters.maxPrice);
      filtered = filtered.filter(token => token.price !== undefined && token.price <= max);
    }
    if (filters.minVolumeMarketCapRatio) {
      const min = parseFloat(filters.minVolumeMarketCapRatio) / 100;
      filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio >= min);
    }
    if (filters.maxVolumeMarketCapRatio) {
      const max = parseFloat(filters.maxVolumeMarketCapRatio) / 100;
      filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio <= max);
    }
    if (filters.minCirculatingSupplyPercentage) {
      const min = parseFloat(filters.minCirculatingSupplyPercentage);
      filtered = filtered.filter(
        token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage >= min
      );
    }
    if (filters.maxCirculatingSupplyPercentage) {
      const max = parseFloat(filters.maxCirculatingSupplyPercentage);
      filtered = filtered.filter(
        token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage <= max
      );
    }
    if (filters.isVolumeHealthy === 'true') {
      filtered = filtered.filter(token => token.isVolumeHealthy === true);
    } else if (filters.isVolumeHealthy === 'false') {
      filtered = filtered.filter(token => token.isVolumeHealthy === false);
    }
    if (filters.isCirculatingSupplyGood === 'true') {
      filtered = filtered.filter(token => token.isCirculatingSupplyGood === true);
    } else if (filters.isCirculatingSupplyGood === 'false') {
      filtered = filtered.filter(token => token.isCirculatingSupplyGood === false);
    }

    // Apply sorting
    if (sortConfig) {
      filtered = [...filtered].sort((a, b) => {
        const aValue = a[sortConfig.key];
        const bValue = b[sortConfig.key];
        if (aValue === undefined || bValue === undefined) return 0;
        if (sortConfig.direction === 'asc') {
          return aValue > bValue ? 1 : -1;
        }
        return aValue < bValue ? 1 : -1;
      });
    }

    setFilteredTokens(filtered);
  }, [searchQuery, activeTab, filters, sortConfig, tokens, setFilteredTokens]);

  const handleFilterClick = () => {
    setIsFilterDrawerOpen(true);
  };

  const handleFilterClose = () => {
    setIsFilterDrawerOpen(false);
  };

  return (
    <div className="min-h-screen flex flex-col pb-safe-area-inset-bottom bg-gray-900 text-white">
      <main className="flex-1 p-4">
        <div className="flex justify-between items-center mb-4">
          <h1 className="text-2xl font-bold">Market</h1>
          <div className="text-sm text-gray-400">Watchlist</div>
        </div>
        <TabbedFilters />
        {loading && <p className="text-center text-gray-400">Loading tokens...</p>}
        {error && (
          <p className="text-center text-red-500">
            Error: {error}{' '}
            <button onClick={fetchTokens} className="text-blue-500 underline">
              Retry
            </button>
          </p>
        )}
        {!loading && !error && (
          <TokenTable
            isFilterDrawerOpen={isFilterDrawerOpen}
            onFilterClick={handleFilterClick}
            onFilterClose={handleFilterClose}
          />
        )}
      </main>
      <BottomNav onFilterClick={handleFilterClick} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\settings.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import localforage from 'localforage';

export default function Settings() {
  const [isMounted, setIsMounted] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    setIsMounted(true);
    localforage.getItem('darkMode').then(value => {
      const darkMode = value as boolean;
      setIsDarkMode(darkMode || false);
      if (darkMode) {
        document.documentElement.classList.add('dark');
      }
    });
  }, []);

  const toggleDarkMode = () => {
    const newDarkMode = !isDarkMode;
    setIsDarkMode(newDarkMode);
    localforage.setItem('darkMode', newDarkMode);
    if (newDarkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };

  const handleReset = () => {
    localforage.clear();
    setIsDarkMode(false);
    document.documentElement.classList.remove('dark');
  };

  if (!isMounted) return null;

  return (
    <div className="min-h-screen flex flex-col pb-16">
      <main className="flex-1 p-4">
        <h1 className="text-2xl font-bold mb-4">Settings</h1>
        <div className="mb-4 flex items-center justify-between">
          <span className="text-lg">Dark Mode</span>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={isDarkMode}
              onChange={toggleDarkMode}
              className="sr-only"
            />
            <div
              className={`w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 ${
                isDarkMode ? 'bg-blue-600' : ''
              }`}
            >
              <div
                className={`absolute w-5 h-5 bg-white rounded-full transition-transform duration-200 ease-in-out ${
                  isDarkMode ? 'translate-x-5' : 'translate-x-0'
                }`}
              ></div>
            </div>
          </label>
        </div>
        <button
          onClick={handleReset}
          className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
        >
          Reset All Settings
        </button>
      </main>
      <BottomNav />
    </div>
  );
}
=== .\pages\watchlist.tsx ===
// pages/watchlist.tsx
import React, { useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useRouter } from 'next/router';
import BottomNav from '../components/BottomNav';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

export default function Watchlist() {
  const { watchlist, fetchTokens } = useTokenStore();
  const router = useRouter();

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const formatNumber = (value: number | undefined, suffix: string = ''): string => {
    if (value === undefined || value === 0) return '-';
    if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
    if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
    return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
  };

  const formatRatio = (value: number | undefined) => value !== undefined ? `${(value * 100).toFixed(2)}%` : '-';
  const formatBoolean = (value: boolean | undefined) => value !== undefined ? (value ? 'Yes' : 'No') : '-';
  const formatScore = (value: number | undefined) => value !== undefined ? value.toFixed(2) : '-';

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Watchlist</h1>
      {watchlist.length > 0 ? (
        <ul className="space-y-4">
          {watchlist.map((token: Token) => (
            <li
              key={token.id}
              className="bg-gray-800 p-4 rounded-lg shadow-sm hover:bg-gray-700 transition-colors cursor-pointer"
              onClick={() => router.push(`/tokens/${token.id}`)}
            >
              <div className="flex flex-col sm:flex-row sm:items-center justify-between">
                <div>
                  <h2 className="text-lg font-semibold">{token.symbol}</h2>
                  <p className="text-sm text-gray-400">{token.name} - {token.category}</p>
                </div>
                <div className="mt-2 sm:mt-0 space-y-1">
                  <p>Price: {formatNumber(token.price)}</p>
                  <p>Market Cap: {formatNumber(token.marketCap)}</p>
                  <p>Volume (24h): {formatNumber(token.volume24h)}</p>
                  <p>Vol/Mkt Cap: {formatRatio(token.volumeMarketCapRatio)}</p>
                  <p>Health: {formatBoolean(token.isVolumeHealthy)}</p>
                  <p>Liquidity Score: {formatScore(token.liquidityScore)}</p>
                </div>
              </div>
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-gray-400">No tokens in watchlist. Add tokens from the Market page.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\welcome.tsx ===
import { useEffect } from 'react';
import { useRouter } from 'next/router';
import localforage from 'localforage';

export default function Welcome() {
  const router = useRouter();

  useEffect(() => {
    localforage.getItem('welcomeScreenSeen').then(value => {
      if (value) {
        router.push('/');
      }
    });
  }, [router]);

  const handleContinue = () => {
    localforage.setItem('welcomeScreenSeen', true);
    router.push('/');
  };

  return (
    <div className="min-h-screen flex flex-col justify-center items-center bg-gray-100 p-4">
      <h1 className="text-3xl font-bold mb-4">Welcome to Sunnalytics</h1>
      <p className="text-lg text-gray-600 mb-6 text-center">
        Your go-to platform for token analytics and insights.
      </p>
      <button
        onClick={handleContinue}
        className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
      >
        Continue
      </button>
    </div>
  );
}
=== .\pages\_app.tsx ===
import '../styles/globals.css';
import type { AppProps } from 'next/app';
import { inter, robotoMono } from '../utils/fonts';
import Head from 'next/head';
import { useState, useEffect } from 'react';
import WelcomeScreen from '../components/WelcomeScreen';

export default function App({ Component, pageProps }: AppProps) {
  const [showWelcome, setShowWelcome] = useState(true);
  const INACTIVITY_THRESHOLD = 10 * 60 * 1000; // 10 minutes in milliseconds

  useEffect(() => {
    const lastActive = localStorage.getItem('lastActive');
    const now = new Date().getTime();

    if (lastActive) {
      const lastActiveTime = parseInt(lastActive, 10);
      const timeSinceLastActive = now - lastActiveTime;

      // Show welcome screen if inactive for more than INACTIVITY_THRESHOLD
      if (timeSinceLastActive > INACTIVITY_THRESHOLD) {
        setShowWelcome(true);
      } else {
        setShowWelcome(false);
      }
    } else {
      // First visit or no stored timestamp
      localStorage.setItem('lastActive', now.toString());
      setShowWelcome(true);
    }

    // Update last active timestamp when the app is interacted with
    const handleActivity = () => {
      localStorage.setItem('lastActive', now.toString());
    };

    window.addEventListener('mousemove', handleActivity);
    window.addEventListener('keydown', handleActivity);
    window.addEventListener('scroll', handleActivity);

    return () => {
      window.removeEventListener('mousemove', handleActivity);
      window.removeEventListener('keydown', handleActivity);
      window.removeEventListener('scroll', handleActivity);
    };
  }, []);

  const handleWelcomeFinish = () => {
    setShowWelcome(false);
  };

  return (
    <div className={`${inter.variable} ${robotoMono.variable}`}>
      <Head>
        <title>Sunnalytics</title>
        <meta name="description" content="Sunnalytics - Token Analytics Platform" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#111827" />
        <link rel="icon" href="/favicon.ico" sizes="any" />
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
        <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />
        <link rel="manifest" href="/site.webmanifest" />
      </Head>
      {showWelcome && <WelcomeScreen onFinish={handleWelcomeFinish} />}
      <Component {...pageProps} />
    </div>
  );
}
=== .\pages\tokens\[id].tsx ===
import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend, ChartOptions } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../../utils/api';
import BottomNav from '../../components/BottomNav';
import { formatNumber } from '../../components/TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);
  const [apiError, setApiError] = useState<string | null>(null);

  // Replace with your backend URL, e.g., 'https://your-backend.com'
  const BACKEND_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';

  useEffect(() => {
    if (id) {
      const url = `${BACKEND_URL}/api/tokens/${id}/history`;
      console.log(`Fetching history from: ${url}`);
      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          console.log('Token history data:', data);
          setHistory(data);
          setApiError(null);
        })
        .catch(err => {
          console.error('Error fetching history:', err.message);
          setApiError(err.message);
        });
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  // Group by date, minimal filtering
  const validHistory = history
    .filter(h => h.price != null && h.volume24h != null && h.marketCap != null && h.marketCap !== 0)
    .reduce((acc: TokenHistory[], h) => {
      const date = new Date(h.timestamp).toISOString().split('T')[0];
      const existing = acc.find(item => new Date(item.timestamp).toISOString().split('T')[0] === date);
      if (!existing) acc.push(h);
      return acc;
    }, [])
    .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());

  console.log('Valid history:', validHistory);

  const chartData = {
    labels: validHistory.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Volume/Market Cap Ratio (%)',
        data: validHistory.map(h => (h.volume24h! / h.marketCap!) * 100),
        borderColor: '#FBBF24',
        yAxisID: 'y-ratio',
      },
      {
        label: 'Price (USD)',
        data: validHistory.map(h => h.price!),
        borderColor: '#3B82F6',
        yAxisID: 'y-price',
      },
    ],
  };

  const chartOptions: ChartOptions<'line'> = {
    responsive: true,
    scales: {
      x: {
        type: 'time',
        time: { unit: 'day' },
        title: { display: true, text: 'Date' },
      },
      'y-ratio': {
        type: 'linear',
        position: 'left',
        title: { display: true, text: 'Ratio (%)' },
        beginAtZero: true,
      },
      'y-price': {
        type: 'linear',
        position: 'right',
        title: { display: true, text: 'Price ($)' },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: { display: true },
      tooltip: { mode: 'index', intersect: false },
    },
  };

  console.log('Chart data:', chartData);

  return (
    <div className="min-h-screen flex flex-col bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button onClick={() => router.back()} className="mr-4 text-yellow-400">
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg h-80">
            <h2 className="text-lg font-semibold mb-2">Historical Data</h2>
            <div className="h-64">
              {apiError ? (
                <div className="text-center text-red-500 h-full flex items-center justify-center">
                  Error: {apiError}
                </div>
              ) : validHistory.length > 0 ? (
                <Line data={chartData} options={chartOptions} />
              ) : (
                <div className="text-center text-gray-400 h-full flex items-center justify-center">
                  No history data
                </div>
              )}
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\stores\useTokenStore.ts ===
import { create } from 'zustand';
import localforage from 'localforage';
import { persist, createJSONStorage } from 'zustand/middleware';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  updatedAt?: string;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

interface FilterState {
  category: string;
  minPrice: string;
  maxPrice: string;
  minVolumeMarketCapRatio: string;
  maxVolumeMarketCapRatio: string;
  minCirculatingSupplyPercentage: string;
  maxCirculatingSupplyPercentage: string;
  isVolumeHealthy: string;
  isCirculatingSupplyGood: string;
}

interface TokenState {
  tokens: Token[];
  filteredTokens: Token[];
  watchlist: Token[];
  loading: boolean;
  error: string | null;
  searchQuery: string;
  sortConfig: { key: keyof Token; direction: 'asc' | 'desc' } | null;
  filters: FilterState;
  activeTab: string;
  visibleColumns: string[];
  setTokens: (tokens: Token[]) => void;
  setFilteredTokens: (tokens: Token[]) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  setSearchQuery: (query: string) => void;
  setSortConfig: (config: { key: keyof Token; direction: 'asc' | 'desc' } | null) => void;
  setFilters: (filters: Partial<FilterState>) => void;
  setActiveTab: (tab: string) => void;
  setVisibleColumns: (columns: string[]) => void;
  fetchTokens: () => void;
  addToWatchlist: (token: Token) => void;
}

export const useTokenStore = create<TokenState>()(
  persist(
    (set, get) => ({
      tokens: [],
      filteredTokens: [],
      watchlist: [],
      loading: false,
      error: null,
      searchQuery: '',
      sortConfig: null,
      filters: {
        category: '',
        minPrice: '',
        maxPrice: '',
        minVolumeMarketCapRatio: '',
        maxVolumeMarketCapRatio: '',
        minCirculatingSupplyPercentage: '',
        maxCirculatingSupplyPercentage: '',
        isVolumeHealthy: '',
        isCirculatingSupplyGood: '',
      },
      activeTab: 'all',
      visibleColumns: [
        'symbol',
        'price',
        'volume24h',
        'marketCap',
        'volumeMarketCapRatio',
        'isVolumeHealthy',
        'pumpDumpRiskScore',
        'liquidityScore',
        'walletDistributionScore',
      ],
      setTokens: (tokens: Token[]) => set({ tokens }),
      setFilteredTokens: (tokens: Token[]) => set({ filteredTokens: tokens }),
      setLoading: (loading: boolean) => set({ loading }),
      setError: (error: string | null) => set({ error }),
      setSearchQuery: (query: string) => set({ searchQuery: query }),
      setSortConfig: (config: { key: keyof Token; direction: 'asc' | 'desc' } | null) => set({ sortConfig: config }),
      setFilters: (filters: Partial<FilterState>) =>
        set(state => ({ filters: { ...state.filters, ...filters } })),
      setActiveTab: (tab: string) => set({ activeTab: tab }),
      setVisibleColumns: (columns: string[]) => set({ visibleColumns: columns }),
      fetchTokens: async () => {
        set({ loading: true, error: null });
        try {
          const response = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/tokens`, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          const tokens: Token[] = data.map((item: any) => ({
            id: item.id || item._id,
            name: item.name,
            symbol: item.symbol,
            category: item.category || 'Unknown',
            price: item.price,
            marketCap: item.marketCap,
            volume24h: item.volume24h,
            volumeMarketCapRatio: item.volumeMarketCapRatio,
            isVolumeHealthy: item.isVolumeHealthy,
            pumpDumpRiskScore: item.pumpDumpRiskScore,
            liquidityScore: item.liquidityScore,
            walletDistributionScore: item.walletDistributionScore,
            transferVolume24h: item.transferVolume24h,
            updatedAt: item.updatedAt,
          }));

          set({ tokens, filteredTokens: tokens, loading: false });
        } catch (err) {
          set({ error: err instanceof Error ? err.message : 'Failed to fetch tokens', loading: false });
        }
      },
      addToWatchlist: (token: Token) =>
        set((state) => ({
          watchlist: state.watchlist.some((w: Token) => w.id === token.id)
            ? state.watchlist
            : [...state.watchlist, token],
        })),
    }),
    {
      name: 'token-store',
      storage: createJSONStorage(() => localforage),
    }
  )
);
=== .\styles\globals.css ===
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --max-width: 1100px;
  --border-radius: 12px;
  --font-mono: var(--font-roboto-mono), ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono',
    'Roboto Mono', 'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro',
    'Fira Mono', 'Droid Sans Mono', 'Courier New', monospace;
  --primary-color: #FBBF24;
  --background-dark: #111827;
  --card-bg: #1F2A44;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
  font-family: var(--font-inter), system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
    'Helvetica Neue', Arial, sans-serif;
  background-color: var(--background-dark);
  color: #fff;
}

a {
  color: var(--primary-color);
  text-decoration: none;
}

button, input, select {
  transition: all 0.2s ease-in-out;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}
=== .\utils\api.ts ===
import useSWR from 'swr';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';

const fetcher = async (url: string) => {
  const res = await fetch(url);
  if (!res.ok) {
    const error = new Error('An error occurred while fetching the data.');
    throw error;
  }
  return res.json();
};

export function useTokens(category?: string) {
  const url = category
    ? `${API_BASE_URL}/api/tokens?category=${category}`
    : `${API_BASE_URL}/api/tokens`;
  const { data, error, isLoading } = useSWR(url, fetcher, {
    refreshInterval: 60000,
    revalidateOnFocus: false,
  });
  return { tokens: data, error, isLoading };
}

export async function refreshTokens() {
  const res = await fetch(`${API_BASE_URL}/api/tokens/refresh`, { method: 'POST' });
  if (!res.ok) {
    throw new Error('Failed to refresh tokens');
  }
  return res.json();
}
=== .\utils\fonts.ts ===
import { Inter, Roboto_Mono } from 'next/font/google';

export const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter',
});

export const robotoMono = Roboto_Mono({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-roboto-mono',
});
=== .\utils\tokenStats.ts ===
export interface TokenStats {
  priceChange24h: number;
  volatilityScore24h: number;
  liquidityScore: number;
  transferVolume24h: number;
}

export function calculateTokenStats(data: {
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  circulatingSupply: number | null;
  totalSupply: number | null;
  priceChange24h?: number | null;
  transferAmount?: number;
}): TokenStats {
  const { price, marketCap, volume24h, circulatingSupply, priceChange24h, transferAmount } = data;

  const change24h = priceChange24h ?? 0;
  const volatility = volume24h && marketCap ? (volume24h / marketCap) : 0;
  const liquidityScore = volume24h && circulatingSupply ? volume24h / circulatingSupply : 0;
  const transferVol24h = transferAmount ?? 0;

  return {
    priceChange24h: Number(change24h.toFixed(2)),
    volatilityScore24h: Number(volatility.toFixed(2)),
    liquidityScore: Number(liquidityScore.toFixed(2)),
    transferVolume24h: Number(transferVol24h.toFixed(2)),
  };
}

=== .\tailwind.config.js ===
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
=== .\tree.txt ===
Project Tree (excluding node_modules, .next, package-lock.json):

â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ all_files_combined.txt
â”œâ”€â”€ combine_files.py
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”œâ”€â”€ FilterDrawer.tsx
â”‚   â”œâ”€â”€ TabbedFilters.tsx
â”‚   â”œâ”€â”€ TokenDetails.tsx
â”‚   â”œâ”€â”€ TokenTable.tsx
â”‚   â””â”€â”€ WelcomeScreen.tsx
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ generate_tree.py
â”œâ”€â”€ hooks
â”‚   â””â”€â”€ useTokenData.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ _app.tsx
â”‚   â”œâ”€â”€ ai-picks.tsx
â”‚   â”œâ”€â”€ api
â”‚   â”œâ”€â”€ charts.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â”œâ”€â”€ settings.tsx
â”‚   â”œâ”€â”€ tokens
â”‚   â”‚   â””â”€â”€ [id].tsx
â”‚   â”œâ”€â”€ watchlist.tsx
â”‚   â””â”€â”€ welcome.tsx
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ src
â”œâ”€â”€ stores
â”‚   â””â”€â”€ useTokenStore.ts
â”œâ”€â”€ styles
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ sunnalytics-dev.txt
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tree.txt
â”œâ”€â”€ tsconfig.json
â””â”€â”€ utils
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ fonts.ts
    â””â”€â”€ tokenStats.ts
=== .\tsconfig.json ===
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", "postcss.config.js"],
  "exclude": ["node_modules"]
}

=== .\components\BottomNav.tsx ===
// components/BottomNav.tsx
import React from 'react';
import { useRouter } from 'next/router';
import { FaChartLine, FaFilter, FaSearch, FaHome, FaStar, FaRobot } from 'react-icons/fa';

interface BottomNavProps {
  onFilterClick?: () => void;
  onSearchFocus?: () => void;
}

const BottomNav: React.FC<BottomNavProps> = ({ onFilterClick, onSearchFocus }) => {
  const router = useRouter();

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-gray-800 h-20 p-2 flex justify-around items-center border-t border-gray-700 shadow-lg pb-safe-area-inset-bottom">
      <button
        onClick={() => router.push('/')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaHome className="text-lg mb-1" />
        <span>Market</span>
      </button>
      <button
        onClick={() => router.push('/watchlist')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/watchlist' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaStar className="text-lg mb-1" />
        <span>Watchlist</span>
      </button>
      <button
        onClick={onSearchFocus}
        className="flex flex-col items-center text-xs text-gray-400 hover:text-yellow-400 transition-all duration-200 hover:scale-110"
      >
        <FaSearch className="text-lg mb-1" />
        <span>Search</span>
      </button>
      <button
        onClick={() => router.push('/ai-picks')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/ai-picks' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaRobot className="text-lg mb-1" />
        <span>AI Picks</span>
      </button>
      <button
        onClick={() => router.push('/charts')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/charts' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaChartLine className="text-lg mb-1" />
        <span>Charts</span>
      </button>
    </nav>
  );
};

export default BottomNav;
=== .\components\FilterDrawer.tsx ===
import React from 'react';
import { useTokenStore } from '../stores/useTokenStore';

interface FilterDrawerProps {
  isOpen: boolean;
  onClose: () => void;
}

const FilterDrawer: React.FC<FilterDrawerProps> = ({ isOpen, onClose }) => {
  const { filters, setFilters, setFilteredTokens, tokens } = useTokenStore();

  const handleFilterChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFilters({ [name]: value });
  };

  const applyFilters = () => {
    const filtered = tokens.filter(token => {
      const {
        category,
        minPrice,
        maxPrice,
        minVolumeMarketCapRatio,
        maxVolumeMarketCapRatio,
        minCirculatingSupplyPercentage,
        maxCirculatingSupplyPercentage,
        isVolumeHealthy,
        isCirculatingSupplyGood,
      } = filters;

      let isMatch = true;

      if (category && token.category !== category) {
        isMatch = false;
      }
      if (minPrice && token.price && token.price < parseFloat(minPrice)) {
        isMatch = false;
      }
      if (maxPrice && token.price && token.price > parseFloat(maxPrice)) {
        isMatch = false;
      }
      if (minVolumeMarketCapRatio && token.volumeMarketCapRatio && token.volumeMarketCapRatio < parseFloat(minVolumeMarketCapRatio)) {
        isMatch = false;
      }
      if (maxVolumeMarketCapRatio && token.volumeMarketCapRatio && token.volumeMarketCapRatio > parseFloat(maxVolumeMarketCapRatio)) {
        isMatch = false;
      }
      if (minCirculatingSupplyPercentage && token.circulatingSupplyPercentage && token.circulatingSupplyPercentage < parseFloat(minCirculatingSupplyPercentage)) {
        isMatch = false;
      }
      if (maxCirculatingSupplyPercentage && token.circulatingSupplyPercentage && token.circulatingSupplyPercentage > parseFloat(maxCirculatingSupplyPercentage)) {
        isMatch = false;
      }
      if (isVolumeHealthy && token.isVolumeHealthy !== (isVolumeHealthy === 'true')) {
        isMatch = false;
      }
      if (isCirculatingSupplyGood && token.isCirculatingSupplyGood !== (isCirculatingSupplyGood === 'true')) {
        isMatch = false;
      }

      return isMatch;
    });

    setFilteredTokens(filtered);
    onClose();
  };

  const resetFilters = () => {
    setFilters({
      category: '',
      minPrice: '',
      maxPrice: '',
      minVolumeMarketCapRatio: '',
      maxVolumeMarketCapRatio: '',
      minCirculatingSupplyPercentage: '',
      maxCirculatingSupplyPercentage: '',
      isVolumeHealthy: '',
      isCirculatingSupplyGood: '',
    });
    setFilteredTokens(tokens);
    onClose();
  };

  return (
    <div
      className={`fixed inset-y-0 right-0 w-full sm:w-80 bg-gray-800 text-white shadow-xl transform transition-transform duration-300 ease-in-out z-50 ${
        isOpen ? 'translate-x-0' : 'translate-x-full'
      }`}
      role="dialog"
      aria-label="Filter Drawer"
    >
      <div className="p-6 h-full flex flex-col">
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-lg font-bold">Filter Tokens</h2>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 rounded-lg"
            aria-label="Close filter drawer"
          >
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div className="flex-1 space-y-4 overflow-y-auto">
          <div>
            <label htmlFor="category" className="block text-sm font-medium text-gray-400">
              Category
            </label>
            <select
              id="category"
              name="category"
              value={filters.category}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              aria-label="Filter by category"
            >
              <option value="">All</option>
              <option value="DeFi">DeFi</option>
              <option value="NFT">NFT</option>
              <option value="Gaming">Gaming</option>
              <option value="Meme">Meme</option>
            </select>
          </div>
          <div>
            <label htmlFor="minPrice" className="block text-sm font-medium text-gray-400">
              Min Price
            </label>
            <input
              id="minPrice"
              name="minPrice"
              type="number"
              value={filters.minPrice}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              placeholder="e.g. 0.01"
              aria-label="Minimum price filter"
            />
          </div>
          <div>
            <label htmlFor="maxPrice" className="block text-sm font-medium text-gray-400">
              Max Price
            </label>
            <input
              id="maxPrice"
              name="maxPrice"
              type="number"
              value={filters.maxPrice}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              placeholder="e.g. 100"
              aria-label="Maximum price filter"
            />
          </div>
          <div>
            <label htmlFor="minVolumeMarketCapRatio" className="block text-sm font-medium text-gray-400">
              Min Volume/Market Cap Ratio
            </label>
            <input
              id="minVolumeMarketCapRatio"
              name="minVolumeMarketCapRatio"
              type="number"
              value={filters.minVolumeMarketCapRatio}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              placeholder="e.g. 0.01"
              aria-label="Minimum volume/market cap ratio filter"
            />
          </div>
          <div>
            <label htmlFor="maxVolumeMarketCapRatio" className="block text-sm font-medium text-gray-400">
              Max Volume/Market Cap Ratio
            </label>
            <input
              id="maxVolumeMarketCapRatio"
              name="maxVolumeMarketCapRatio"
              type="number"
              value={filters.maxVolumeMarketCapRatio}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              placeholder="e.g. 0.1"
              aria-label="Maximum volume/market cap ratio filter"
            />
          </div>
          <div>
            <label htmlFor="minCirculatingSupplyPercentage" className="block text-sm font-medium text-gray-400">
              Min Circulating Supply %
            </label>
            <input
              id="minCirculatingSupplyPercentage"
              name="minCirculatingSupplyPercentage"
              type="number"
              value={filters.minCirculatingSupplyPercentage}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              placeholder="e.g. 10"
              aria-label="Minimum circulating supply percentage filter"
            />
          </div>
          <div>
            <label htmlFor="maxCirculatingSupplyPercentage" className="block text-sm font-medium text-gray-400">
              Max Circulating Supply %
            </label>
            <input
              id="maxCirculatingSupplyPercentage"
              name="maxCirculatingSupplyPercentage"
              type="number"
              value={filters.maxCirculatingSupplyPercentage}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              placeholder="e.g. 90"
              aria-label="Maximum circulating supply percentage filter"
            />
          </div>
          <div>
            <label htmlFor="isVolumeHealthy" className="block text-sm font-medium text-gray-400">
              Volume Healthy
            </label>
            <select
              id="isVolumeHealthy"
              name="isVolumeHealthy"
              value={filters.isVolumeHealthy}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              aria-label="Filter by volume healthy"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
          <div>
            <label htmlFor="isCirculatingSupplyGood" className="block text-sm font-medium text-gray-400">
              Circulating Supply Good
            </label>
            <select
              id="isCirculatingSupplyGood"
              name="isCirculatingSupplyGood"
              value={filters.isCirculatingSupplyGood}
              onChange={handleFilterChange}
              className="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
              aria-label="Filter by circulating supply good"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>
        <div className="flex gap-2 mt-6">
          <button
            onClick={applyFilters}
            className="w-full px-4 py-2 bg-yellow-500 text-black rounded-lg hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
            aria-label="Apply filters"
          >
            Apply
          </button>
          <button
            onClick={resetFilters}
            className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
            aria-label="Reset filters"
          >
            Reset
          </button>
        </div>
      </div>
    </div>
  );
}

export default FilterDrawer;
=== .\components\TabbedFilters.tsx ===
// components/TabbedFilters.tsx
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useTokenStore } from '../stores/useTokenStore';

const tabs = [
  { id: 'all', label: 'All' },
  { id: 'highlights', label: 'Highlights', badge: 'ðŸ”¥' },
  { id: 'trending', label: 'Trending', badge: 'ðŸ“ˆ' },
  { id: 'pumpfun', label: 'Pump.fun' },
  { id: 'ecosystems', label: 'Ecosystems' },
];

const TabbedFilters: React.FC = () => {
  const { setFilteredTokens, tokens } = useTokenStore();
  const [activeTab, setActiveTab] = useState('all');

  const handleTabClick = (tabId: string) => {
    setActiveTab(tabId);
    if (tabId === 'all') {
      setFilteredTokens(tokens);
    } else {
      setFilteredTokens(tokens.filter(token => token.category.toLowerCase() === tabId));
    }
  };

  return (
    <div className="mb-4">
      <div
        className="flex space-x-2 overflow-x-auto pb-2"
        role="tablist"
        aria-label="Token Categories"
      >
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => handleTabClick(tab.id)}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              activeTab === tab.id
                ? 'bg-yellow-500 text-black'
                : 'bg-gray-700 text-white hover:bg-gray-600'
            }`}
            role="tab"
            aria-selected={activeTab === tab.id}
            aria-controls={`panel-${tab.id}`}
          >
            {tab.label}
            {tab.badge && <span className="ml-1">{tab.badge}</span>}
          </button>
        ))}
      </div>
      <AnimatePresence>
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -10 }}
          transition={{ duration: 0.3 }}
          id={`panel-${activeTab}`}
          role="tabpanel"
          aria-labelledby={activeTab}
        >
          {/* Content managed by TokenTable */}
        </motion.div>
      </AnimatePresence>
    </div>
  );
};

export default TabbedFilters;
=== .\components\TokenDetails.tsx ===
import React, { useState } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../utils/api';
import BottomNav from './BottomNav';
import { formatNumber } from './TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);

  React.useEffect(() => {
    if (id) {
      fetch(`/api/tokens/${id}/history`)
        .then(res => res.json())
        .then(data => setHistory(data))
        .catch(err => console.error('Error fetching history:', err));
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  const chartData = {
    labels: history.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Price (USD)',
        data: history.map(h => h.price || 0),
        borderColor: '#FBBF24',
        backgroundColor: 'rgba(251, 191, 36, 0.2)',
        fill: true,
        tension: 0.4,
      },
    ],
  };

  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        type: 'time' as const,
        time: {
          unit: 'day' as const, // Explicitly set to 'day'
          tooltipFormat: 'MMM d, yyyy HH:mm',
        },
        title: {
          display: true,
          text: 'Date',
          color: '#fff',
        },
      },
      y: {
        title: {
          display: true,
          text: 'Price (USD)',
          color: '#fff',
        },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: {
        labels: {
          color: '#fff',
        },
      },
      tooltip: {
        callbacks: {
          label: (context: any) => `Price: $${context.parsed.y.toFixed(2)}`,
          title: (tooltipItems: any[]) => {
            return new Date(tooltipItems[0].parsed.x).toLocaleString();
          },
        },
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col pb-16 bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button
          onClick={() => router.back()}
          className="mr-4 text-yellow-400 hover:text-yellow-300"
          aria-label="Go back"
        >
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4 space-y-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg shadow">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg shadow h-80">
            <h2 className="text-lg font-semibold mb-2">Price History</h2>
            <div className="h-64">
              <Line data={chartData} options={chartOptions} />
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\components\TokenTable.tsx ===
import React, { useState, useMemo, memo, useCallback, useEffect } from 'react';
import { useRouter } from 'next/router';
import { useTokenStore } from '../stores/useTokenStore';
import FilterDrawer from './FilterDrawer';
import { FaSort, FaStar } from 'react-icons/fa';
import { FixedSizeList, ListChildComponentProps } from 'react-window';
import debounce from 'lodash.debounce';
import { useMediaQuery } from 'react-responsive';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  updatedAt?: string;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

interface TokenTableProps {
  isFilterDrawerOpen: boolean;
  onFilterClick: () => void;
  onFilterClose: () => void;
}

export const formatNumber = (value: number | undefined, suffix: string = '') => {
  if (value === undefined || value === 0) return '-';
  if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
  if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
  return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
};

export const formatRatio = (value: number | undefined) => (value !== undefined ? `${(value * 100).toFixed(2)}%` : '-');

export const formatBoolean = (value: boolean | undefined) => (value !== undefined ? (value ? 'Yes' : 'No') : '-');

export const formatScore = (value: number | undefined) => (value !== undefined ? (value * 100).toFixed(2) : '-');

const TokenTable: React.FC<TokenTableProps> = memo(({ isFilterDrawerOpen, onFilterClick, onFilterClose }) => {
  const {
    filteredTokens,
    setFilteredTokens,
    tokens,
    setScrollPosition,
    scrollPosition,
    visibleColumns,
    setVisibleColumns,
    sortConfig,
    setSortConfig,
    searchQuery,
    setSearchQuery,
    addToWatchlist,
    watchlist,
  } = useTokenStore();
  const [isColumnModalVisible, setIsColumnModalVisible] = useState(false);
  const [isSortModalVisible, setIsSortModalVisible] = useState(false);
  const isMobile = useMediaQuery({ maxWidth: 640 });
  const router = useRouter();

  // Set default columns based on device
  useEffect(() => {
    const defaultColumns: string[] = isMobile
      ? ['symbol', 'volumeMarketCapRatio', 'pumpDumpRiskScore', 'liquidityScore', 'walletDistributionScore']
      : [
          'symbol',
          'price',
          'volume24h',
          'marketCap',
          'volumeMarketCapRatio',
          'isVolumeHealthy',
          'pumpDumpRiskScore',
          'liquidityScore',
          'walletDistributionScore',
        ];
    if (visibleColumns.length === 0) {
      setVisibleColumns(defaultColumns);
    }
  }, [isMobile, setVisibleColumns, visibleColumns.length]);

  const toggleColumn = (key: string) => {
    if (visibleColumns.includes(key)) {
      setVisibleColumns(visibleColumns.filter(col => col !== key));
    } else {
      setVisibleColumns([...visibleColumns, key]);
    }
  };

  const debouncedSearch = useCallback(
    debounce((query: string) => {
      setFilteredTokens(
        tokens.filter(
          token =>
            token.name.toLowerCase().includes(query.toLowerCase()) ||
            token.symbol.toLowerCase().includes(query.toLowerCase())
        )
      );
    }, 300),
    [tokens, setFilteredTokens]
  );

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const query = e.target.value;
    setSearchQuery(query);
    debouncedSearch(query);
  };

  const showColumnModal = () => {
    setIsColumnModalVisible(true);
  };

  const handleColumnClose = () => {
    setIsColumnModalVisible(false);
  };

  const showSortModal = () => {
    setIsSortModalVisible(true);
  };

  const handleSortClose = () => {
    setIsSortModalVisible(false);
  };

  const requestSort = (key: keyof Token) => {
    if (!sortConfig || sortConfig.key !== key) {
      setSortConfig({ key, direction: 'asc' });
    } else if (sortConfig.direction === 'asc') {
      setSortConfig({ key, direction: 'desc' });
    } else {
      setSortConfig(null);
    }
    handleSortClose();
  };

  const handleRowClick = (tokenId: string) => {
    router.push(`/tokens/${tokenId}`);
  };

  const sortedTokens = useMemo(() => {
    if (!sortConfig) return filteredTokens;
    return [...filteredTokens].sort((a, b) => {
      const aValue = a[sortConfig.key];
      const bValue = b[sortConfig.key];
      if (aValue === undefined || bValue === undefined) return 0;
      if (sortConfig.direction === 'asc') {
        return aValue > bValue ? 1 : -1;
      }
      return aValue < bValue ? 1 : -1;
    });
  }, [filteredTokens, sortConfig]);

  const columns = useMemo(
    () =>
      [
        'symbol',
        'price',
        'volume24h',
        'marketCap',
        'volumeMarketCapRatio',
        'isVolumeHealthy',
        'pumpDumpRiskScore',
        'liquidityScore',
        'walletDistributionScore',
        'watchlist',
      ].filter(col => col === 'watchlist' || visibleColumns.includes(col)),
    [visibleColumns]
  );

  const Row = ({ index, style }: ListChildComponentProps) => {
    const token = sortedTokens[index];
    const isInWatchlist = watchlist.some(w => w.id === token.id);

    return (
      <div
        style={style}
        className="bg-gray-800 p-3 flex items-center space-x-4 text-white rounded-lg shadow-sm hover:bg-gray-700 transition-colors duration-200 cursor-pointer"
        role="row"
        aria-label={`Token ${token.symbol}`}
        onClick={() => handleRowClick(token.id)}
      >
        {columns.map(col => (
          <div key={col} className="flex-1 text-sm truncate" role="cell">
            {col === 'symbol' ? (
              <span className="font-medium">{token.symbol}</span>
            ) : col === 'price' ? (
              <button className="bg-green-500 text-black px-3 py-1 rounded-lg hover:bg-green-400 transition-colors">
                Buy {formatNumber(token.price)}
              </button>
            ) : col === 'volume24h' ? (
              formatNumber(token.volume24h)
            ) : col === 'marketCap' ? (
              formatNumber(token.marketCap)
            ) : col === 'volumeMarketCapRatio' ? (
              formatRatio(token.volumeMarketCapRatio)
            ) : col === 'isVolumeHealthy' ? (
              formatBoolean(token.isVolumeHealthy)
            ) : col === 'pumpDumpRiskScore' ? (
              formatScore(token.pumpDumpRiskScore)
            ) : col === 'liquidityScore' ? (
              formatScore(token.liquidityScore)
            ) : col === 'walletDistributionScore' ? (
              formatScore(token.walletDistributionScore)
            ) : col === 'watchlist' ? (
              <button
                onClick={e => {
                  e.stopPropagation(); // Prevent row click from triggering navigation
                  addToWatchlist(token);
                }}
                className={`p-2 rounded-full ${isInWatchlist ? 'text-yellow-500' : 'text-gray-400'} hover:text-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-colors`}
                aria-label={isInWatchlist ? `Remove ${token.symbol} from watchlist` : `Add ${token.symbol} to watchlist`}
              >
                <FaStar />
              </button>
            ) : (
              '-'
            )}
          </div>
        ))}
      </div>
    );
  };

  return (
    <div className="p-4 sm:p-6">
      <div className="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <input
          type="text"
          placeholder="Search tokens..."
          value={searchQuery}
          onChange={handleSearchChange}
          className="w-full sm:max-w-xs p-3 border border-gray-600 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
          aria-label="Search tokens"
        />
        <div className="flex flex-wrap gap-2">
          <select
            onChange={e => requestSort(e.target.value as keyof Token)}
            className="p-3 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            value={sortConfig?.key || ''}
            aria-label="Sort tokens by"
          >
            <option value="">Sort By</option>
            <option value="marketCap">Market Cap</option>
            <option value="volume24h">Volume 24h</option>
            <option value="price">Price</option>
            <option value="liquidityScore">Liquidity Score</option>
            <option value="pumpDumpRiskScore">Pump/Dump Risk</option>
            <option value="walletDistributionScore">Wallet Dist Score</option>
          </select>
          <button
            onClick={showColumnModal}
            className="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Customize table columns"
          >
            Columns
          </button>
          <button
            onClick={onFilterClick}
            className="px-4 py-2 bg-yellow-500 text-black rounded-lg hover:bg-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Open filter drawer"
          >
            Filter
          </button>
          <button
            onClick={showSortModal}
            className="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 flex items-center focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
            aria-label="Open sort options"
          >
            <FaSort className="mr-2" /> Sort
          </button>
        </div>
      </div>
      <div className="overflow-x-auto rounded-lg shadow-lg">
        <div className="min-w-full">
          <div
            className={`grid gap-2 sticky top-0 bg-gray-800 z-10 p-3 text-white font-semibold border-b border-gray-600`}
            style={{
              gridTemplateColumns: columns.map(() => (isMobile ? '1fr' : 'minmax(80px, 1fr)')).join(' '),
            }}
            role="row"
            aria-label="Table headers"
          >
            {columns.map(col => (
              <div
                key={col}
                className="text-sm truncate"
                role="columnheader"
                aria-sort={sortConfig?.key === col ? (sortConfig.direction === 'asc' ? 'ascending' : 'descending') : 'none'}
              >
                {col === 'symbol'
                  ? 'Symbol'
                  : col === 'volumeMarketCapRatio'
                  ? 'Vol/Mkt Cap'
                  : col === 'isVolumeHealthy'
                  ? 'Health'
                  : col === 'pumpDumpRiskScore'
                  ? 'Risk'
                  : col === 'walletDistributionScore'
                  ? 'Wallet Score'
                  : col === 'watchlist'
                  ? 'Watchlist'
                  : col.charAt(0).toUpperCase() + col.slice(1).replace(/([A-Z])/g, ' $1')}
              </div>
            ))}
          </div>
          <div role="grid" aria-label="Token data table" className="bg-gray-900">
            <FixedSizeList
              height={400}
              itemCount={sortedTokens.length}
              itemSize={50}
              width="100%"
              initialScrollOffset={scrollPosition}
              onScroll={({ scrollOffset }) => setScrollPosition(scrollOffset)}
            >
              {Row}
            </FixedSizeList>
          </div>
        </div>
      </div>
      {isColumnModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl">
            <h2 className="text-lg font-bold text-white mb-4">Customize Columns</h2>
            {[
              'symbol',
              'price',
              'volume24h',
              'marketCap',
              'volumeMarketCapRatio',
              'isVolumeHealthy',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="flex items-center mb-3">
                <input
                  type="checkbox"
                  checked={visibleColumns.includes(key)}
                  onChange={() => toggleColumn(key)}
                  className="mr-2 h-4 w-4 text-yellow-500 bg-gray-700 border-gray-600 rounded focus:ring-yellow-500"
                  id={`column-${key}`}
                  aria-label={`Toggle ${key} column`}
                />
                <label htmlFor={`column-${key}`} className="text-white text-sm">
                  {key === 'symbol'
                    ? 'Symbol'
                    : key === 'volumeMarketCapRatio'
                    ? 'Vol/Mkt Cap'
                    : key === 'isVolumeHealthy'
                    ? 'Health'
                    : key === 'pumpDumpRiskScore'
                    ? 'Risk'
                    : key === 'walletDistributionScore'
                    ? 'Wallet Score'
                    : key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}
                </label>
              </div>
            ))}
            <button
              onClick={handleColumnClose}
              className="w-full mt-4 px-4 py-2 bg-yellow-500 text-black rounded-lg hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
              aria-label="Close column customization"
            >
              Done
            </button>
          </div>
        </div>
      )}
      {isSortModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl">
            <h2 className="text-lg font-bold text-white mb-4">Sort By</h2>
            {[
              'price',
              'marketCap',
              'volume24h',
              'volumeMarketCapRatio',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="mb-3">
                <button
                  onClick={() => requestSort(key as keyof Token)}
                  className="w-full text-left p-2 bg-gray-700 rounded hover:bg-gray-600 text-white flex justify-between focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"
                  aria-label={`Sort by ${key}`}
                >
                  <span>
                    {key === 'volumeMarketCapRatio'
                      ? 'Vol/Mkt Cap'
                      : key === 'isVolumeHealthy'
                      ? 'Health'
                      : key === 'pumpDumpRiskScore'
                      ? 'Risk'
                      : key === 'walletDistributionScore'
                      ? 'Wallet Score'
                      : key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}
                  </span>
                  <span>{sortConfig?.key === key ? (sortConfig.direction === 'asc' ? 'â†‘' : 'â†“') : ''}</span>
                </button>
              </div>
            ))}
            <button
              onClick={handleSortClose}
              className="w-full mt-4 px-4 py-2 bg-yellow-500 text-black rounded-lg hover:bg-yellow-400 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"
              aria-label="Close sort options"
            >
              Done
            </button>
          </div>
        </div>
      )}
      <FilterDrawer isOpen={isFilterDrawerOpen} onClose={onFilterClose} />
    </div>
  );
});

export default TokenTable;
=== .\components\WelcomeScreen.tsx ===
import React, { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import localforage from 'localforage';

const WelcomeScreen: React.FC<{ onFinish: () => void }> = ({ onFinish }) => {
  const [show, setShow] = useState(false);

  useEffect(() => {
    const checkLastVisit = async () => {
      const lastVisit = await localforage.getItem<number>('lastVisit');
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

      if (!lastVisit || now - lastVisit > oneDay) {
        setShow(true);
        await localforage.setItem('lastVisit', now);
      } else {
        onFinish();
      }
    };

    checkLastVisit();
  }, [onFinish]);

  if (!show) return null;

  return (
    <motion.div
      initial={{ opacity: 1 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 1 }}
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100vw',
        height: '100vh',
        background: '#001529',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        zIndex: 2000,
      }}
      onAnimationComplete={() => {
        setTimeout(() => {
          setShow(false);
          onFinish();
        }, 2000);
      }}
    >
      <motion.div
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: 'spring', stiffness: 260, damping: 20 }}
      >
        {/* Replace with your logo */}
        <div style={{ fontSize: 48, color: '#fff', fontWeight: 'bold' }}>
          Sunnalytics
        </div>
      </motion.div>
    </motion.div>
  );
};

export default WelcomeScreen;
=== .\hooks\useTokenData.ts ===
import { useEffect } from 'react';
import useSWR from 'swr';
import { useTokenStore } from '../stores/useTokenStore';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  createdAt: string;
  updatedAt: string;
  volatilityScore24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  socialSentimentScore?: number; // New field for potential backend update
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
}

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';
const API_KEY = process.env.NEXT_PUBLIC_API_KEY;

const fetcher = async (url: string) => {
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    const error = new Error(`Failed to fetch: ${res.status} ${res.statusText}`);
    error.message = await res.text().catch(() => 'Unknown server error');
    throw error;
  }
  const data = await res.json();
  return Array.isArray(data.data) ? data.data : Array.isArray(data) ? data : [data];
};

export function useTokenData(page: number = 1, limit: number = 50, category?: string) {
  const { setTokens, setFilteredTokens, setLoading, setError, fetchTokens } = useTokenStore();

  const queryParams = new URLSearchParams({
    page: page.toString(),
    limit: limit.toString(),
    ...(category && { category }),
  }).toString();

  const url = `${API_BASE_URL}/api/tokens?${queryParams}`;

  const { data, error, isLoading } = useSWR<Token[]>(url, fetcher, {
    revalidateOnFocus: false,
    revalidateOnReconnect: false,
    refreshInterval: 60000, // Refresh every minute
    dedupingInterval: 30000, // Dedupe requests within 30 seconds
    errorRetryCount: 3,
    errorRetryInterval: 5000,
  });

  useEffect(() => {
    setLoading(isLoading);
    if (error) {
      setError(error.message || 'An error occurred while fetching tokens');
    } else if (data) {
      setTokens(data);
      setFilteredTokens(data);
      setError(null);
    }
  }, [data, error, isLoading, setTokens, setFilteredTokens, setLoading, setError]);

  return { fetchTokens, isLoading, error, tokens: data };
}
=== .\pages\ai-picks.tsx ===
import React, { useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import { useRouter } from 'next/router';
import BottomNav from '../components/BottomNav';

// Define the Token type
type Token = {
  id: string;
  symbol: string;
  exchange?: string;
  updatedAt?: string;
  volumeMarketCapRatio?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  isVolumeHealthy?: boolean;
  stats?: {
    priceChange24h?: number;
    liquidityScore?: number;
  };
};

function formatDate(dateString?: string) {
  if (!dateString) return 'N/A';
  const date = new Date(dateString);
  return date.toLocaleString('en-GB', {
    day: '2-digit',
    month: 'long',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    hour12: true
  }).replace(',', '');
}

export default function AIPicks() {
  const { tokens, setFilteredTokens } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const router = useRouter();

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const getBoomingTokens = (tokens: Token[]) => {
    return tokens
      .filter(token => 
        token.exchange &&
        ['binance', 'bybit_spot'].includes(token.exchange.toLowerCase()) &&
        token.volumeMarketCapRatio !== undefined &&
        token.liquidityScore !== undefined &&
        token.pumpDumpRiskScore !== undefined &&
        token.walletDistributionScore !== undefined &&
        token.liquidityScore > 50 &&
        token.pumpDumpRiskScore < 30 &&
        token.walletDistributionScore > 70 &&
        token.isVolumeHealthy
      )
      .sort((a, b) => {
        const aScore = (a.volumeMarketCapRatio || 0) * (a.liquidityScore || 0);
        const bScore = (b.volumeMarketCapRatio || 0) * (b.liquidityScore || 0);
        return bScore - aScore;
      })
      .slice(0, 5);
  };

  const boomingTokens = getBoomingTokens(tokens);

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">AI Picks</h1>
      <p className="mb-4">Top 5 potential booming tokens from Binance and Bybit Spot based on volume/market cap ratio and liquidity score:</p>
      {boomingTokens.length > 0 ? (
        <ul className="space-y-2">
          {boomingTokens.map(token => (
            <li 
              key={token.id} 
              className="bg-gray-800 p-2 rounded shadow-sm hover:bg-gray-700 cursor-pointer" 
              onClick={() => router.push(`/tokens/${token.id}`)}
              role="button"
              aria-label={`View details for ${token.symbol}`}
            >
              <div className="flex justify-between items-center">
                <span className="font-medium">{token.symbol}</span>
                <span className="text-sm text-gray-300">Exchange: {token.exchange || 'N/A'}</span>
              </div>
              <div className="text-sm">
                Vol/Mkt Cap: {(token.volumeMarketCapRatio || 0 * 100).toFixed(2)}%, 
                Liquidity: {(token.liquidityScore || 0).toFixed(2)}, 
                Pump/Dump Risk: {token.pumpDumpRiskScore}, 
                Wallet Distribution: {token.walletDistributionScore}
              </div>
              <div className="text-xs text-gray-400 mt-1">Updated: {formatDate(token.updatedAt)}</div>
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-gray-400">No tokens available from Binance or Bybit Spot for analysis.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\charts.tsx ===
// pages/charts.tsx
import React, { useState, useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import { Line } from 'react-chartjs-2';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js';
import BottomNav from '../components/BottomNav';

ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend);

export default function Charts() {
  const { tokens } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const [selectedToken, setSelectedToken] = useState<string | null>(null);
  const [chartData, setChartData] = useState<any>(null);

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  useEffect(() => {
    if (selectedToken && tokens.length > 0) {
      const token = tokens.find(t => t.symbol === selectedToken);
      if (token) {
        // Mock historical data (replace with real API data if available)
        const labels = ['June 10', 'June 12', 'June 14', 'June 16', 'June 18'];
        const priceData = [token.price || 0, (token.price || 0) * 1.1, (token.price || 0) * 1.2, (token.price || 0) * 1.15, (token.price || 0) * 1.3];
        const volumeData = [(token.volume24h || 0), (token.volume24h || 0) * 0.9, (token.volume24h || 0) * 1.1, (token.volume24h || 0) * 1.05, (token.volume24h || 0) * 1.2];
        const marketCapData = [token.marketCap || 0, (token.marketCap || 0) * 1.15, (token.marketCap || 0) * 1.25, (token.marketCap || 0) * 1.2, (token.marketCap || 0) * 1.35];

        setChartData({
          labels,
          datasets: [
            {
              label: 'Price (USD)',
              data: priceData,
              borderColor: 'rgb(75, 192, 192)',
              backgroundColor: 'rgba(75, 192, 192, 0.5)',
              yAxisID: 'y1',
            },
            {
              label: 'Volume (24h)',
              data: volumeData,
              borderColor: 'rgb(255, 99, 132)',
              backgroundColor: 'rgba(255, 99, 132, 0.5)',
              yAxisID: 'y2',
            },
            {
              label: 'Market Cap',
              data: marketCapData,
              borderColor: 'rgb(54, 162, 235)',
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              yAxisID: 'y3',
            },
          ],
        });
      }
    }
  }, [selectedToken, tokens]);

  const options = {
    responsive: true,
    plugins: {
      legend: { position: 'top' as const },
      title: { display: true, text: 'Token Price, Volume, and Market Cap Trends' },
    },
    scales: {
      y1: { 
        type: 'linear' as const, 
        position: 'left' as const, 
        title: { display: true, text: 'Price (USD)' } 
      },
      y2: { 
        type: 'linear' as const, 
        position: 'right' as const, 
        title: { display: true, text: 'Volume (USD)' }, 
        grid: { drawOnChartArea: false } 
      },
      y3: { 
        type: 'linear' as const, 
        position: 'right' as const, 
        title: { display: true, text: 'Market Cap (USD)' }, 
        grid: { drawOnChartArea: false }, 
        min: 0 
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Charts</h1>
      <select
        onChange={e => setSelectedToken(e.target.value)}
        className="p-2 mb-4 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-yellow-500"
        value={selectedToken || ''}
      >
        <option value="">Select a Token</option>
        {tokens.map(token => (
          <option key={token.id} value={token.symbol}>{token.symbol}</option>
        ))}
      </select>
      {chartData && selectedToken ? (
        <div>
          <Line data={chartData} options={options} />
        </div>
      ) : (
        <p className="text-gray-400">Select a token to view charts.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\index.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import TokenTable from '../components/TokenTable';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import TabbedFilters from '../components/TabbedFilters';

export default function Home() {
  const { loading, error, fetchTokens, searchQuery, sortConfig, filters, activeTab, setFilteredTokens, tokens } =
    useTokenStore();
  const { fetchTokens: fetchData } = useTokenData();
  const [isFilterDrawerOpen, setIsFilterDrawerOpen] = useState(false);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  useEffect(() => {
    let filtered = [...tokens];

    // Apply search
    if (searchQuery) {
      filtered = filtered.filter(
        token =>
          token.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          token.symbol.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }

    // Apply tab filter
    if (activeTab !== 'all') {
      filtered = filtered.filter(token => token.category.toLowerCase() === activeTab);
    }

    // Apply filters
    if (filters.category) {
      filtered = filtered.filter(token => token.category === filters.category);
    }
    if (filters.minPrice) {
      const min = parseFloat(filters.minPrice);
      filtered = filtered.filter(token => token.price !== undefined && token.price >= min);
    }
    if (filters.maxPrice) {
      const max = parseFloat(filters.maxPrice);
      filtered = filtered.filter(token => token.price !== undefined && token.price <= max);
    }
    if (filters.minVolumeMarketCapRatio) {
      const min = parseFloat(filters.minVolumeMarketCapRatio) / 100;
      filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio >= min);
    }
    if (filters.maxVolumeMarketCapRatio) {
      const max = parseFloat(filters.maxVolumeMarketCapRatio) / 100;
      filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio <= max);
    }
    if (filters.minCirculatingSupplyPercentage) {
      const min = parseFloat(filters.minCirculatingSupplyPercentage);
      filtered = filtered.filter(
        token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage >= min
      );
    }
    if (filters.maxCirculatingSupplyPercentage) {
      const max = parseFloat(filters.maxCirculatingSupplyPercentage);
      filtered = filtered.filter(
        token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage <= max
      );
    }
    if (filters.isVolumeHealthy === 'true') {
      filtered = filtered.filter(token => token.isVolumeHealthy === true);
    } else if (filters.isVolumeHealthy === 'false') {
      filtered = filtered.filter(token => token.isVolumeHealthy === false);
    }
    if (filters.isCirculatingSupplyGood === 'true') {
      filtered = filtered.filter(token => token.isCirculatingSupplyGood === true);
    } else if (filters.isCirculatingSupplyGood === 'false') {
      filtered = filtered.filter(token => token.isCirculatingSupplyGood === false);
    }

    // Apply sorting
    if (sortConfig) {
      filtered = [...filtered].sort((a, b) => {
        const aValue = a[sortConfig.key];
        const bValue = b[sortConfig.key];
        if (aValue === undefined || bValue === undefined) return 0;
        if (sortConfig.direction === 'asc') {
          return aValue > bValue ? 1 : -1;
        }
        return aValue < bValue ? 1 : -1;
      });
    }

    setFilteredTokens(filtered);
  }, [searchQuery, activeTab, filters, sortConfig, tokens, setFilteredTokens]);

  const handleFilterClick = () => {
    setIsFilterDrawerOpen(true);
  };

  const handleFilterClose = () => {
    setIsFilterDrawerOpen(false);
  };

  return (
    <div className="min-h-screen flex flex-col pb-safe-area-inset-bottom bg-gray-900 text-white">
      <main className="flex-1 p-4">
        <div className="flex justify-between items-center mb-4">
          <h1 className="text-2xl font-bold">Market</h1>
          <div className="text-sm text-gray-400">Watchlist</div>
        </div>
        <TabbedFilters />
        {loading && <p className="text-center text-gray-400">Loading tokens...</p>}
        {error && (
          <p className="text-center text-red-500">
            Error: {error}{' '}
            <button onClick={fetchTokens} className="text-blue-500 underline">
              Retry
            </button>
          </p>
        )}
        {!loading && !error && (
          <TokenTable
            isFilterDrawerOpen={isFilterDrawerOpen}
            onFilterClick={handleFilterClick}
            onFilterClose={handleFilterClose}
          />
        )}
      </main>
      <BottomNav onFilterClick={handleFilterClick} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\settings.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import localforage from 'localforage';

export default function Settings() {
  const [isMounted, setIsMounted] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    setIsMounted(true);
    localforage.getItem('darkMode').then(value => {
      const darkMode = value as boolean;
      setIsDarkMode(darkMode || false);
      if (darkMode) {
        document.documentElement.classList.add('dark');
      }
    });
  }, []);

  const toggleDarkMode = () => {
    const newDarkMode = !isDarkMode;
    setIsDarkMode(newDarkMode);
    localforage.setItem('darkMode', newDarkMode);
    if (newDarkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };

  const handleReset = () => {
    localforage.clear();
    setIsDarkMode(false);
    document.documentElement.classList.remove('dark');
  };

  if (!isMounted) return null;

  return (
    <div className="min-h-screen flex flex-col pb-16">
      <main className="flex-1 p-4">
        <h1 className="text-2xl font-bold mb-4">Settings</h1>
        <div className="mb-4 flex items-center justify-between">
          <span className="text-lg">Dark Mode</span>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={isDarkMode}
              onChange={toggleDarkMode}
              className="sr-only"
            />
            <div
              className={`w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 ${
                isDarkMode ? 'bg-blue-600' : ''
              }`}
            >
              <div
                className={`absolute w-5 h-5 bg-white rounded-full transition-transform duration-200 ease-in-out ${
                  isDarkMode ? 'translate-x-5' : 'translate-x-0'
                }`}
              ></div>
            </div>
          </label>
        </div>
        <button
          onClick={handleReset}
          className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
        >
          Reset All Settings
        </button>
      </main>
      <BottomNav />
    </div>
  );
}
=== .\pages\watchlist.tsx ===
// pages/watchlist.tsx
import React, { useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useRouter } from 'next/router';
import BottomNav from '../components/BottomNav';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

export default function Watchlist() {
  const { watchlist, fetchTokens } = useTokenStore();
  const router = useRouter();

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const formatNumber = (value: number | undefined, suffix: string = ''): string => {
    if (value === undefined || value === 0) return '-';
    if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
    if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
    return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
  };

  const formatRatio = (value: number | undefined) => value !== undefined ? `${(value * 100).toFixed(2)}%` : '-';
  const formatBoolean = (value: boolean | undefined) => value !== undefined ? (value ? 'Yes' : 'No') : '-';
  const formatScore = (value: number | undefined) => value !== undefined ? value.toFixed(2) : '-';

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Watchlist</h1>
      {watchlist.length > 0 ? (
        <ul className="space-y-4">
          {watchlist.map((token: Token) => (
            <li
              key={token.id}
              className="bg-gray-800 p-4 rounded-lg shadow-sm hover:bg-gray-700 transition-colors cursor-pointer"
              onClick={() => router.push(`/tokens/${token.id}`)}
            >
              <div className="flex flex-col sm:flex-row sm:items-center justify-between">
                <div>
                  <h2 className="text-lg font-semibold">{token.symbol}</h2>
                  <p className="text-sm text-gray-400">{token.name} - {token.category}</p>
                </div>
                <div className="mt-2 sm:mt-0 space-y-1">
                  <p>Price: {formatNumber(token.price)}</p>
                  <p>Market Cap: {formatNumber(token.marketCap)}</p>
                  <p>Volume (24h): {formatNumber(token.volume24h)}</p>
                  <p>Vol/Mkt Cap: {formatRatio(token.volumeMarketCapRatio)}</p>
                  <p>Health: {formatBoolean(token.isVolumeHealthy)}</p>
                  <p>Liquidity Score: {formatScore(token.liquidityScore)}</p>
                </div>
              </div>
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-gray-400">No tokens in watchlist. Add tokens from the Market page.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\welcome.tsx ===
import { useEffect } from 'react';
import { useRouter } from 'next/router';
import localforage from 'localforage';

export default function Welcome() {
  const router = useRouter();

  useEffect(() => {
    localforage.getItem('welcomeScreenSeen').then(value => {
      if (value) {
        router.push('/');
      }
    });
  }, [router]);

  const handleContinue = () => {
    localforage.setItem('welcomeScreenSeen', true);
    router.push('/');
  };

  return (
    <div className="min-h-screen flex flex-col justify-center items-center bg-gray-100 p-4">
      <h1 className="text-3xl font-bold mb-4">Welcome to Sunnalytics</h1>
      <p className="text-lg text-gray-600 mb-6 text-center">
        Your go-to platform for token analytics and insights.
      </p>
      <button
        onClick={handleContinue}
        className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
      >
        Continue
      </button>
    </div>
  );
}
=== .\pages\_app.tsx ===
import '../styles/globals.css';
import type { AppProps } from 'next/app';
import { inter, robotoMono } from '../utils/fonts';
import Head from 'next/head';
import { useState, useEffect } from 'react';
import WelcomeScreen from '../components/WelcomeScreen';

export default function App({ Component, pageProps }: AppProps) {
  const [showWelcome, setShowWelcome] = useState(true);
  const INACTIVITY_THRESHOLD = 10 * 60 * 1000; // 10 minutes in milliseconds

  useEffect(() => {
    const lastActive = localStorage.getItem('lastActive');
    const now = new Date().getTime();

    if (lastActive) {
      const lastActiveTime = parseInt(lastActive, 10);
      const timeSinceLastActive = now - lastActiveTime;

      // Show welcome screen if inactive for more than INACTIVITY_THRESHOLD
      if (timeSinceLastActive > INACTIVITY_THRESHOLD) {
        setShowWelcome(true);
      } else {
        setShowWelcome(false);
      }
    } else {
      // First visit or no stored timestamp
      localStorage.setItem('lastActive', now.toString());
      setShowWelcome(true);
    }

    // Update last active timestamp when the app is interacted with
    const handleActivity = () => {
      localStorage.setItem('lastActive', now.toString());
    };

    window.addEventListener('mousemove', handleActivity);
    window.addEventListener('keydown', handleActivity);
    window.addEventListener('scroll', handleActivity);

    return () => {
      window.removeEventListener('mousemove', handleActivity);
      window.removeEventListener('keydown', handleActivity);
      window.removeEventListener('scroll', handleActivity);
    };
  }, []);

  const handleWelcomeFinish = () => {
    setShowWelcome(false);
  };

  return (
    <div className={`${inter.variable} ${robotoMono.variable}`}>
      <Head>
        <title>Sunnalytics</title>
        <meta name="description" content="Sunnalytics - Token Analytics Platform" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#111827" />
        <link rel="icon" href="/favicon.ico" sizes="any" />
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
        <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />
        <link rel="manifest" href="/site.webmanifest" />
      </Head>
      {showWelcome && <WelcomeScreen onFinish={handleWelcomeFinish} />}
      <Component {...pageProps} />
    </div>
  );
}
=== .\pages\tokens\[id].tsx ===
import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend, ChartOptions } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../../utils/api';
import BottomNav from '../../components/BottomNav';
import { formatNumber } from '../../components/TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);
  const [apiError, setApiError] = useState<string | null>(null);

  // Replace with your backend URL, e.g., 'https://your-backend.com'
  const BACKEND_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';

  useEffect(() => {
    if (id) {
      const url = `${BACKEND_URL}/api/tokens/${id}/history`;
      console.log(`Fetching history from: ${url}`);
      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          console.log('Token history data:', data);
          setHistory(data);
          setApiError(null);
        })
        .catch(err => {
          console.error('Error fetching history:', err.message);
          setApiError(err.message);
        });
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  // Group by date, minimal filtering
  const validHistory = history
    .filter(h => h.price != null && h.volume24h != null && h.marketCap != null && h.marketCap !== 0)
    .reduce((acc: TokenHistory[], h) => {
      const date = new Date(h.timestamp).toISOString().split('T')[0];
      const existing = acc.find(item => new Date(item.timestamp).toISOString().split('T')[0] === date);
      if (!existing) acc.push(h);
      return acc;
    }, [])
    .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());

  console.log('Valid history:', validHistory);

  const chartData = {
    labels: validHistory.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Volume/Market Cap Ratio (%)',
        data: validHistory.map(h => (h.volume24h! / h.marketCap!) * 100),
        borderColor: '#FBBF24',
        yAxisID: 'y-ratio',
      },
      {
        label: 'Price (USD)',
        data: validHistory.map(h => h.price!),
        borderColor: '#3B82F6',
        yAxisID: 'y-price',
      },
    ],
  };

  const chartOptions: ChartOptions<'line'> = {
    responsive: true,
    scales: {
      x: {
        type: 'time',
        time: { unit: 'day' },
        title: { display: true, text: 'Date' },
      },
      'y-ratio': {
        type: 'linear',
        position: 'left',
        title: { display: true, text: 'Ratio (%)' },
        beginAtZero: true,
      },
      'y-price': {
        type: 'linear',
        position: 'right',
        title: { display: true, text: 'Price ($)' },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: { display: true },
      tooltip: { mode: 'index', intersect: false },
    },
  };

  console.log('Chart data:', chartData);

  return (
    <div className="min-h-screen flex flex-col bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button onClick={() => router.back()} className="mr-4 text-yellow-400">
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg h-80">
            <h2 className="text-lg font-semibold mb-2">Historical Data</h2>
            <div className="h-64">
              {apiError ? (
                <div className="text-center text-red-500 h-full flex items-center justify-center">
                  Error: {apiError}
                </div>
              ) : validHistory.length > 0 ? (
                <Line data={chartData} options={chartOptions} />
              ) : (
                <div className="text-center text-gray-400 h-full flex items-center justify-center">
                  No history data
                </div>
              )}
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\stores\useTokenStore.ts ===
import { create } from 'zustand';
import localforage from 'localforage';
import { persist, createJSONStorage } from 'zustand/middleware';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  updatedAt?: string;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

interface FilterState {
  category: string;
  minPrice: string;
  maxPrice: string;
  minVolumeMarketCapRatio: string;
  maxVolumeMarketCapRatio: string;
  minCirculatingSupplyPercentage: string;
  maxCirculatingSupplyPercentage: string;
  isVolumeHealthy: string;
  isCirculatingSupplyGood: string;
}

interface TokenState {
  tokens: Token[];
  filteredTokens: Token[];
  watchlist: Token[];
  loading: boolean;
  error: string | null;
  searchQuery: string;
  sortConfig: { key: keyof Token; direction: 'asc' | 'desc' } | null;
  filters: FilterState;
  activeTab: string;
  visibleColumns: string[];
  scrollPosition: number;
  setTokens: (tokens: Token[]) => void;
  setFilteredTokens: (tokens: Token[]) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  setSearchQuery: (query: string) => void;
  setSortConfig: (config: { key: keyof Token; direction: 'asc' | 'desc' } | null) => void;
  setFilters: (filters: Partial<FilterState>) => void;
  setActiveTab: (tab: string) => void;
  setVisibleColumns: (columns: string[]) => void;
  setScrollPosition: (position: number) => void;
  fetchTokens: () => void;
  addToWatchlist: (token: Token) => void;
}

export const useTokenStore = create<TokenState>()(
  persist(
    (set, get) => ({
      tokens: [],
      filteredTokens: [],
      watchlist: [],
      loading: false,
      error: null,
      searchQuery: '',
      sortConfig: null,
      filters: {
        category: '',
        minPrice: '',
        maxPrice: '',
        minVolumeMarketCapRatio: '',
        maxVolumeMarketCapRatio: '',
        minCirculatingSupplyPercentage: '',
        maxCirculatingSupplyPercentage: '',
        isVolumeHealthy: '',
        isCirculatingSupplyGood: '',
      },
      activeTab: 'all',
      visibleColumns: [],
      scrollPosition: 0,
      setTokens: (tokens: Token[]) => set({ tokens }),
      setFilteredTokens: (tokens: Token[]) => set({ filteredTokens: tokens }),
      setLoading: (loading: boolean) => set({ loading }),
      setError: (error: string | null) => set({ error }),
      setSearchQuery: (query: string) => set({ searchQuery: query }),
      setSortConfig: (config: { key: keyof Token; direction: 'asc' | 'desc' } | null) => set({ sortConfig: config }),
      setFilters: (filters: Partial<FilterState>) =>
        set(state => ({ filters: { ...state.filters, ...filters } })),
      setActiveTab: (tab: string) => set({ activeTab: tab }),
      setVisibleColumns: (columns: string[]) => set({ visibleColumns: columns }),
      setScrollPosition: (position: number) => set({ scrollPosition: position }),
      fetchTokens: async () => {
        set({ loading: true, error: null });
        try {
          const response = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/tokens`, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          const tokens: Token[] = data.map((item: any) => ({
            id: item.id || item._id,
            name: item.name,
            symbol: item.symbol,
            category: item.category || 'Unknown',
            price: item.price,
            marketCap: item.marketCap,
            volume24h: item.volume24h,
            volumeMarketCapRatio: item.volumeMarketCapRatio,
            isVolumeHealthy: item.isVolumeHealthy,
            pumpDumpRiskScore: item.pumpDumpRiskScore,
            liquidityScore: item.liquidityScore,
            walletDistributionScore: item.walletDistributionScore,
            transferVolume24h: item.transferVolume24h,
            updatedAt: item.updatedAt,
          }));

          set({ tokens, filteredTokens: tokens, loading: false });
        } catch (err) {
          set({ error: err instanceof Error ? err.message : 'Failed to fetch tokens', loading: false });
        }
      },
      addToWatchlist: (token: Token) =>
        set((state) => ({
          watchlist: state.watchlist.some((w: Token) => w.id === token.id)
            ? state.watchlist
            : [...state.watchlist, token],
        })),
    }),
    {
      name: 'token-store',
      storage: createJSONStorage(() => localforage),
    }
  )
);
=== .\styles\globals.css ===
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --max-width: 1200px;
  --border-radius: 8px;
  --font-mono: var(--font-roboto-mono), ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono',
    'Roboto Mono', 'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro',
    'Fira Mono', 'Droid Sans Mono', 'Courier New', monospace;
  --primary-color: #FBBF24;
  --background-dark: #0F172A;
  --card-bg: #1E293B;
  --text-primary: #F3F4F6;
  --text-secondary: #9CA3AF;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
  font-family: var(--font-inter), system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
    'Helvetica Neue', Arial, sans-serif;
  background-color: var(--background-dark);
  color: var(--text-primary);
}

a {
  color: var(--primary-color);
  text-decoration: none;
  transition: color 0.2s ease-in-out;
}

a:hover {
  color: #F59E0B;
}

button, input, select {
  transition: all 0.2s ease-in-out;
}

button:focus, input:focus, select:focus {
  outline: none;
  ring: 2px solid var(--primary-color);
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}

.bg-gray-700 {
  background-color: var(--card-bg);
}

.bg-gray-800 {
  background-color: #1E293B;
}

.bg-gray-900 {
  background-color: var(--background-dark);
}

.text-gray-400 {
  color: var(--text-secondary);
}

.rounded-lg {
  border-radius: var(--border-radius);
}

.shadow-lg {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.transition-all {
  transition: all 0.2s ease-in-out;
}
=== .\utils\api.ts ===
import useSWR from 'swr';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';
const API_KEY = process.env.NEXT_PUBLIC_API_KEY;

const fetcher = async (url: string) => {
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    const error = new Error(`An error occurred while fetching the data: ${res.status} ${res.statusText}`);
    error.message = await res.text().catch(() => 'Unknown server error');
    throw error;
  }
  const data = await res.json();
  return Array.isArray(data.data) ? data.data : Array.isArray(data) ? data : data;
};

export function useTokens(category?: string, page: number = 1, limit: number = 50) {
  const queryParams = new URLSearchParams({
    page: page.toString(),
    limit: limit.toString(),
    ...(category && { category }),
  }).toString();

  const url = `${API_BASE_URL}/api/tokens?${queryParams}`;

  const { data, error, isLoading } = useSWR(url, fetcher, {
    refreshInterval: 60000,
    revalidateOnFocus: false,
    dedupingInterval: 30000,
    errorRetryCount: 3,
    errorRetryInterval: 5000,
  });

  return { tokens: data, error: error?.message, isLoading };
}

export async function refreshTokens() {
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(`${API_BASE_URL}/api/tokens/refresh`, { 
    method: 'POST',
    headers,
  });
  if (!res.ok) {
    const error = new Error(`Failed to refresh tokens: ${res.status} ${res.statusText}`);
    error.message = await res.text().catch(() => 'Unknown server error');
    throw error;
  }
  return res.json();
}

export async function fetchTokenHistory(tokenId: string, timeframe: string = '7d') {
  const url = `${API_BASE_URL}/api/tokens/${tokenId}/history?timeframe=${timeframe}`;
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    const error = new Error(`Failed to fetch token history: ${res.status} ${res.statusText}`);
    error.message = await res.text().catch(() => 'Unknown server error');
    throw error;
  }
  return res.json();
}
=== .\utils\fonts.ts ===
import { Inter, Roboto_Mono } from 'next/font/google';

export const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter',
});

export const robotoMono = Roboto_Mono({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-roboto-mono',
});
=== .\utils\tokenStats.ts ===
export interface TokenStats {
  priceChange24h: number;
  volatilityScore24h: number;
  liquidityScore: number;
  transferVolume24h: number;
}

export function calculateTokenStats(data: {
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  circulatingSupply: number | null;
  totalSupply: number | null;
  priceChange24h?: number | null;
  transferAmount?: number;
}): TokenStats {
  const { price, marketCap, volume24h, circulatingSupply, priceChange24h, transferAmount } = data;

  const change24h = priceChange24h ?? 0;
  const volatility = volume24h && marketCap ? (volume24h / marketCap) : 0;
  const liquidityScore = volume24h && circulatingSupply ? volume24h / circulatingSupply : 0;
  const transferVol24h = transferAmount ?? 0;

  return {
    priceChange24h: Number(change24h.toFixed(2)),
    volatilityScore24h: Number(volatility.toFixed(2)),
    liquidityScore: Number(liquidityScore.toFixed(2)),
    transferVolume24h: Number(transferVol24h.toFixed(2)),
  };
}

=== .\tailwind.config.js ===
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
=== .\tree.txt ===
Project Tree (excluding node_modules, .next, package-lock.json):

â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ combine_files.py
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”œâ”€â”€ FilterDrawer.tsx
â”‚   â”œâ”€â”€ TabbedFilters.tsx
â”‚   â”œâ”€â”€ TokenDetails.tsx
â”‚   â”œâ”€â”€ TokenTable.tsx
â”‚   â””â”€â”€ WelcomeScreen.tsx
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ generate_tree.py
â”œâ”€â”€ hooks
â”‚   â””â”€â”€ useTokenData.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ _app.tsx
â”‚   â”œâ”€â”€ ai-picks.tsx
â”‚   â”œâ”€â”€ api
â”‚   â”œâ”€â”€ charts.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â”œâ”€â”€ settings.tsx
â”‚   â”œâ”€â”€ tokens
â”‚   â”‚   â””â”€â”€ [id].tsx
â”‚   â”œâ”€â”€ watchlist.tsx
â”‚   â””â”€â”€ welcome.tsx
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ src
â”œâ”€â”€ stores
â”‚   â””â”€â”€ useTokenStore.ts
â”œâ”€â”€ styles
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ sunnalytics-dev.txt
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tree.txt
â”œâ”€â”€ tsconfig.json
â””â”€â”€ utils
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ fonts.ts
    â””â”€â”€ tokenStats.ts
=== .\tsconfig.json ===
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", "postcss.config.js"],
  "exclude": ["node_modules"]
}

=== .\components\BottomNav.tsx ===
// components/BottomNav.tsx
import React from 'react';
import { useRouter } from 'next/router';
import { FaChartLine, FaFilter, FaSearch, FaHome, FaStar, FaRobot } from 'react-icons/fa';

interface BottomNavProps {
  onFilterClick?: () => void;
  onSearchFocus?: () => void;
}

const BottomNav: React.FC<BottomNavProps> = ({ onFilterClick, onSearchFocus }) => {
  const router = useRouter();

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-gray-800 h-20 p-2 flex justify-around items-center border-t border-gray-700 shadow-lg pb-safe-area-inset-bottom">
      <button
        onClick={() => router.push('/')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaHome className="text-lg mb-1" />
        <span>Market</span>
      </button>
      <button
        onClick={() => router.push('/watchlist')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/watchlist' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaStar className="text-lg mb-1" />
        <span>Watchlist</span>
      </button>
      <button
        onClick={onSearchFocus}
        className="flex flex-col items-center text-xs text-gray-400 hover:text-yellow-400 transition-all duration-200 hover:scale-110"
      >
        <FaSearch className="text-lg mb-1" />
        <span>Search</span>
      </button>
      <button
        onClick={() => router.push('/ai-picks')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/ai-picks' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaRobot className="text-lg mb-1" />
        <span>AI Picks</span>
      </button>
      <button
        onClick={() => router.push('/charts')}
        className={`flex flex-col items-center text-xs ${
          router.pathname === '/charts' ? 'text-yellow-400' : 'text-gray-400'
        } hover:text-yellow-400 transition-all duration-200 hover:scale-110`}
      >
        <FaChartLine className="text-lg mb-1" />
        <span>Charts</span>
      </button>
    </nav>
  );
};

export default BottomNav;
=== .\components\FilterDrawer.tsx ===
import React, { useState, useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';

interface FilterDrawerProps {
  isOpen: boolean;
  onClose: () => void;
}

const FilterDrawer: React.FC<FilterDrawerProps> = ({ isOpen, onClose }) => {
  const { filteredTokens, setFilteredTokens, tokens } = useTokenStore();
  const [filters, setFilters] = useState({
    category: '',
    exchange: '',
    minPrice: '',
    maxPrice: '',
    minVolumeMarketCapRatio: '',
    maxVolumeMarketCapRatio: '',
    minCirculatingSupplyPercentage: '',
    maxCirculatingSupplyPercentage: '',
    isVolumeHealthy: '',
    isCirculatingSupplyGood: '',
  });

  useEffect(() => {
    const applyFilters = () => {
      let filtered = [...tokens];
      if (filters.category) {
        filtered = filtered.filter(token => token.category === filters.category);
      }
      if (filters.exchange) {
        filtered = filtered.filter(token => token.exchange.toLowerCase() === filters.exchange.toLowerCase());
      }
      if (filters.minPrice) {
        const min = parseFloat(filters.minPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price >= min);
      }
      if (filters.maxPrice) {
        const max = parseFloat(filters.maxPrice);
        filtered = filtered.filter(token => token.price !== undefined && token.price <= max);
      }
      if (filters.minVolumeMarketCapRatio) {
        const min = parseFloat(filters.minVolumeMarketCapRatio);
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio >= min);
      }
      if (filters.maxVolumeMarketCapRatio) {
        const max = parseFloat(filters.maxVolumeMarketCapRatio);
        filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio <= max);
      }
      if (filters.minCirculatingSupplyPercentage) {
        const min = parseFloat(filters.minCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage >= min);
      }
      if (filters.maxCirculatingSupplyPercentage) {
        const max = parseFloat(filters.maxCirculatingSupplyPercentage);
        filtered = filtered.filter(token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage <= max);
      }
      if (filters.isVolumeHealthy === 'true') {
        filtered = filtered.filter(token => token.isVolumeHealthy === true);
      } else if (filters.isVolumeHealthy === 'false') {
        filtered = filtered.filter(token => token.isVolumeHealthy === false);
      }
      if (filters.isCirculatingSupplyGood === 'true') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === true);
      } else if (filters.isCirculatingSupplyGood === 'false') {
        filtered = filtered.filter(token => token.isCirculatingSupplyGood === false);
      }
      setFilteredTokens(filtered);
    };

    applyFilters();
  }, [filters, tokens, setFilteredTokens]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFilters(prev => ({ ...prev, [name]: value }));
  };

  const handleReset = () => {
    setFilters({
      category: '',
      exchange: '',
      minPrice: '',
      maxPrice: '',
      minVolumeMarketCapRatio: '',
      maxVolumeMarketCapRatio: '',
      minCirculatingSupplyPercentage: '',
      maxCirculatingSupplyPercentage: '',
      isVolumeHealthy: '',
      isCirculatingSupplyGood: '',
    });
    setFilteredTokens(tokens);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
      <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
        <h2 className="text-lg font-bold text-white mb-4">Filter Tokens</h2>
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-300">Category</label>
            <select
              name="category"
              value={filters.category}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="altcoin">Altcoin</option>
              <option value="defi">DeFi</option>
              <option value="memecoin">Memecoin</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Exchange</label>
            <select
              name="exchange"
              value={filters.exchange}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="binance">Binance</option>
              <option value="bybit_spot">Bybit Spot</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Price ($)</label>
            <input
              type="number"
              name="minPrice"
              value={filters.minPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Price ($)</label>
            <input
              type="number"
              name="maxPrice"
              value={filters.maxPrice}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Volume/Market Cap Ratio</label>
            <input
              type="number"
              name="minVolumeMarketCapRatio"
              value={filters.minVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Volume/Market Cap Ratio</label>
            <input
              type="number"
              name="maxVolumeMarketCapRatio"
              value={filters.maxVolumeMarketCapRatio}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Min Circulating Supply (%)</label>
            <input
              type="number"
              name="minCirculatingSupplyPercentage"
              value={filters.minCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Max Circulating Supply (%)</label>
            <input
              type="number"
              name="maxCirculatingSupplyPercentage"
              value={filters.maxCirculatingSupplyPercentage}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              placeholder="100.00"
              min="0"
              step="0.01"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Volume Healthy</label>
            <select
              name="isVolumeHealthy"
              value={filters.isVolumeHealthy}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-300">Is Circulating Supply Good</label>
            <select
              name="isCirculatingSupplyGood"
              value={filters.isCirculatingSupplyGood}
              onChange={handleChange}
              className="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>
        <div className="mt-6 flex justify-end space-x-4">
          <button
            onClick={handleReset}
            className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-500 transition-colors"
          >
            Reset
          </button>
          <button
            onClick={onClose}
            className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors"
          >
            Apply
          </button>
        </div>
      </div>
    </div>
  );
};

export default FilterDrawer;
=== .\components\TabbedFilters.tsx ===
// components/TabbedFilters.tsx
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useTokenStore } from '../stores/useTokenStore';

const tabs = [
  { id: 'all', label: 'All' },
  { id: 'highlights', label: 'Highlights', badge: 'ðŸ”¥' },
  { id: 'trending', label: 'Trending', badge: 'ðŸ“ˆ' },
  { id: 'pumpfun', label: 'Pump.fun' },
  { id: 'ecosystems', label: 'Ecosystems' },
];

const TabbedFilters: React.FC = () => {
  const { setFilteredTokens, tokens } = useTokenStore();
  const [activeTab, setActiveTab] = useState('all');

  const handleTabClick = (tabId: string) => {
    setActiveTab(tabId);
    if (tabId === 'all') {
      setFilteredTokens(tokens);
    } else {
      setFilteredTokens(tokens.filter(token => token.category.toLowerCase() === tabId));
    }
  };

  return (
    <div className="mb-4">
      <div
        className="flex space-x-2 overflow-x-auto pb-2"
        role="tablist"
        aria-label="Token Categories"
      >
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => handleTabClick(tab.id)}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              activeTab === tab.id
                ? 'bg-yellow-500 text-black'
                : 'bg-gray-700 text-white hover:bg-gray-600'
            }`}
            role="tab"
            aria-selected={activeTab === tab.id}
            aria-controls={`panel-${tab.id}`}
          >
            {tab.label}
            {tab.badge && <span className="ml-1">{tab.badge}</span>}
          </button>
        ))}
      </div>
      <AnimatePresence>
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -10 }}
          transition={{ duration: 0.3 }}
          id={`panel-${activeTab}`}
          role="tabpanel"
          aria-labelledby={activeTab}
        >
          {/* Content managed by TokenTable */}
        </motion.div>
      </AnimatePresence>
    </div>
  );
};

export default TabbedFilters;
=== .\components\TokenDetails.tsx ===
import React, { useState } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../utils/api';
import BottomNav from './BottomNav';
import { formatNumber } from './TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);

  React.useEffect(() => {
    if (id) {
      fetch(`/api/tokens/${id}/history`)
        .then(res => res.json())
        .then(data => setHistory(data))
        .catch(err => console.error('Error fetching history:', err));
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  const chartData = {
    labels: history.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Price (USD)',
        data: history.map(h => h.price || 0),
        borderColor: '#FBBF24',
        backgroundColor: 'rgba(251, 191, 36, 0.2)',
        fill: true,
        tension: 0.4,
      },
    ],
  };

  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        type: 'time' as const,
        time: {
          unit: 'day' as const, // Explicitly set to 'day'
          tooltipFormat: 'MMM d, yyyy HH:mm',
        },
        title: {
          display: true,
          text: 'Date',
          color: '#fff',
        },
      },
      y: {
        title: {
          display: true,
          text: 'Price (USD)',
          color: '#fff',
        },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: {
        labels: {
          color: '#fff',
        },
      },
      tooltip: {
        callbacks: {
          label: (context: any) => `Price: $${context.parsed.y.toFixed(2)}`,
          title: (tooltipItems: any[]) => {
            return new Date(tooltipItems[0].parsed.x).toLocaleString();
          },
        },
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col pb-16 bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button
          onClick={() => router.back()}
          className="mr-4 text-yellow-400 hover:text-yellow-300"
          aria-label="Go back"
        >
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4 space-y-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg shadow">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg shadow h-80">
            <h2 className="text-lg font-semibold mb-2">Price History</h2>
            <div className="h-64">
              <Line data={chartData} options={chartOptions} />
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\components\TokenTable.tsx ===
import React, { useState, useMemo, memo, useCallback } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import FilterDrawer from './FilterDrawer';
import { FaSort } from 'react-icons/fa';
import { FixedSizeList } from 'react-window';
import debounce from 'lodash.debounce';

interface Token {
  name: string;
  symbol: string;
  category: string;
  exchange: string; // Made exchange optional to match actual data
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
}

// Define sortable keys explicitly
type SortKey =
  | 'symbol'
  | 'exchange'
  | 'price'
  | 'volume24h'
  | 'marketCap'
  | 'volumeMarketCapRatio'
  | 'isVolumeHealthy'
  | 'pumpDumpRiskScore'
  | 'liquidityScore'
  | 'walletDistributionScore';

interface TokenTableProps {
  isFilterDrawerOpen: boolean;
  onFilterClick: () => void;
  onFilterClose: () => void;
}

const TokenTable: React.FC<TokenTableProps> = memo(({ isFilterDrawerOpen, onFilterClick, onFilterClose }) => {
  const { filteredTokens, setFilteredTokens, tokens } = useTokenStore();
  const [searchQuery, setSearchQuery] = useState('');
  const [visibleColumns, setVisibleColumns] = useState<string[]>([
    'symbol',
    'exchange',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ]);
  const [isColumnModalVisible, setIsColumnModalVisible] = useState(false);
  const [isSortModalVisible, setIsSortModalVisible] = useState(false);
  const [sortConfig, setSortConfig] = useState<{ key: SortKey; direction: 'asc' | 'desc' } | null>(null);

  const toggleColumn = (key: string) => {
    setVisibleColumns(prev =>
      prev.includes(key) ? prev.filter(col => col !== key) : [...prev, key]
    );
  };

  const debouncedSearch = useCallback(
    debounce((query: string) => {
      setFilteredTokens(
        tokens.filter(
          token =>
            token.name.toLowerCase().includes(query.toLowerCase()) ||
            token.symbol.toLowerCase().includes(query.toLowerCase())
        )
      );
    }, 300),
    [tokens, setFilteredTokens]
  );

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const query = e.target.value;
    setSearchQuery(query);
    debouncedSearch(query);
  };

  const showColumnModal = () => {
    setIsColumnModalVisible(true);
  };

  const handleColumnClose = () => {
    setIsColumnModalVisible(false);
  };

  const showSortModal = () => {
    setIsSortModalVisible(true);
  };

  const handleSortClose = () => {
    setIsSortModalVisible(false);
  };

  const requestSort = (key: SortKey) => {
    setSortConfig(prev => {
      if (!prev || prev.key !== key) {
        return { key, direction: 'asc' };
      }
      return prev.direction === 'asc' ? { key, direction: 'desc' } : null;
    });
    handleSortClose();
  };

  const sortedTokens = useMemo(() => {
    if (!sortConfig) return filteredTokens;

    const compareValues = (a: Token, b: Token, key: SortKey) => {
      const aValue = a[key];
      const bValue = b[key];

      // Handle undefined or null values
      if (aValue == null && bValue == null) return 0;
      if (aValue == null) return sortConfig.direction === 'asc' ? 1 : -1;
      if (bValue == null) return sortConfig.direction === 'asc' ? -1 : 1;

      // Handle boolean values
      if (key === 'isVolumeHealthy') {
        const aBool = aValue as boolean;
        const bBool = bValue as boolean;
        return sortConfig.direction === 'asc'
          ? Number(aBool) - Number(bBool)
          : Number(bBool) - Number(aBool);
      }

      // Handle string values (symbol, exchange)
      if (key === 'symbol' || key === 'exchange') {
        const aStr = (aValue as string) || '';
        const bStr = (bValue as string) || '';
        return sortConfig.direction === 'asc'
          ? aStr.localeCompare(bStr)
          : bStr.localeCompare(aStr);
      }

      // Handle numeric values
      const aNum = aValue as number;
      const bNum = bValue as number;
      return sortConfig.direction === 'asc' ? aNum - bNum : bNum - aNum;
    };

    return [...filteredTokens].sort((a, b) => compareValues(a, b, sortConfig.key));
  }, [filteredTokens, sortConfig]);

  const columns = [
    'symbol',
    'exchange',
    'price',
    'volume24h',
    'marketCap',
    'volumeMarketCapRatio',
    'isVolumeHealthy',
    'pumpDumpRiskScore',
    'liquidityScore',
    'walletDistributionScore',
  ].filter(col => visibleColumns.includes(col));

  const formatNumber = (value: number | undefined, suffix: string = '') => {
    if (value === undefined || value === 0) return '-';
    if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
    if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
    return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
  };

  const formatRatio = (value: number | undefined) => value !== undefined ? value.toFixed(4) : '-';
  const formatBoolean = (value: boolean | undefined) => value !== undefined ? (value ? 'Yes' : 'No') : '-';
  const formatScore = (value: number | undefined) => value !== undefined ? value.toFixed(2) : '-';

  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => {
    const token = sortedTokens[index];
    return (
      <div
        style={style}
        className="bg-gray-800 p-2 flex items-center space-x-4 text-white rounded shadow-sm hover:bg-gray-700 transition-colors"
        role="row"
        aria-label={`Token ${token.symbol}`}
      >
        {columns.map(col => (
          <div key={col} className="flex-1 text-sm truncate" role="cell">
            {col === 'symbol' ? (
              <span>{token.symbol}</span>
            ) : col === 'exchange' ? (
              <span>{token.exchange || 'N/A'}</span>
            ) : col === 'price' ? (
              <button className="bg-green-500 text-black px-2 py-1 rounded hover:bg-green-400 transition-colors">
                Buy ${formatNumber(token.price)}
              </button>
            ) : col === 'volume24h' ? (
              formatNumber(token.volume24h)
            ) : col === 'marketCap' ? (
              formatNumber(token.marketCap)
            ) : col === 'volumeMarketCapRatio' ? (
              formatRatio(token.volumeMarketCapRatio)
            ) : col === 'isVolumeHealthy' ? (
              formatBoolean(token.isVolumeHealthy)
            ) : col === 'pumpDumpRiskScore' ? (
              formatScore(token.pumpDumpRiskScore)
            ) : col === 'liquidityScore' ? (
              formatScore(token.liquidityScore)
            ) : col === 'walletDistributionScore' ? (
              formatScore(token.walletDistributionScore)
            ) : (
              '-'
            )}
          </div>
        ))}
      </div>
    );
  };

  return (
    <div className="p-4">
      <div className="mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <input
          type="text"
          placeholder="Search tokens..."
          value={searchQuery}
          onChange={handleSearchChange}
          className="w-full sm:max-w-xs p-2 border border-gray-600 rounded bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
          aria-label="Search tokens"
        />
        <div className="mt-2 sm:mt-0 sm:ml-4 flex space-x-2">
          <select
            onChange={e => requestSort(e.target.value as SortKey)}
            className="p-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            aria-label="Sort tokens by"
          >
            <option value="">Sort By</option>
            <option value="marketCap">Market Cap</option>
            <option value="volume24h">Volume 24h</option>
            <option value="price">Price</option>
            <option value="liquidityScore">Liquidity Score</option>
            <option value="pumpDumpRiskScore">Pump/Dump Risk</option>
            <option value="walletDistributionScore">Wallet Dist Score</option>
            <option value="exchange">Exchange</option>
          </select>
          <button
            onClick={showColumnModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
            aria-label="Customize table columns"
          >
            Add/Remove Columns
          </button>
          <button
            onClick={onFilterClick}
            className="px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400 transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-500"
            aria-label="Open filter drawer"
          >
            Filter
          </button>
          <button
            onClick={showSortModal}
            className="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 transition-colors flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500"
            aria-label="Open sort options"
          >
            <FaSort className="mr-1" /> Sort
          </button>
        </div>
      </div>
      <div className="overflow-x-auto">
        <div className="min-w-full">
          <div
            className="grid grid-cols-[minmax(80px,1fr)_minmax(100px,1fr)_minmax(100px,1fr)_minmax(100px,1fr)_minmax(100px,1fr)_minmax(120px,1fr)_minmax(100px,1fr)_minmax(120px,1fr)_minmax(120px,1fr)_minmax(120px,1fr)] gap-2 sticky top-0 bg-gray-900 z-10 p-2 text-white font-bold"
            role="row"
            aria-label="Table headers"
          >
            {columns.map(col => (
              <div
                key={col}
                className="text-sm truncate"
                role="columnheader"
                aria-sort={sortConfig?.key === col ? (sortConfig.direction === 'asc' ? 'ascending' : 'descending') : 'none'}
              >
                {col === 'symbol' ? 'Symbol' : 
                 col === 'exchange' ? 'Exchange' :
                 col === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap Ratio' : 
                 col === 'isVolumeHealthy' ? 'Health' : 
                 col === 'pumpDumpRiskScore' ? 'Pump/Dump Risk' : 
                 col === 'walletDistributionScore' ? 'Wallet Dist Score' : 
                 col.charAt(0).toUpperCase() + col.slice(1).replace(/([A-Z])/g, ' $1')}
              </div>
            ))}
          </div>
          <div role="grid" aria-label="Token data table">
            <FixedSizeList
              height={400}
              itemCount={sortedTokens.length}
              itemSize={50}
              width="100%"
            >
              {Row}
            </FixedSizeList>
          </div>
        </div>
      </div>
      {isColumnModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
            <h2 className="text-lg font-bold text-white mb-4">Customize Table Columns</h2>
            {[
              'symbol',
              'exchange',
              'price',
              'volume24h',
              'marketCap',
              'volumeMarketCapRatio',
              'isVolumeHealthy',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
            ].map(key => (
              <div key={key} className="flex items-center mb-2">
                <input
                  type="checkbox"
                  checked={visibleColumns.includes(key)}
                  onChange={() => toggleColumn(key)}
                  className="mr-2 h-4 w-4 text-green-500 bg-gray-700 border-gray-600 rounded focus:ring-green-500"
                  id={`column-${key}`}
                  aria-label={`Toggle ${key} column`}
                />
                <label htmlFor={`column-${key}`} className="text-white">
                  {key === 'symbol' ? 'Symbol' : 
                   key === 'exchange' ? 'Exchange' :
                   key === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap Ratio' : 
                   key === 'isVolumeHealthy' ? 'Health' : 
                   key === 'pumpDumpRiskScore' ? 'Pump/Dump Risk' : 
                   key === 'walletDistributionScore' ? 'Wallet Dist Score' : 
                   key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}
                </label>
              </div>
            ))}
            <button
              onClick={handleColumnClose}
              className="w-full mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
              aria-label="Close column customization"
            >
              Done
            </button>
          </div>
        </div>
      )}
      {isSortModalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
          <div className="bg-gray-800 w-full max-w-md p-4 rounded-t-lg">
            <h2 className="text-lg font-bold text-white mb-4">Sort By</h2>
            {([
              'price',
              'marketCap',
              'volume24h',
              'volumeMarketCapRatio',
              'pumpDumpRiskScore',
              'liquidityScore',
              'walletDistributionScore',
              'exchange',
            ] as SortKey[]).map(key => (
              <div key={key} className="mb-2">
                <button
                  onClick={() => requestSort(key)}
                  className="w-full text-left p-2 bg-gray-700 rounded hover:bg-gray-600 text-white flex justify-between focus:outline-none focus:ring-2 focus:ring-blue-500"
                  aria-label={`Sort by ${key}`}
                >
                  <span>{key === 'volumeMarketCapRatio' ? 'Vol/Mkt Cap Ratio' : 
                         key === 'isVolumeHealthy' ? 'Health' : 
                         key === 'pumpDumpRiskScore' ? 'Pump/Dump Risk' : 
                         key === 'walletDistributionScore' ? 'Wallet Dist Score' : 
                         key === 'exchange' ? 'Exchange' :
                         key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</span>
                  <span>{sortConfig?.key === key ? (sortConfig.direction === 'asc' ? 'â†‘' : 'â†“') : ''}</span>
                </button>
              </div>
            ))}
            <button
              onClick={handleSortClose}
              className="w-full mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
              aria-label="Close sort options"
            >
              Done
            </button>
          </div>
        </div>
      )}
      <FilterDrawer isOpen={isFilterDrawerOpen} onClose={onFilterClose} />
    </div>
  );
});

export default TokenTable;
=== .\components\WelcomeScreen.tsx ===
import React, { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import localforage from 'localforage';

const WelcomeScreen: React.FC<{ onFinish: () => void }> = ({ onFinish }) => {
  const [show, setShow] = useState(false);

  useEffect(() => {
    const checkLastVisit = async () => {
      const lastVisit = await localforage.getItem<number>('lastVisit');
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

      if (!lastVisit || now - lastVisit > oneDay) {
        setShow(true);
        await localforage.setItem('lastVisit', now);
      } else {
        onFinish();
      }
    };

    checkLastVisit();
  }, [onFinish]);

  if (!show) return null;

  return (
    <motion.div
      initial={{ opacity: 1 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 1 }}
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100vw',
        height: '100vh',
        background: '#001529',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        zIndex: 2000,
      }}
      onAnimationComplete={() => {
        setTimeout(() => {
          setShow(false);
          onFinish();
        }, 2000);
      }}
    >
      <motion.div
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: 'spring', stiffness: 260, damping: 20 }}
      >
        {/* Replace with your logo */}
        <div style={{ fontSize: 48, color: '#fff', fontWeight: 'bold' }}>
          Sunnalytics
        </div>
      </motion.div>
    </motion.div>
  );
};

export default WelcomeScreen;
=== .\hooks\useTokenData.ts ===
import { useEffect } from 'react';
import useSWR from 'swr';
import { useTokenStore } from '../stores/useTokenStore';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  transferVolume24h?: number;
  createdAt: string;
  updatedAt: string;
  volatilityScore24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  socialSentimentScore?: number; // New field for potential backend update
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
}

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';
const API_KEY = process.env.NEXT_PUBLIC_API_KEY;

const fetcher = async (url: string) => {
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    const error = new Error(`Failed to fetch: ${res.status} ${res.statusText}`);
    error.message = await res.text().catch(() => 'Unknown server error');
    throw error;
  }
  const data = await res.json();
  return Array.isArray(data.data) ? data.data : Array.isArray(data) ? data : [data];
};

export function useTokenData(page: number = 1, limit: number = 50, category?: string) {
  const { setTokens, setFilteredTokens, setLoading, setError, fetchTokens } = useTokenStore();

  const queryParams = new URLSearchParams({
    page: page.toString(),
    limit: limit.toString(),
    ...(category && { category }),
  }).toString();

  const url = `${API_BASE_URL}/api/tokens?${queryParams}`;

  const { data, error, isLoading } = useSWR<Token[]>(url, fetcher, {
    revalidateOnFocus: false,
    revalidateOnReconnect: false,
    refreshInterval: 60000, // Refresh every minute
    dedupingInterval: 30000, // Dedupe requests within 30 seconds
    errorRetryCount: 3,
    errorRetryInterval: 5000,
  });

  useEffect(() => {
    setLoading(isLoading);
    if (error) {
      setError(error.message || 'An error occurred while fetching tokens');
    } else if (data) {
      setTokens(data);
      setFilteredTokens(data);
      setError(null);
    }
  }, [data, error, isLoading, setTokens, setFilteredTokens, setLoading, setError]);

  return { fetchTokens, isLoading, error, tokens: data };
}
=== .\pages\ai-picks.tsx ===
import React, { useEffect, useState } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import { useRouter } from 'next/router';
import BottomNav from '../components/BottomNav';

// Define the Token type
type Token = {
  id: string;
  symbol: string;
  name: string;
  category: string;
  exchange: string;
  updatedAt?: string;
  volumeMarketCapRatio?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  isVolumeHealthy?: boolean;
  stats?: {
    priceChange24h?: number;
    liquidityScore?: number;
  };
};

function formatDate(dateString?: string) {
  if (!dateString) return 'N/A';
  const date = new Date(dateString);
  return date.toLocaleString('en-GB', {
    day: '2-digit',
    month: 'long',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    hour12: true,
  }).replace(',', '');
}

export default function AIPicks() {
  const { tokens, setFilteredTokens, loading, error } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const loadTokens = async () => {
      setIsLoading(true);
      try {
        await fetchTokens();
      } catch (err) {
        console.error('Error fetching tokens:', err);
      } finally {
        setIsLoading(false);
      }
    };
    loadTokens();
  }, [fetchTokens]);

  const getBoomingTokens = (tokens: Token[]) => {
    return tokens
      .filter(token => 
        token.exchange &&
        ['binance', 'bybit_spot'].includes(token.exchange.toLowerCase()) &&
        token.volumeMarketCapRatio !== undefined &&
        token.liquidityScore !== undefined &&
        token.pumpDumpRiskScore !== undefined &&
        token.walletDistributionScore !== undefined &&
        token.liquidityScore > 50 &&
        token.pumpDumpRiskScore < 30 &&
        token.walletDistributionScore > 70 &&
        token.isVolumeHealthy &&
        token.volumeMarketCapRatio > 0.75 // Apply your investment framework constraint
      )
      .sort((a, b) => {
        const aScore = (a.volumeMarketCapRatio || 0) * (a.liquidityScore || 0);
        const bScore = (b.volumeMarketCapRatio || 0) * (b.liquidityScore || 0);
        return bScore - aScore;
      })
      .slice(0, 5);
  };

  useEffect(() => {
    if (tokens.length > 0) {
      setFilteredTokens(getBoomingTokens(tokens));
    }
  }, [tokens, setFilteredTokens]);

  const boomingTokens = getBoomingTokens(tokens);

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">AI Picks</h1>
      <p className="mb-4">Top 5 potential booming tokens from Binance and Bybit Spot based on volume/market cap ratio and liquidity score:</p>
      {isLoading ? (
        <p className="text-gray-400">Loading tokens...</p>
      ) : error ? (
        <p className="text-red-500">
          Error: {error}{' '}
          <button onClick={() => fetchTokens()} className="text-blue-500 underline">
            Retry
          </button>
        </p>
      ) : boomingTokens.length > 0 ? (
        <ul className="space-y-2">
          {boomingTokens.map(token => (
            <li 
              key={token.id} 
              className="bg-gray-800 p-2 rounded shadow-sm hover:bg-gray-700 cursor-pointer" 
              onClick={() => router.push(`/tokens/${token.id}`)}
              role="button"
              aria-label={`View details for ${token.symbol}`}
            >
              <div className="flex justify-between items-center">
                <span className="font-medium">{token.symbol}</span>
                <span className="text-sm text-gray-300">Exchange: {token.exchange || 'N/A'}</span>
              </div>
              <div className="text-sm">
                Vol/Mkt Cap: {(token.volumeMarketCapRatio || 0).toFixed(4)}, 
                Liquidity: {(token.liquidityScore || 0).toFixed(2)}, 
                Pump/Dump Risk: {(token.pumpDumpRiskScore || 0).toFixed(2)}, 
                Wallet Distribution: {(token.walletDistributionScore || 0).toFixed(2)}
              </div>
              <div className="text-xs text-gray-400 mt-1">Updated: {formatDate(token.updatedAt)}</div>
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-gray-400">No tokens meet the criteria for Binance or Bybit Spot.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\charts.tsx ===
// pages/charts.tsx
import React, { useState, useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import { Line } from 'react-chartjs-2';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js';
import BottomNav from '../components/BottomNav';

ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend);

export default function Charts() {
  const { tokens } = useTokenStore();
  const { fetchTokens } = useTokenData();
  const [selectedToken, setSelectedToken] = useState<string | null>(null);
  const [chartData, setChartData] = useState<any>(null);

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  useEffect(() => {
    if (selectedToken && tokens.length > 0) {
      const token = tokens.find(t => t.symbol === selectedToken);
      if (token) {
        // Mock historical data (replace with real API data if available)
        const labels = ['June 10', 'June 12', 'June 14', 'June 16', 'June 18'];
        const priceData = [token.price || 0, (token.price || 0) * 1.1, (token.price || 0) * 1.2, (token.price || 0) * 1.15, (token.price || 0) * 1.3];
        const volumeData = [(token.volume24h || 0), (token.volume24h || 0) * 0.9, (token.volume24h || 0) * 1.1, (token.volume24h || 0) * 1.05, (token.volume24h || 0) * 1.2];
        const marketCapData = [token.marketCap || 0, (token.marketCap || 0) * 1.15, (token.marketCap || 0) * 1.25, (token.marketCap || 0) * 1.2, (token.marketCap || 0) * 1.35];

        setChartData({
          labels,
          datasets: [
            {
              label: 'Price (USD)',
              data: priceData,
              borderColor: 'rgb(75, 192, 192)',
              backgroundColor: 'rgba(75, 192, 192, 0.5)',
              yAxisID: 'y1',
            },
            {
              label: 'Volume (24h)',
              data: volumeData,
              borderColor: 'rgb(255, 99, 132)',
              backgroundColor: 'rgba(255, 99, 132, 0.5)',
              yAxisID: 'y2',
            },
            {
              label: 'Market Cap',
              data: marketCapData,
              borderColor: 'rgb(54, 162, 235)',
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              yAxisID: 'y3',
            },
          ],
        });
      }
    }
  }, [selectedToken, tokens]);

  const options = {
    responsive: true,
    plugins: {
      legend: { position: 'top' as const },
      title: { display: true, text: 'Token Price, Volume, and Market Cap Trends' },
    },
    scales: {
      y1: { 
        type: 'linear' as const, 
        position: 'left' as const, 
        title: { display: true, text: 'Price (USD)' } 
      },
      y2: { 
        type: 'linear' as const, 
        position: 'right' as const, 
        title: { display: true, text: 'Volume (USD)' }, 
        grid: { drawOnChartArea: false } 
      },
      y3: { 
        type: 'linear' as const, 
        position: 'right' as const, 
        title: { display: true, text: 'Market Cap (USD)' }, 
        grid: { drawOnChartArea: false }, 
        min: 0 
      },
    },
  };

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Charts</h1>
      <select
        onChange={e => setSelectedToken(e.target.value)}
        className="p-2 mb-4 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-yellow-500"
        value={selectedToken || ''}
      >
        <option value="">Select a Token</option>
        {tokens.map(token => (
          <option key={token.id} value={token.symbol}>{token.symbol}</option>
        ))}
      </select>
      {chartData && selectedToken ? (
        <div>
          <Line data={chartData} options={options} />
        </div>
      ) : (
        <p className="text-gray-400">Select a token to view charts.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\index.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import TokenTable from '../components/TokenTable';
import { useTokenStore } from '../stores/useTokenStore';
import { useTokenData } from '../hooks/useTokenData';
import TabbedFilters from '../components/TabbedFilters';

export default function Home() {
  const { loading, error, fetchTokens, searchQuery, sortConfig, filters, activeTab, setFilteredTokens, tokens } =
    useTokenStore();
  const { fetchTokens: fetchData } = useTokenData();
  const [isFilterDrawerOpen, setIsFilterDrawerOpen] = useState(false);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  useEffect(() => {
    let filtered = [...tokens];

    // Apply search
    if (searchQuery) {
      filtered = filtered.filter(
        token =>
          token.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          token.symbol.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }

    // Apply tab filter
    if (activeTab !== 'all') {
      filtered = filtered.filter(token => token.category.toLowerCase() === activeTab);
    }

    // Apply filters
    if (filters.category) {
      filtered = filtered.filter(token => token.category === filters.category);
    }
    if (filters.minPrice) {
      const min = parseFloat(filters.minPrice);
      filtered = filtered.filter(token => token.price !== undefined && token.price >= min);
    }
    if (filters.maxPrice) {
      const max = parseFloat(filters.maxPrice);
      filtered = filtered.filter(token => token.price !== undefined && token.price <= max);
    }
    if (filters.minVolumeMarketCapRatio) {
      const min = parseFloat(filters.minVolumeMarketCapRatio) / 100;
      filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio >= min);
    }
    if (filters.maxVolumeMarketCapRatio) {
      const max = parseFloat(filters.maxVolumeMarketCapRatio) / 100;
      filtered = filtered.filter(token => token.volumeMarketCapRatio !== undefined && token.volumeMarketCapRatio <= max);
    }
    if (filters.minCirculatingSupplyPercentage) {
      const min = parseFloat(filters.minCirculatingSupplyPercentage);
      filtered = filtered.filter(
        token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage >= min
      );
    }
    if (filters.maxCirculatingSupplyPercentage) {
      const max = parseFloat(filters.maxCirculatingSupplyPercentage);
      filtered = filtered.filter(
        token => token.circulatingSupplyPercentage !== undefined && token.circulatingSupplyPercentage <= max
      );
    }
    if (filters.isVolumeHealthy === 'true') {
      filtered = filtered.filter(token => token.isVolumeHealthy === true);
    } else if (filters.isVolumeHealthy === 'false') {
      filtered = filtered.filter(token => token.isVolumeHealthy === false);
    }
    if (filters.isCirculatingSupplyGood === 'true') {
      filtered = filtered.filter(token => token.isCirculatingSupplyGood === true);
    } else if (filters.isCirculatingSupplyGood === 'false') {
      filtered = filtered.filter(token => token.isCirculatingSupplyGood === false);
    }

    // Apply sorting
    if (sortConfig) {
      filtered = [...filtered].sort((a, b) => {
        const aValue = a[sortConfig.key];
        const bValue = b[sortConfig.key];
        if (aValue === undefined || bValue === undefined) return 0;
        if (sortConfig.direction === 'asc') {
          return aValue > bValue ? 1 : -1;
        }
        return aValue < bValue ? 1 : -1;
      });
    }

    setFilteredTokens(filtered);
  }, [searchQuery, activeTab, filters, sortConfig, tokens, setFilteredTokens]);

  const handleFilterClick = () => {
    setIsFilterDrawerOpen(true);
  };

  const handleFilterClose = () => {
    setIsFilterDrawerOpen(false);
  };

  return (
    <div className="min-h-screen flex flex-col pb-safe-area-inset-bottom bg-gray-900 text-white">
      <main className="flex-1 p-4">
        <div className="flex justify-between items-center mb-4">
          <h1 className="text-2xl font-bold">Market</h1>
          <div className="text-sm text-gray-400">Watchlist</div>
        </div>
        <TabbedFilters />
        {loading && <p className="text-center text-gray-400">Loading tokens...</p>}
        {error && (
          <p className="text-center text-red-500">
            Error: {error}{' '}
            <button onClick={fetchTokens} className="text-blue-500 underline">
              Retry
            </button>
          </p>
        )}
        {!loading && !error && (
          <TokenTable
            isFilterDrawerOpen={isFilterDrawerOpen}
            onFilterClick={handleFilterClick}
            onFilterClose={handleFilterClose}
          />
        )}
      </main>
      <BottomNav onFilterClick={handleFilterClick} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\settings.tsx ===
import { useEffect, useState } from 'react';
import BottomNav from '../components/BottomNav';
import localforage from 'localforage';

export default function Settings() {
  const [isMounted, setIsMounted] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    setIsMounted(true);
    localforage.getItem('darkMode').then(value => {
      const darkMode = value as boolean;
      setIsDarkMode(darkMode || false);
      if (darkMode) {
        document.documentElement.classList.add('dark');
      }
    });
  }, []);

  const toggleDarkMode = () => {
    const newDarkMode = !isDarkMode;
    setIsDarkMode(newDarkMode);
    localforage.setItem('darkMode', newDarkMode);
    if (newDarkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };

  const handleReset = () => {
    localforage.clear();
    setIsDarkMode(false);
    document.documentElement.classList.remove('dark');
  };

  if (!isMounted) return null;

  return (
    <div className="min-h-screen flex flex-col pb-16">
      <main className="flex-1 p-4">
        <h1 className="text-2xl font-bold mb-4">Settings</h1>
        <div className="mb-4 flex items-center justify-between">
          <span className="text-lg">Dark Mode</span>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={isDarkMode}
              onChange={toggleDarkMode}
              className="sr-only"
            />
            <div
              className={`w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 ${
                isDarkMode ? 'bg-blue-600' : ''
              }`}
            >
              <div
                className={`absolute w-5 h-5 bg-white rounded-full transition-transform duration-200 ease-in-out ${
                  isDarkMode ? 'translate-x-5' : 'translate-x-0'
                }`}
              ></div>
            </div>
          </label>
        </div>
        <button
          onClick={handleReset}
          className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
        >
          Reset All Settings
        </button>
      </main>
      <BottomNav />
    </div>
  );
}
=== .\pages\watchlist.tsx ===
// pages/watchlist.tsx
import React, { useEffect } from 'react';
import { useTokenStore } from '../stores/useTokenStore';
import { useRouter } from 'next/router';
import BottomNav from '../components/BottomNav';

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

export default function Watchlist() {
  const { watchlist, fetchTokens } = useTokenStore();
  const router = useRouter();

  useEffect(() => {
    fetchTokens();
  }, [fetchTokens]);

  const formatNumber = (value: number | undefined, suffix: string = ''): string => {
    if (value === undefined || value === 0) return '-';
    if (value >= 1e9) return `$${Math.floor(value / 1e9)}${suffix}B`;
    if (value >= 1e6) return `$${Math.floor(value / 1e6)}${suffix}M`;
    return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 })}`;
  };

  const formatRatio = (value: number | undefined) => value !== undefined ? `${(value * 100).toFixed(2)}%` : '-';
  const formatBoolean = (value: boolean | undefined) => value !== undefined ? (value ? 'Yes' : 'No') : '-';
  const formatScore = (value: number | undefined) => value !== undefined ? value.toFixed(2) : '-';

  return (
    <div className="min-h-screen flex flex-col p-4 bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Watchlist</h1>
      {watchlist.length > 0 ? (
        <ul className="space-y-4">
          {watchlist.map((token: Token) => (
            <li
              key={token.id}
              className="bg-gray-800 p-4 rounded-lg shadow-sm hover:bg-gray-700 transition-colors cursor-pointer"
              onClick={() => router.push(`/tokens/${token.id}`)}
            >
              <div className="flex flex-col sm:flex-row sm:items-center justify-between">
                <div>
                  <h2 className="text-lg font-semibold">{token.symbol}</h2>
                  <p className="text-sm text-gray-400">{token.name} - {token.category}</p>
                </div>
                <div className="mt-2 sm:mt-0 space-y-1">
                  <p>Price: {formatNumber(token.price)}</p>
                  <p>Market Cap: {formatNumber(token.marketCap)}</p>
                  <p>Volume (24h): {formatNumber(token.volume24h)}</p>
                  <p>Vol/Mkt Cap: {formatRatio(token.volumeMarketCapRatio)}</p>
                  <p>Health: {formatBoolean(token.isVolumeHealthy)}</p>
                  <p>Liquidity Score: {formatScore(token.liquidityScore)}</p>
                </div>
              </div>
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-gray-400">No tokens in watchlist. Add tokens from the Market page.</p>
      )}
      <BottomNav onFilterClick={() => {}} onSearchFocus={() => document.querySelector('input')?.focus()} />
    </div>
  );
}
=== .\pages\welcome.tsx ===
import { useEffect } from 'react';
import { useRouter } from 'next/router';
import localforage from 'localforage';

export default function Welcome() {
  const router = useRouter();

  useEffect(() => {
    localforage.getItem('welcomeScreenSeen').then(value => {
      if (value) {
        router.push('/');
      }
    });
  }, [router]);

  const handleContinue = () => {
    localforage.setItem('welcomeScreenSeen', true);
    router.push('/');
  };

  return (
    <div className="min-h-screen flex flex-col justify-center items-center bg-gray-100 p-4">
      <h1 className="text-3xl font-bold mb-4">Welcome to Sunnalytics</h1>
      <p className="text-lg text-gray-600 mb-6 text-center">
        Your go-to platform for token analytics and insights.
      </p>
      <button
        onClick={handleContinue}
        className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
      >
        Continue
      </button>
    </div>
  );
}
=== .\pages\_app.tsx ===
import '../styles/globals.css';
import type { AppProps } from 'next/app';
import { inter, robotoMono } from '../utils/fonts';
import Head from 'next/head';
import { useState, useEffect } from 'react';
import WelcomeScreen from '../components/WelcomeScreen';

export default function App({ Component, pageProps }: AppProps) {
  const [showWelcome, setShowWelcome] = useState(true);
  const INACTIVITY_THRESHOLD = 10 * 60 * 1000; // 10 minutes in milliseconds

  useEffect(() => {
    const lastActive = localStorage.getItem('lastActive');
    const now = new Date().getTime();

    if (lastActive) {
      const lastActiveTime = parseInt(lastActive, 10);
      const timeSinceLastActive = now - lastActiveTime;

      // Show welcome screen if inactive for more than INACTIVITY_THRESHOLD
      if (timeSinceLastActive > INACTIVITY_THRESHOLD) {
        setShowWelcome(true);
      } else {
        setShowWelcome(false);
      }
    } else {
      // First visit or no stored timestamp
      localStorage.setItem('lastActive', now.toString());
      setShowWelcome(true);
    }

    // Update last active timestamp when the app is interacted with
    const handleActivity = () => {
      localStorage.setItem('lastActive', now.toString());
    };

    window.addEventListener('mousemove', handleActivity);
    window.addEventListener('keydown', handleActivity);
    window.addEventListener('scroll', handleActivity);

    return () => {
      window.removeEventListener('mousemove', handleActivity);
      window.removeEventListener('keydown', handleActivity);
      window.removeEventListener('scroll', handleActivity);
    };
  }, []);

  const handleWelcomeFinish = () => {
    setShowWelcome(false);
  };

  return (
    <div className={`${inter.variable} ${robotoMono.variable}`}>
      <Head>
        <title>Sunnalytics</title>
        <meta name="description" content="Sunnalytics - Token Analytics Platform" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#111827" />
        <link rel="icon" href="/favicon.ico" sizes="any" />
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
        <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />
        <link rel="manifest" href="/site.webmanifest" />
      </Head>
      {showWelcome && <WelcomeScreen onFinish={handleWelcomeFinish} />}
      <Component {...pageProps} />
    </div>
  );
}
=== .\pages\tokens\[id].tsx ===
import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import { Line } from 'react-chartjs-2';
import { Chart as ChartJS, LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend, ChartOptions } from 'chart.js';
import 'chartjs-adapter-date-fns';
import { useTokens } from '../../utils/api';
import BottomNav from '../../components/BottomNav';
import { formatNumber } from '../../components/TokenTable';

ChartJS.register(LineElement, PointElement, LinearScale, TimeScale, Tooltip, Legend);

interface TokenHistory {
  id: string;
  tokenId: string;
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  timestamp: string;
}

interface Token {
  id: string;
  name: string;
  symbol: string;
  category: string;
  price?: number;
  marketCap?: number;
  volume24h?: number;
  volumeMarketCapRatio?: number;
  isVolumeHealthy?: boolean;
}

const TokenDetails: React.FC = () => {
  const router = useRouter();
  const { id } = router.query;
  const { tokens, isLoading, error } = useTokens();
  const [history, setHistory] = useState<TokenHistory[]>([]);
  const [apiError, setApiError] = useState<string | null>(null);

  // Replace with your backend URL, e.g., 'https://your-backend.com'
  const BACKEND_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';

  useEffect(() => {
    if (id) {
      const url = `${BACKEND_URL}/api/tokens/${id}/history`;
      console.log(`Fetching history from: ${url}`);
      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          console.log('Token history data:', data);
          setHistory(data);
          setApiError(null);
        })
        .catch(err => {
          console.error('Error fetching history:', err.message);
          setApiError(err.message);
        });
    }
  }, [id]);

  const token = tokens?.find((t: Token) => t.id === id);

  if (isLoading) return <div className="p-4 text-center text-gray-400">Loading...</div>;
  if (error) return <div className="p-4 text-center text-red-500">Error: {error}</div>;
  if (!token) return <div className="p-4 text-center text-gray-400">Token not found</div>;

  // Group by date, minimal filtering
  const validHistory = history
    .filter(h => h.price != null && h.volume24h != null && h.marketCap != null && h.marketCap !== 0)
    .reduce((acc: TokenHistory[], h) => {
      const date = new Date(h.timestamp).toISOString().split('T')[0];
      const existing = acc.find(item => new Date(item.timestamp).toISOString().split('T')[0] === date);
      if (!existing) acc.push(h);
      return acc;
    }, [])
    .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());

  console.log('Valid history:', validHistory);

  const chartData = {
    labels: validHistory.map(h => new Date(h.timestamp)),
    datasets: [
      {
        label: 'Volume/Market Cap Ratio (%)',
        data: validHistory.map(h => (h.volume24h! / h.marketCap!) * 100),
        borderColor: '#FBBF24',
        yAxisID: 'y-ratio',
      },
      {
        label: 'Price (USD)',
        data: validHistory.map(h => h.price!),
        borderColor: '#3B82F6',
        yAxisID: 'y-price',
      },
    ],
  };

  const chartOptions: ChartOptions<'line'> = {
    responsive: true,
    scales: {
      x: {
        type: 'time',
        time: { unit: 'day' },
        title: { display: true, text: 'Date' },
      },
      'y-ratio': {
        type: 'linear',
        position: 'left',
        title: { display: true, text: 'Ratio (%)' },
        beginAtZero: true,
      },
      'y-price': {
        type: 'linear',
        position: 'right',
        title: { display: true, text: 'Price ($)' },
        beginAtZero: true,
      },
    },
    plugins: {
      legend: { display: true },
      tooltip: { mode: 'index', intersect: false },
    },
  };

  console.log('Chart data:', chartData);

  return (
    <div className="min-h-screen flex flex-col bg-gray-900 text-white">
      <header className="bg-gray-800 p-4 flex items-center">
        <button onClick={() => router.back()} className="mr-4 text-yellow-400">
          â† Back
        </button>
        <h1 className="text-xl font-bold">{token.name} ({token.symbol.toUpperCase()})</h1>
      </header>
      <main className="flex-1 p-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-gray-800 p-4 rounded-lg">
            <h2 className="text-lg font-semibold">Details</h2>
            <p>Price: {formatNumber(token.price)}</p>
            <p>Market Cap: {formatNumber(token.marketCap)}</p>
            <p>24h Volume: {formatNumber(token.volume24h)}</p>
            <p>Category: {token.category.charAt(0).toUpperCase() + token.category.slice(1)}</p>
            <p>Volume/Market Cap Ratio: {(token.volumeMarketCapRatio * 100)?.toFixed(2)}%</p>
            <p>Healthy Volume: {token.isVolumeHealthy ? 'Yes' : 'No'}</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg h-80">
            <h2 className="text-lg font-semibold mb-2">Historical Data</h2>
            <div className="h-64">
              {apiError ? (
                <div className="text-center text-red-500 h-full flex items-center justify-center">
                  Error: {apiError}
                </div>
              ) : validHistory.length > 0 ? (
                <Line data={chartData} options={chartOptions} />
              ) : (
                <div className="text-center text-gray-400 h-full flex items-center justify-center">
                  No history data
                </div>
              )}
            </div>
          </div>
        </div>
      </main>
      <BottomNav onFilterClick={() => {}} />
    </div>
  );
};

export default TokenDetails;
=== .\stores\useTokenStore.ts ===
import { create } from 'zustand';
import localforage from 'localforage';
import { persist, createJSONStorage } from 'zustand/middleware';

interface Token {
  id: string;
  name: string;
  symbol: string;
  exchange: string;
  category: string;
  marketCap?: number;
  volume24h?: number;
  price?: number;
  transferVolume24h?: number;
  fullyDilutedValuation?: number;
  volumeMarketCapRatio?: number;
  circulatingSupplyPercentage?: number;
  isVolumeHealthy?: boolean;
  isCirculatingSupplyGood?: boolean;
  potentialMultiplier?: number;
  rank?: number;
  liquidityScore?: number;
  pumpDumpRiskScore?: number;
  walletDistributionScore?: number;
  updatedAt?: string;
  stats?: {
    priceChange24h?: number;
    volatilityScore24h?: number;
    liquidityScore?: number;
  };
}

interface FilterState {
  category: string;
  minPrice: string;
  maxPrice: string;
  minVolumeMarketCapRatio: string;
  maxVolumeMarketCapRatio: string;
  minCirculatingSupplyPercentage: string;
  maxCirculatingSupplyPercentage: string;
  isVolumeHealthy: string;
  isCirculatingSupplyGood: string;
}

interface TokenState {
  tokens: Token[];
  filteredTokens: Token[];
  watchlist: Token[];
  loading: boolean;
  error: string | null;
  searchQuery: string;
  sortConfig: { key: keyof Token; direction: 'asc' | 'desc' } | null;
  filters: FilterState;
  activeTab: string;
  visibleColumns: string[];
  scrollPosition: number;
  setTokens: (tokens: Token[]) => void;
  setFilteredTokens: (tokens: Token[]) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  setSearchQuery: (query: string) => void;
  setSortConfig: (config: { key: keyof Token; direction: 'asc' | 'desc' } | null) => void;
  setFilters: (filters: Partial<FilterState>) => void;
  setActiveTab: (tab: string) => void;
  setVisibleColumns: (columns: string[]) => void;
  setScrollPosition: (position: number) => void;
  fetchTokens: () => void;
  addToWatchlist: (token: Token) => void;
}

export const useTokenStore = create<TokenState>()(
  persist(
    (set, get) => ({
      tokens: [],
      filteredTokens: [],
      watchlist: [],
      loading: false,
      error: null,
      searchQuery: '',
      sortConfig: null,
      filters: {
        category: '',
        minPrice: '',
        maxPrice: '',
        minVolumeMarketCapRatio: '',
        maxVolumeMarketCapRatio: '',
        minCirculatingSupplyPercentage: '',
        maxCirculatingSupplyPercentage: '',
        isVolumeHealthy: '',
        isCirculatingSupplyGood: '',
      },
      activeTab: 'all',
      visibleColumns: [],
      scrollPosition: 0,
      setTokens: (tokens: Token[]) => set({ tokens }),
      setFilteredTokens: (tokens: Token[]) => set({ filteredTokens: tokens }),
      setLoading: (loading: boolean) => set({ loading }),
      setError: (error: string | null) => set({ error }),
      setSearchQuery: (query: string) => set({ searchQuery: query }),
      setSortConfig: (config: { key: keyof Token; direction: 'asc' | 'desc' } | null) => set({ sortConfig: config }),
      setFilters: (filters: Partial<FilterState>) =>
        set(state => ({ filters: { ...state.filters, ...filters } })),
      setActiveTab: (tab: string) => set({ activeTab: tab }),
      setVisibleColumns: (columns: string[]) => set({ visibleColumns: columns }),
      setScrollPosition: (position: number) => set({ scrollPosition: position }),
      fetchTokens: async () => {
        set({ loading: true, error: null });
        try {
          const response = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/tokens`, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          const tokens: Token[] = data.map((item: any) => ({
            id: item.id || item._id,
            name: item.name,
            symbol: item.symbol,
            category: item.category || 'Unknown',
            price: item.price,
            marketCap: item.marketCap,
            volume24h: item.volume24h,
            volumeMarketCapRatio: item.volumeMarketCapRatio,
            isVolumeHealthy: item.isVolumeHealthy,
            pumpDumpRiskScore: item.pumpDumpRiskScore,
            liquidityScore: item.liquidityScore,
            walletDistributionScore: item.walletDistributionScore,
            transferVolume24h: item.transferVolume24h,
            updatedAt: item.updatedAt,
          }));

          set({ tokens, filteredTokens: tokens, loading: false });
        } catch (err) {
          set({ error: err instanceof Error ? err.message : 'Failed to fetch tokens', loading: false });
        }
      },
      addToWatchlist: (token: Token) =>
        set((state) => ({
          watchlist: state.watchlist.some((w: Token) => w.id === token.id)
            ? state.watchlist
            : [...state.watchlist, token],
        })),
    }),
    {
      name: 'token-store',
      storage: createJSONStorage(() => localforage),
    }
  )
);
=== .\styles\globals.css ===
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --max-width: 1200px;
  --border-radius: 8px;
  --font-mono: var(--font-roboto-mono), ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono',
    'Roboto Mono', 'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro',
    'Fira Mono', 'Droid Sans Mono', 'Courier New', monospace;
  --primary-color: #FBBF24;
  --background-dark: #0F172A;
  --card-bg: #1E293B;
  --text-primary: #F3F4F6;
  --text-secondary: #9CA3AF;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
  font-family: var(--font-inter), system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
    'Helvetica Neue', Arial, sans-serif;
  background-color: var(--background-dark);
  color: var(--text-primary);
}

a {
  color: var(--primary-color);
  text-decoration: none;
  transition: color 0.2s ease-in-out;
}

a:hover {
  color: #F59E0B;
}

button, input, select {
  transition: all 0.2s ease-in-out;
}

button:focus, input:focus, select:focus {
  outline: none;
  ring: 2px solid var(--primary-color);
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}

.bg-gray-700 {
  background-color: var(--card-bg);
}

.bg-gray-800 {
  background-color: #1E293B;
}

.bg-gray-900 {
  background-color: var(--background-dark);
}

.text-gray-400 {
  color: var(--text-secondary);
}

.rounded-lg {
  border-radius: var(--border-radius);
}

.shadow-lg {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.transition-all {
  transition: all 0.2s ease-in-out;
}
=== .\utils\api.ts ===
import useSWR from 'swr';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';
const API_KEY = process.env.NEXT_PUBLIC_API_KEY;

const fetcher = async (url: string) => {
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    const error = new Error(`An error occurred while fetching the data: ${res.status} ${res.statusText}`);
    error.message = await res.text().catch(() => 'Unknown server error');
    throw error;
  }
  const data = await res.json();
  return Array.isArray(data.data) ? data.data : Array.isArray(data) ? data : data;
};

export function useTokens(category?: string, page: number = 1, limit: number = 50) {
  const queryParams = new URLSearchParams({
    page: page.toString(),
    limit: limit.toString(),
    ...(category && { category }),
  }).toString();

  const url = `${API_BASE_URL}/api/tokens?${queryParams}`;

  const { data, error, isLoading } = useSWR(url, fetcher, {
    refreshInterval: 60000,
    revalidateOnFocus: false,
    dedupingInterval: 30000,
    errorRetryCount: 3,
    errorRetryInterval: 5000,
  });

  return { tokens: data, error: error?.message, isLoading };
}

export async function refreshTokens() {
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(`${API_BASE_URL}/api/tokens/refresh`, { 
    method: 'POST',
    headers,
  });
  if (!res.ok) {
    const error = new Error(`Failed to refresh tokens: ${res.status} ${res.statusText}`);
    error.message = await res.text().catch(() => 'Unknown server error');
    throw error;
  }
  return res.json();
}

export async function fetchTokenHistory(tokenId: string, timeframe: string = '7d') {
  const url = `${API_BASE_URL}/api/tokens/${tokenId}/history?timeframe=${timeframe}`;
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };
  if (API_KEY) {
    headers['Authorization'] = `Bearer ${API_KEY}`;
  }
  const res = await fetch(url, { headers });
  if (!res.ok) {
    const error = new Error(`Failed to fetch token history: ${res.status} ${res.statusText}`);
    error.message = await res.text().catch(() => 'Unknown server error');
    throw error;
  }
  return res.json();
}
=== .\utils\fonts.ts ===
import { Inter, Roboto_Mono } from 'next/font/google';

export const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter',
});

export const robotoMono = Roboto_Mono({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-roboto-mono',
});
=== .\utils\tokenStats.ts ===
export interface TokenStats {
  priceChange24h: number;
  volatilityScore24h: number;
  liquidityScore: number;
  transferVolume24h: number;
}

export function calculateTokenStats(data: {
  price: number | null;
  marketCap: number | null;
  volume24h: number | null;
  circulatingSupply: number | null;
  totalSupply: number | null;
  priceChange24h?: number | null;
  transferAmount?: number;
}): TokenStats {
  const { price, marketCap, volume24h, circulatingSupply, priceChange24h, transferAmount } = data;

  const change24h = priceChange24h ?? 0;
  const volatility = volume24h && marketCap ? (volume24h / marketCap) : 0;
  const liquidityScore = volume24h && circulatingSupply ? volume24h / circulatingSupply : 0;
  const transferVol24h = transferAmount ?? 0;

  return {
    priceChange24h: Number(change24h.toFixed(2)),
    volatilityScore24h: Number(volatility.toFixed(2)),
    liquidityScore: Number(liquidityScore.toFixed(2)),
    transferVolume24h: Number(transferVol24h.toFixed(2)),
  };
}
